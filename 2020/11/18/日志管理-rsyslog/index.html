<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>辉辉的数据库</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="日志管理-rsyslog1 系统日志1 系统日志介绍将系统和应用发生的事件记录到日志中，以助于拍错和分析使用 日志记录的内容包括：  历史事件：事件，地点，人物，事件 日志级别：事件的关键性程序，Loglevel  系统日志的发展过程：  Centos 5 之前采用：syslogd，klogd Centos 6 以后采用rsyslog  Rsyslog特性：  多线程 UDP，TCP，SSL，TL">
<meta property="og:type" content="article">
<meta property="og:title" content="辉辉的数据库">
<meta property="og:url" content="http://example.com/2020/11/18/%E6%97%A5%E5%BF%97%E7%AE%A1%E7%90%86-rsyslog/index.html">
<meta property="og:site_name" content="辉辉的数据库">
<meta property="og:description" content="日志管理-rsyslog1 系统日志1 系统日志介绍将系统和应用发生的事件记录到日志中，以助于拍错和分析使用 日志记录的内容包括：  历史事件：事件，地点，人物，事件 日志级别：事件的关键性程序，Loglevel  系统日志的发展过程：  Centos 5 之前采用：syslogd，klogd Centos 6 以后采用rsyslog  Rsyslog特性：  多线程 UDP，TCP，SSL，TL">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="c:/Users/a/AppData/Roaming/Typora/typora-user-images/image-20201101094356620.png">
<meta property="article:published_time" content="2020-11-18T13:08:14.256Z">
<meta property="article:modified_time" content="2020-11-01T02:50:40.227Z">
<meta property="article:author" content="huihui">
<meta property="article:tag" content="notes">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="c:/Users/a/AppData/Roaming/Typora/typora-user-images/image-20201101094356620.png">
  
    <link rel="alternate" href="/atom.xml" title="辉辉的数据库" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">辉辉的数据库</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">我们要丈量大地！</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-日志管理-rsyslog" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/11/18/%E6%97%A5%E5%BF%97%E7%AE%A1%E7%90%86-rsyslog/" class="article-date">
  <time class="dt-published" datetime="2020-11-18T13:08:14.256Z" itemprop="datePublished">2020-11-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="日志管理-rsyslog"><a href="#日志管理-rsyslog" class="headerlink" title="日志管理-rsyslog"></a>日志管理-rsyslog</h1><h1 id="1-系统日志"><a href="#1-系统日志" class="headerlink" title="1 系统日志"></a>1 系统日志</h1><h2 id="1-系统日志介绍"><a href="#1-系统日志介绍" class="headerlink" title="1 系统日志介绍"></a>1 系统日志介绍</h2><p>将系统和应用发生的事件记录到日志中，以助于拍错和分析使用</p>
<p>日志记录的内容包括：</p>
<ul>
<li>历史事件：事件，地点，人物，事件</li>
<li>日志级别：事件的关键性程序，Loglevel</li>
</ul>
<p>系统日志的发展过程：</p>
<ul>
<li>Centos 5 之前采用：syslogd，klogd</li>
<li>Centos 6 以后采用rsyslog</li>
</ul>
<p>Rsyslog特性：</p>
<ul>
<li>多线程</li>
<li>UDP，TCP，SSL，TLS，RELP</li>
<li>Mysql，PGSQL，Oracle数据库实现日志存储</li>
<li>强大的过滤器，可以实现过滤记录日志信息中任意部分</li>
<li>自定义输出格式</li>
</ul>
<p>ELK：由三个软件组成的非关系型分布式数据库</p>
<ul>
<li>Elasticsearch，开源的，分布式搜索引擎，可以处理大规模日志数据</li>
<li>Logstash：对日志进行收集、分析、过滤，并将其存储供以后使用</li>
<li>Kibana：可以提供的日志分析友好的Web界面</li>
</ul>
<h2 id="2-rsyslog-管理"><a href="#2-rsyslog-管理" class="headerlink" title="2 rsyslog 管理"></a>2 rsyslog 管理</h2><h3 id="1-术语"><a href="#1-术语" class="headerlink" title="1 术语"></a>1 术语</h3><ul>
<li>facility：设施，从功能或程序上对日志进行分类</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">大概有：</span><br><span class="line">auth,authpriv,cron,daemon,ftp,kern,lpr,mail,syslogxxx</span><br><span class="line">还可以自定义</span><br><span class="line">local10-local17</span><br></pre></td></tr></table></figure>

<ul>
<li>Priority：优先级，从低到高排序</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">debug，info，notice，warn，err，crit(critical),alert,emerg</span><br></pre></td></tr></table></figure>

<ul>
<li>参考帮助：man rsyslogd，man logger</li>
</ul>
<h3 id="2-rsyslog管理"><a href="#2-rsyslog管理" class="headerlink" title="2 rsyslog管理"></a>2 rsyslog管理</h3><p><code>/etc/rsyslog.conf,/etc/rsyslog.d/*.conf</code></p>
<p>日志的组成格式：</p>
<ul>
<li>MODULES：相关模块配置</li>
<li>GLOBAL DIRECTIVES：全局配置</li>
<li>RULES：日志记录相关的规则配置</li>
</ul>
<p>RULE的配置格式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">facility.priority;</span><br></pre></td></tr></table></figure>

<p>例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*.info;mail.none;authpriv.none;cron.none                &#x2F;var&#x2F;log&#x2F;messages</span><br></pre></td></tr></table></figure>

<p>facility格式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">* #所有的facility</span><br><span class="line">facility1,,facility2,facility3...</span><br></pre></td></tr></table></figure>

<p>记录多个facility的日志，可以自己定义facility</p>
<p>priority格式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">*：所有级别</span><br><span class="line">none：没有级别，就是说不记录</span><br><span class="line">priority：指定级别及以上的所有级别</span><br><span class="line">&#x3D;priority：仅记录指定级别的日志信息</span><br></pre></td></tr></table></figure>

<p>target格式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">文件路径：通常在&#x2F;var&#x2F;log&#x2F;，文件路径前面加&quot;-&quot;，表示异步写入，即不是事件发生立刻写入</span><br><span class="line">用户：将日志事件通知给指定的用户，* 表示登录的所有用户</span><br><span class="line">日志服务器：@host，把日志发送给指定的远程UDP日志服务器，@@host 将日志发送到远程TCP日志服务器</span><br><span class="line">管道： | COMMAND，转发给其他命令处理</span><br></pre></td></tr></table></figure>

<p>通常的日志格式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">事件产生的时间   主机名称  进程(pid)：事件内容</span><br></pre></td></tr></table></figure>

<p>把日志记录到其他主机</p>
<p>1.本机配置远程主机的地址  一个@是upd，两个@@是tcp</p>
<p>2.远程主机开启imudp模块</p>
<p>例子：Centos8开启imtcp,imudp模块接收来自centos7的日志</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">module(load&#x3D;&quot;imudp&quot;)</span><br><span class="line">input(type&#x3D;&quot;imudp&quot; port&#x3D;&quot;514&quot;)</span><br><span class="line"></span><br><span class="line">module(load&#x3D;&quot;imtcp&quot;)</span><br><span class="line">input(type&#x3D;&quot;imtcp&quot; port&#x3D;&quot;514&quot;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>centos7配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">54 *.info;mail.none;authpriv.none;cron.none                &#x2F;var&#x2F;log&#x2F;messages</span><br><span class="line">55 *.info;mail.none;authpriv.none;cron.none                @10.0.0.119  #udp</span><br><span class="line">56 *.info;mail.none;authpriv.none;cron.none                @@10.0.0.119  #tcp</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>几个重要的日志：</p>
<p><code>/var/log/secure</code>：系统安全日志，文本格式</p>
<p><code>/var/log/btmp</code>：需要使用<code>lastb</code>查看，失败登录日志</p>
<p><code>/var/log/wtmp</code>：需要使用<code>last</code>查看，成功登陆日志</p>
<p><code>/var/log/lastlog</code>：查看用户的最后登录时间，使用<code>lastlog</code>查看</p>
<p><code>dmesg</code>：硬件的记录信息</p>
<p><code>/var/log/messages</code>：很多程序都会把日志写在这里，在<code>/etc/rsyslog.conf</code>中配置</p>
<p><code>/var/log/anaconda/*</code>：系统安装过程日志</p>
<h2 id="3-日志管理工具-journalctl"><a href="#3-日志管理工具-journalctl" class="headerlink" title="3 日志管理工具 journalctl"></a>3 日志管理工具 journalctl</h2><p>Centos7之后，利用systemd同一管理所有Unit的启动日志，带来的好处就是，可以只用journalctl一个命令，查看所有日志，包括内核日志和应用日志</p>
<p>日志的配置文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;etc&#x2F;systemd&#x2F;journald.conf</span><br></pre></td></tr></table></figure>

<p>命令格式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">journalctl [options] [matches]</span><br></pre></td></tr></table></figure>



<h1 id="2-实际操作"><a href="#2-实际操作" class="headerlink" title="2 实际操作"></a>2 实际操作</h1><h2 id="1-利用mysql存储日志信息"><a href="#1-利用mysql存储日志信息" class="headerlink" title="1 利用mysql存储日志信息"></a>1 利用mysql存储日志信息</h2><p>通过rsyslog-mysql模块来实现功能，注意要在数据库进行常规的账号和数据库创建和授权</p>
<p>两台主机，一台rsyslog，一台mysql</p>
<p>目标：利用rsyslog日志服务，将收集到的日志记录与mysql中</p>
<p>rsyslog：10.0.0.119</p>
<p>mysql：10.0.0.12</p>
<p>1.在rsyslog服务器上安装连接mysql模块的相关程序包</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">dnf install rsyslog-mysql</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]$rpm -ql rsyslog-mysql</span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;.build-id</span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;.build-id&#x2F;08&#x2F;e7a8c0efc79474f9a8aac3afb7af7654665568</span><br><span class="line">&#x2F;usr&#x2F;lib64&#x2F;rsyslog&#x2F;ommysql.so</span><br><span class="line">&#x2F;usr&#x2F;share&#x2F;doc&#x2F;rsyslog&#x2F;mysql-createDB.sql  #这是一个数据文件，里面是创建用于rsyslog的SQL语句，把它复制到数据库服务器上，导入数据库</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2.在数据库服务器上导入sql和创建用户</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]$scp &#x2F;usr&#x2F;share&#x2F;doc&#x2F;rsyslog&#x2F;mysql-createDB.sql 10.0.0.12:&#x2F;root&#x2F;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">source &#x2F;root&#x2F;mysql-createDB.sql</span><br><span class="line"></span><br><span class="line">MariaDB [Syslog]&gt; create user rsyslog@&#39;10.0.0.%&#39; identified by &#39;centos&#39;;</span><br><span class="line">Query OK, 0 rows affected (0.014 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [Syslog]&gt; grant all privileges on Syslog.* to rsyslog@&#39;10.0.0.%&#39;;</span><br><span class="line">Query OK, 0 rows affected (0.001 sec)</span><br></pre></td></tr></table></figure>

<p>3.配置日志服务器将日志发送至指定数据库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">开启模块，centos8是module，centos7和6是 $modload ommysql</span><br><span class="line">module(load&#x3D;&quot;ommysql&quot;)</span><br><span class="line">#指定日志传送到数据库服务器，格式是，模块，IP，数据库名，用户，密码</span><br><span class="line">*.info;mail.none;authpriv.none;cron.none                :ommysql:10.0.0.12,Syslog,rs yslog,centos</span><br><span class="line">systmectl restart rsyslog.service</span><br><span class="line"></span><br><span class="line">#测试日志</span><br><span class="line">logger &quot;this is a test log&quot;</span><br><span class="line"></span><br><span class="line">#查看</span><br><span class="line">*************************** 18. row ***************************</span><br><span class="line">                ID: 18</span><br><span class="line">        CustomerID: NULL</span><br><span class="line">        ReceivedAt: 2020-10-31 22:01:23</span><br><span class="line">DeviceReportedTime: 2020-10-31 22:01:23</span><br><span class="line">          Facility: 1</span><br><span class="line">          Priority: 5</span><br><span class="line">          FromHost: centos8</span><br><span class="line">           Message: this is a test log</span><br></pre></td></tr></table></figure>



<h2 id="2-loganalyzer"><a href="#2-loganalyzer" class="headerlink" title="2 loganalyzer"></a>2 loganalyzer</h2><p>loganalyzer是用PHP语言实现的日志管理系统，可以将Mysql数据库的日志用丰富的WEB方式进行展示</p>
<p>官网：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;loganalyzer.adiscon.com&#x2F;</span><br></pre></td></tr></table></figure>

<p>一个网页展示日志的方式；</p>
<p>三台主机，一台rsyslog，一台mysql，一台httpd+php</p>
<p>rsyslog：10.0.0.119</p>
<p>mysql：10.0.0.12</p>
<p>httpd+php：10.0.0.111</p>
<p>在上一个实验的基础上，安装一个httpd和php</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dnf -y install httpd php php-fpm php-gd php-mysqlnd</span><br><span class="line">wget http:&#x2F;&#x2F;download.adiscon.com&#x2F;loganalyzer&#x2F;loganalyzer-4.1.11.tar.gz</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tar xf loganalyzer-4.1.11.tar.gz</span><br><span class="line">mkdir -p &#x2F;var&#x2F;www&#x2F;html&#x2F;log</span><br><span class="line">mv loganalyzer-4.1.11&#x2F;src&#x2F;* &#x2F;var&#x2F;www&#x2F;html&#x2F;log</span><br><span class="line">touch &#x2F;var&#x2F;www&#x2F;html&#x2F;log&#x2F;config.php</span><br><span class="line">chmod &#x2F;var&#x2F;www&#x2F;html&#x2F;log&#x2F;666 config.php</span><br></pre></td></tr></table></figure>

<p>通过<a target="_blank" rel="noopener" href="http://ip/log%E8%AE%BF%E9%97%AEloganalyzer">http://IP/log访问loganalyzer</a></p>
<p>配置的时候注意：如果配置不对需要重新配，就把config.php这个文件删除了，然后在touch一个新的</p>
<p><img src="C:\Users\a\AppData\Roaming\Typora\typora-user-images\image-20201101094356620.png" alt="image-20201101094356620"></p>
<h1 id="3-logrotate-日志转储"><a href="#3-logrotate-日志转储" class="headerlink" title="3 logrotate 日志转储"></a>3 logrotate 日志转储</h1><h2 id="1-logrotate-介绍"><a href="#1-logrotate-介绍" class="headerlink" title="1 logrotate 介绍"></a>1 logrotate 介绍</h2><p>logrotate程序是一个日志文件管理工具，用来把旧的日志文件删除，并创建新的日志文件，称为日志转储或滚动，可以根据日志文件的大小，也可以根据其天数来转储，这个过程一般通过<code>cron</code>程序来执行</p>
<h2 id="2-logrotate-配置"><a href="#2-logrotate-配置" class="headerlink" title="2 logrotate 配置"></a>2 logrotate 配置</h2><p>软件包：<code>logrotate</code></p>
<p>相关文件</p>
<ul>
<li>计划任务：<code>/etc/cron.daily/logrotate</code></li>
<li>程序文件：<code>/usr/sbin/logrotate</code></li>
<li>配置文件：<code>/etc/logrotate.conf</code></li>
<li>日志文件：<code>/var/lib/logrotate/logrotate.status</code></li>
</ul>
<p>配置文件格式</p>
<p>日志文件的路径 {</p>
<p>​    命令  参数</p>
<p>​    命令  参数</p>
<p>​    ….</p>
<p>}</p>
<p>例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1 &#x2F;var&#x2F;log&#x2F;yum.log &#123;</span><br><span class="line">2     missingok</span><br><span class="line">3     notifempty</span><br><span class="line">4     maxsize 30k</span><br><span class="line">5     yearly</span><br><span class="line">6     create 0600 root root</span><br><span class="line">7 &#125;</span><br></pre></td></tr></table></figure>

<p>常用参数：</p>
<table>
<thead>
<tr>
<th>配置命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>compress</td>
<td>通过gzip压缩转储以后的日志</td>
</tr>
<tr>
<td>nocompress</td>
<td>不压缩</td>
</tr>
<tr>
<td>create mode owner group</td>
<td>指定转储文件的所属组和所属组</td>
</tr>
<tr>
<td>delaycompress</td>
<td>和compress一起使用时，表示转储的日志文件是在下一次转储时才压缩</td>
</tr>
<tr>
<td>ifempty</td>
<td>即使是空文件也转储，此项是默认选项</td>
</tr>
<tr>
<td>notifempty</td>
<td>如果是空文件，就不转储</td>
</tr>
<tr>
<td>mail address</td>
<td>把转储的日志文件发送到指定邮箱</td>
</tr>
<tr>
<td>olddir directory</td>
<td>把转储的日志文件存放在指定目录，必须和当前日志文件在同一个文件系统</td>
</tr>
<tr>
<td>prerotate/endscript</td>
<td>在转储以前需要执行的命令，这两个命令必须单独成行</td>
</tr>
<tr>
<td>postrotate/endscript</td>
<td>在转储以后需要执行的命令，这两个命令必须单独成行</td>
</tr>
<tr>
<td>daily/weekly/monthly</td>
<td>指定转储周期</td>
</tr>
<tr>
<td>rotate countNum</td>
<td>指定能够保存多少份转储日志文件，超过了就开始删除日志</td>
</tr>
<tr>
<td>size Num</td>
<td>指定日志文件大小达到多少时进行转储</td>
</tr>
<tr>
<td>missingok</td>
<td>如果日志文件不存在，不提示错误，继续处理下一个</td>
</tr>
<tr>
<td>nomissingok</td>
<td>如果日志文件不存在，提示错误，此为默认值</td>
</tr>
<tr>
<td>shardscripts</td>
<td>无论有多少个日志匹配到，都只执行一次prerotate或postrotate的脚本</td>
</tr>
<tr>
<td>noshardscripts</td>
<td>针对每一个日志，都执行一次prerotate或postrotate脚本，此为默认值</td>
</tr>
</tbody></table>
<p>范例：Nginx的日志转储</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;apps&#x2F;nginx&#x2F;logs&#x2F;*.log &#123;</span><br><span class="line">        daily</span><br><span class="line">        rotate 100</span><br><span class="line">        missingok</span><br><span class="line">        notifempty</span><br><span class="line">        create 644 nginx nginx</span><br><span class="line">        postrotate</span><br><span class="line">          if [ -f &#x2F;apps&#x2F;nginx&#x2F;logs&#x2F;nginx.pid ];then</span><br><span class="line">                kill -USR1 &#96;cat &#x2F;apps&#x2F;nginx&#x2F;logs&#x2F;nginx.pid&#96;</span><br><span class="line">          fi</span><br><span class="line">        endscript</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>范例：手动转储</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logrotate -vf &#x2F;etc&#x2F;logrotate</span><br></pre></td></tr></table></figure>














      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/11/18/%E6%97%A5%E5%BF%97%E7%AE%A1%E7%90%86-rsyslog/" data-id="ckhnf9hej000440utenfabfi1" data-title="" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2020/11/18/%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91MYSQL8.0/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          (no title)
        
      </div>
    </a>
  
  
    <a href="/2020/11/18/%E5%8A%A0%E5%AF%86%E5%92%8C%E5%AE%89%E5%85%A8/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title"></div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/" rel="tag">hexo</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/hexo/" style="font-size: 10px;">hexo</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/11/18/%E8%BF%90%E7%BB%B4%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2/">(no title)</a>
          </li>
        
          <li>
            <a href="/2020/11/18/%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91MYSQL8.0/">(no title)</a>
          </li>
        
          <li>
            <a href="/2020/11/18/%E6%97%A5%E5%BF%97%E7%AE%A1%E7%90%86-rsyslog/">(no title)</a>
          </li>
        
          <li>
            <a href="/2020/11/18/%E5%8A%A0%E5%AF%86%E5%92%8C%E5%AE%89%E5%85%A8/">(no title)</a>
          </li>
        
          <li>
            <a href="/2020/11/18/%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85MySQL%E8%84%9A%E6%9C%AC/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2020 huihui<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>