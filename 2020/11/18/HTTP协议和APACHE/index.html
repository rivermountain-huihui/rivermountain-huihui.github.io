<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="HTTP协议和APACHE杂谈HTTP协议 Httpd是软件包和运行程序名，Apache是服务名称 网络连接五个元素：  协议 源地址 源端口 目的地址 目的端口  Apache并发最高1万连接 Nginx并发最高10万连接 HTTP协议分层： TCP&#x2F;IP分层：4层 OSI参考模型分层：7层 参考学习网站： W3school 1https:&#x2F;&#x2F;www.w3school.com.cn&#x2F;index.">
<meta property="og:type" content="article">
<meta property="og:title" content="HTTP协议和APACHE">
<meta property="og:url" content="http://example.com/2020/11/18/HTTP%E5%8D%8F%E8%AE%AE%E5%92%8CAPACHE/index.html">
<meta property="og:site_name" content="辉辉的数据库">
<meta property="og:description" content="HTTP协议和APACHE杂谈HTTP协议 Httpd是软件包和运行程序名，Apache是服务名称 网络连接五个元素：  协议 源地址 源端口 目的地址 目的端口  Apache并发最高1万连接 Nginx并发最高10万连接 HTTP协议分层： TCP&#x2F;IP分层：4层 OSI参考模型分层：7层 参考学习网站： W3school 1https:&#x2F;&#x2F;www.w3school.com.cn&#x2F;index.">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="c:/Users/a/AppData/Roaming/Typora/typora-user-images/image-20201028191354432.png">
<meta property="og:image" content="c:/Users/a/AppData/Roaming/Typora/typora-user-images/image-20201028191754710.png">
<meta property="article:published_time" content="2020-11-18T00:48:10.000Z">
<meta property="article:modified_time" content="2020-11-19T00:45:21.247Z">
<meta property="article:author" content="huihui">
<meta property="article:tag" content="notes">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="c:/Users/a/AppData/Roaming/Typora/typora-user-images/image-20201028191354432.png">

<link rel="canonical" href="http://example.com/2020/11/18/HTTP%E5%8D%8F%E8%AE%AE%E5%92%8CAPACHE/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>HTTP协议和APACHE | 辉辉的数据库</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">辉辉的数据库</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">我们要丈量大地！</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/11/18/HTTP%E5%8D%8F%E8%AE%AE%E5%92%8CAPACHE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="huihui">
      <meta itemprop="description" content="学习和看笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="辉辉的数据库">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          HTTP协议和APACHE
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-11-18 08:48:10" itemprop="dateCreated datePublished" datetime="2020-11-18T08:48:10+08:00">2020-11-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-11-19 08:45:21" itemprop="dateModified" datetime="2020-11-19T08:45:21+08:00">2020-11-19</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="HTTP协议和APACHE"><a href="#HTTP协议和APACHE" class="headerlink" title="HTTP协议和APACHE"></a>HTTP协议和APACHE</h1><h2 id="杂谈"><a href="#杂谈" class="headerlink" title="杂谈"></a>杂谈</h2><p>HTTP协议</p>
<p>Httpd是软件包和运行程序名，Apache是服务名称</p>
<p>网络连接五个元素：</p>
<ul>
<li>协议</li>
<li>源地址</li>
<li>源端口</li>
<li>目的地址</li>
<li>目的端口</li>
</ul>
<p>Apache并发最高1万连接</p>
<p>Nginx并发最高10万连接</p>
<p>HTTP协议分层：</p>
<p>TCP/IP分层：4层</p>
<p>OSI参考模型分层：7层</p>
<p>参考学习网站：</p>
<p>W3school</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">https://www.w3school.com.cn/index.html</span></span><br></pre></td></tr></table></figure>



<a id="more"></a>

<h2 id="1"><a href="#1" class="headerlink" title="1"></a>1</h2><h3 id="1-1-HTTP-超文本传输协议"><a href="#1-1-HTTP-超文本传输协议" class="headerlink" title="1.1 HTTP 超文本传输协议"></a>1.1 HTTP 超文本传输协议</h3><p>Hyper Text Transfer Protocol</p>
<p>互联网：是世界的网络，是所有类型网络的母集</p>
<p>因特网：世界上最大的互联网网络，即因特网属于互联网概念</p>
<p>万维网：WWW   B/S架构，Browser和Server，万维网并非是一个特殊的计算机网络，而是一个大规模的、联机式的信息贮藏库，使用链接的方法能非常方便地从因特网上的一个站点访问另一个站点（超链接），具有提供分布式服务的特点。万维网是一个分布式的超媒体系统，是超文本系统的扩充。万维网是一个互联网的应用系统，采用HTTP、HTTPS的传输协议。因特网上还有其他应用系统，比如FTP、SMTP。</p>
<p>URL：统一资源定位符（Uniform Resource Locator） ，用来标识万维网上的各种文档，并使每个文档在整个因特网的范围内具有唯一的标识符</p>
<p>HTTP：协议，为了解决<code>用什么样的网络协议来实现整个因特网上的万维网文档的传输</code>这一问题而产生，规定了文档发送端和接收端之间的通信流程，Hyper Text Transfer Protocol。</p>
<p>HTML：文档格式 超文本标记语言，为了解决<code>怎么使不同创作者创作的不同风格的万维网文档，都能在因特网上的各种主机上显示出来，同时使用户清楚地知道在什么地方存在着链接</code>这一问题而产生。Hyper Text Markup Language，它可以使人们方便地使用链接从页面的某处链接到因特网的任何万维网页面。</p>
<h3 id="打开一个网页发生了什么之浏览器是如何工作的"><a href="#打开一个网页发生了什么之浏览器是如何工作的" class="headerlink" title="打开一个网页发生了什么之浏览器是如何工作的"></a>打开一个网页发生了什么之浏览器是如何工作的</h3><p>1.在浏览器中输入域名</p>
<p>2.浏览器检查本机DNS缓存，如果有该域名的缓存就调用，如果没有就向本地DNS服务器发起递归查询，询问域名对应的IP</p>
<p>3.本地DNS服务器收到浏览器请求后，查询服务器DNS缓存，如果有该域名的缓存就调用，把域名对应的IP地址返回给浏览器，如果没有该域名的缓存，那么就检查服务器是否有该域名顶级域服务器的缓存，如果有，就向顶级域发起迭代查询，一路向下询问该域名的地址，直到接收到该域名主机的IP地址为止；如果没有该域名的顶级域服务器缓存，那么就向DNS根服务器发起迭代查询，直到接收到该域名主机的IP地址，当然这样的情况很少了，绝大多数本地DNS服务器都会缓存各个顶级域的缓存，减少向根域服务器的查询。本地DNS服务器接收到IP后，把该IP返回给浏览器。这里还有一个CDN，内容分发网络，Content Delivery Network，它是一种可以根据用户所在位置(其实是用户本地DNS服务器所在位置)，来把就近的本网站的服务器IP地址返回给用户，从而让用户和服务器之间的距离变短，访问变快的一种网络架构。它的工作流程是这样的：网站的架构师在注册本网站的域名和IP地址关系的时候，不会写上真正的web服务器的IP地址，而是写上一个别名，CNAME，以及CNAME对应的IP地址，而这个CNAME所对应的IP地址的主机是干嘛的呢？它是一个使用了GSLB技术的基于DNS实现的服务器，GSLB，Global Server Load Balance，全局负载均衡技术，它能干嘛呢？它能根据向它发起询问的本地DNS服务器的IP地址，判断出这个DNS服务器的地理位置，然后把距离这个位置最近的、这个网站的服务器IP地址发送给本地DNS，让本地DNS把这个IP地址返回给浏览器，从而让浏览器直接去访问这个最近的主机，从而减少服务器网络和用户网络之间的距离，让用户的访问可以更快速，得到响应更快速。而为什么用户访问的明明不是原本想要访问的web主机，还能获得几乎一样的内容呢？那是因为使用了CDN架构，它是一种把源web服务器上的内容分发到全国各地的人口较多的城市中的其他web服务器上的一种架构。每一个本地的web服务器都会响应本地用户的请求，但是它服务器上的内容是要不断地从主服务器或其他临近的本地服务器上获取来的，网站管理人员不会直接在本地web服务器上进行内容修改。当用户访问的资源在本地web服务器上有时，它直接返回给用户；当用户访问的资源在本地web服务器上没有时，它会向邻居的其他本地web服务器进行查询，如果其他本地web服务器上有这个资源，就拷贝过来，然后存住，然后把资源返回给用户，如果其他本地web服务器没有这个资源时，那么它需要通过专用的网络去访问源web服务器，去获取资源，然后保存在本地，然后返回给用户。</p>
<p>4.浏览器接收到域名对应的IP后，向该IP发起访问基于HTTP协议的请求，HTTP请求从浏览器应用生成，叫HTTP请求报文，然后根据TCP/IP协议，浏览器程序的进程把HTTP请求报文通过TCP协议套接字传送给传输层、网络层、链路层、物理层从而发往该主机，再经过物理层、链路层、网络层、传输层，通过该主机的TCP套接字进入该主机对应的监听进程中去，这里面重点要说的是TCP协议的连接建立和断开，TCP是一种面向连接的传输协议，可以保证传输的完整性。TCP连接的建立是三次握手，首先客户端向服务器端发出连接申请，服务器端接收该报文段，判断是否同意与客户端建立连接，如果不同意就返回拒绝，连接拒绝；如果同意，那么就向客户端发出同意连接报文段和同步请求，这个时候的服务器端已经进入了同步接收状态，客户端收到报文段后，为了减少服务器的性能浪费，还会向服务器端发送同意报文段，这样客户端和服务器端就建立了连接。为什么要三次握手？</p>
<p>TCP断开连接是四次挥手，TCP客户端向服务器端发出连接终止请求，此时客户端进入终止等待1状态，服务器端收到请求后，如果不同意，会向客户端发出不同意请求；如果同意，会向客户端发出同意请求，同时如果还有数据没发送完成，就继续把没有发送完的数据发送完，服务器端此时进入关闭等待状态；客户端收到同意请求后，进入终止等待2状态，同时等待服务器端的终止请求，这个时候客户端不会向服务器端发送数据了，客户端到服务器端的连接被释放了，这叫做TCP的半关闭状态；服务器端把数据发送完毕后，向客户端发出终止请求，此时服务器端进入最后确认状态；客户端收到终止请求后，向服务器端回复同意报文，然后等待2MSL后，关闭连接；服务器端收到同意报文后，关闭连接。为什么有第四次挥手？</p>
<p>5.TCP连接建立后，开始通过套接字进行与应用层的通信，套接字Socket是进程间通信IPC的一种实现，允许位于不同主机的不同进程之间的通信和数据交换，Socket API是实现socket的方式，Socket有两个标志：IP地址和端口，合称为套接字地址，Socket Address，客户端套接字地址定义了唯一的客户进程，服务器套接字地址定义了唯一的服务器进程。</p>
<p>我认为socket API就是操作系统中传输层的体现，因为IP地址和端口本就是传输层的东西；socket是一个逻辑层面的东西，介于应用层和传输层之间；</p>
<p>Socket API介绍：</p>
<p>Socket API封装了内核中所提供的socket通信相关的系统调用，包括：</p>
<p>Socket Domain：</p>
<ul>
<li>AF_INET：Address Family ，IPV4</li>
<li>AF_INET6：IPV6</li>
<li>AF_UNIX：同一主机上不同进程之间通信时使用的</li>
</ul>
<p>Socket Type：根据使用的传输层协议</p>
<ul>
<li>SOCK_STREAM：流，tcp套接字，可靠地传递、面向连接</li>
<li>SOCK_DGRAM：数据报，udp套接字，不可靠地传递、无连接</li>
<li>SOCK_RAW：裸套接字，无须tcp或udp，APP直接通过IP包通信</li>
</ul>
<p>套接字相关的系统调用：</p>
<ul>
<li>socket() 创建一个套接字</li>
<li>bind() 绑定IP和端口</li>
<li>listen() 监听</li>
<li>accept() 接收请求</li>
<li>connect() 请求连接建立</li>
<li>write() 发送</li>
<li>read() 接收</li>
<li>close() 关闭连接</li>
</ul>
<p>6.开始进行以应用层的HTTP协议通讯，目前HTTP协议是2.0和1.1混合使用的，浏览器向服务器端发出获取资源的申请，比如说GET方法<code>GET /images/1.jpg  HTTP/2.0</code>，然后服务器返回请求，比如<code>HTTP/2.0 200 0K</code>，同时返回数据内容</p>
<h3 id="web前端开发语言："><a href="#web前端开发语言：" class="headerlink" title="web前端开发语言："></a>web前端开发语言：</h3><p>html：超文本标记语言，用于规定www的统一的文档格式</p>
<p>css：格式套用</p>
<p>javascript：实现网页动画效果，但是属于静态资源</p>
<p>静态资源和动态资源的区别：</p>
<p>服务器端的资源和发送给客户端的资源是否一致，一致的是静态资源，不一致的是动态资源</p>
<h3 id="MIME"><a href="#MIME" class="headerlink" title="MIME"></a>MIME</h3><p>MIME：多用途互联网邮件扩展</p>
<p><code>/etc/mime.types</code>，里面写了服务器支持的数据类型，来源于mailcap包</p>
<p>多种资源的传输</p>
<h3 id="URI和URL"><a href="#URI和URL" class="headerlink" title="URI和URL"></a>URI和URL</h3><p>URI：Uniform Resource Identifier 统一资源标识，URI分为了URN和URL</p>
<p>URN：Uniform Resource Nameing 统一资源命名</p>
<p>例如：<code>P2P下载中使用的磁力链接</code>  P2P协议</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">magnet:?xt&#x3D;urn:btih:xxxxxxxxxxxxxxxxxxxx</span><br></pre></td></tr></table></figure>

<p>URL：Uniform Resource Locator 统一资源定位符</p>
<p>URL的格式：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;schema&gt;://&lt;user&gt;:&lt;password&gt;@&lt;host&gt;:&lt;port&gt;/&lt;path&gt;;&lt;params&gt;?&lt;query&gt;#&lt;frag&gt;</span><br><span class="line">参数说明：</span><br><span class="line"><span class="attribute">schema：方案，访问服务器使用什么协议</span></span><br><span class="line"><span class="attribute"></span>: 分隔符</span><br><span class="line">// 指定url的人规定有的，应该是没有意义的</span><br><span class="line"><span class="attribute">user：用户名</span></span><br><span class="line"><span class="attribute">password：密码</span></span><br><span class="line"><span class="attribute">host：主机</span></span><br><span class="line"><span class="attribute">port：端口</span></span><br><span class="line"><span class="attribute">path：资源在服务器上的路径</span></span><br><span class="line"><span class="attribute">params：参数，指定传入的参数</span></span><br><span class="line"><span class="attribute">query：查询，传递参数给程序，比如给数据库，用?分隔，多个参数使用&amp;分隔</span></span><br><span class="line"><span class="attribute">frag：fragment，片段，一小片或一部分资源的名字，此组件在客户端使用，用#分隔</span></span><br></pre></td></tr></table></figure>

<p>apache的官网：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">httpd.apache.org</span><br></pre></td></tr></table></figure>



<h3 id="网站访问量统计"><a href="#网站访问量统计" class="headerlink" title="网站访问量统计"></a>网站访问量统计</h3><ul>
<li>IP：通过IP计算，一天内来自相同客户机的IP地址只算一次</li>
<li>PV：Page View，通过页面刷新计算</li>
<li>UV：Unique Visitor，通过cookie统计</li>
<li>QPS：Request Per Seconds，每秒请求数</li>
</ul>
<h3 id="HTTP的工作机制"><a href="#HTTP的工作机制" class="headerlink" title="HTTP的工作机制"></a>HTTP的工作机制</h3><p><strong>一次http事务包括：</strong></p>
<ul>
<li>http请求：http request</li>
<li>http响应：http response</li>
</ul>
<p><strong>Web资源：</strong>web resource，一个网页由多个资源构成，打开一个页面，通常会有多个资源展示出来，但是每个资源都要单独请求。因此，一个“web页面“通常并不是单个资源，而是一组资源的集合</p>
<p><strong>资源分类：</strong></p>
<p>​    静态资源：</p>
<p>​    .javascript，.css，.html</p>
<p>​    动态资源：</p>
<p>​    .php，.jsp，.asp</p>
<h3 id="HTTP连接请求-？"><a href="#HTTP连接请求-？" class="headerlink" title="HTTP连接请求 ？"></a>HTTP连接请求 ？</h3><p>串行和并行：</p>
<ul>
<li>串行：每次发起TCP连接完成一个事务，然后断开连接，下一次事务还需要建立TCP连接</li>
<li>并行：通过多条TCP连接发起并行的HTTP请求</li>
</ul>
<p>串行，持久连接和管道</p>
<ul>
<li>持久连接：keep-alive，重用TCP连接，以消除多次连接和关闭的时延，以事务个数和时间来决定是否关闭连接</li>
<li>管道：通过共享TCP连接，发起并行的连接</li>
</ul>
<p>提升HTTP连接性能：管道化的持久连接，还有个实验阶段的，复用的连接，交替传送请求和相应报文</p>
<h3 id="HTTP协议版本"><a href="#HTTP协议版本" class="headerlink" title="HTTP协议版本"></a>HTTP协议版本</h3><p><strong>http/0.9：</strong></p>
<p>最初的版本，只有一个命令GET，只支持一个格式，HTML</p>
<p><strong>http/1.0：</strong></p>
<ul>
<li>每个TCP连接只能发送一个请求，发送数据完毕，连接就关闭，如果还要请求其他资源，就必须再新建一个连接</li>
<li>引入了post和head命令</li>
<li>头信息是ASCII码，后面数据可以是任何格式。服务器会告诉客户端，数据是什么格式，即 Content-Type字段</li>
</ul>
<p><strong>http/1.1：</strong>1997年</p>
<ul>
<li>引入了持久连接，persistence connection，即TCP默认不关闭，可以被多个请求复用。对于同一个域名，大多数浏览器允许建立6个持久连接，引入了管道机制，即在同一个TCP连接中，客户端可以同时发送多个请求，近一步改善了HTTP协议的效率</li>
<li>新增方法：PUT、PATCH、OPTIONS、DELETE</li>
<li>同一个TCP连接里，所有数据通信都是有序进行的，服务器只能顺序处理回应，前面的回应慢，会有许多请求排队，造成“队头阻塞”(Head-of-line blocking)，为了避免这种情况，要：减少请求数、同时开放多个持久连接</li>
</ul>
<h3 id="http-1-0和http-1-1存在的区别"><a href="#http-1-0和http-1-1存在的区别" class="headerlink" title="http/1.0和http/1.1存在的区别"></a>http/1.0和http/1.1存在的区别</h3><ul>
<li>缓存处理方法，在HTTP1.0中主要是使用header中的If-Modified-Since，Expires来作为缓存判断的标准，HTTP1.1则引入了更多的缓存控制策略，如Entity tag，If-Unmodified-Since，If-Match，If-None-Match等更多可供选择的缓存头来控制缓存策略</li>
<li>带宽优化以及网络连接的使用，在HTTP1.0中，存在一些浪费带宽的现象，例如，客户端只需要某个对象的一部分，但服务器只能将整个对象发送给客户端，并且不支持断点续传功能，HTTP1.1则在请求头引入了range头域，它允许只请求资源的某个部分，即返回码是206（Partial Content），方便了开发者自由的选择以便于充分利用带宽和连接</li>
<li>错误通知的管理，在HTTP1.1中新增24个状态相应码，如409（Conflict）表示请求的资源与资源当前状态冲突；410（Gone）表示服务器上的某个资源被永久性的删除</li>
<li>Host头处理，HTTP1.0默认每台服务器绑定一个IP地址，因此URL中没有hostname；HTTP1.1的请求和响应报文中都有host，而且请求中如果没有host头会报告错误400（Bad Request）</li>
<li>长连接，HTTP1.1支持持久连接和管道，在一个TCP连接上可以处理多个请求，减少了建立和关闭连接的消耗和延迟，HTTP1.0没有</li>
</ul>
<p><strong>HTTP1.X共同的问题：</strong></p>
<ul>
<li>安全问题，HTTP1.X传输过程内容都是明文</li>
<li>HTTP1.X在传输连接时，每次都需要重新建立连接，这增大了延迟</li>
<li>HTTP1.X在使用时，header里携带的内容过大，增加了传输的成本，并且每次请求header基本不怎么变化，尤其在移动端增加用户流量</li>
<li>HTTP1.1支持了keep-alive虽然弥补了多次连接产生的延迟，但是keep-alive本身用多了也会给服务器端带来大量的性能压力，并且对于单个文件被多次请求的服务，keep-alive会极大的影响性能，因为它会在连接建立后还保持一段时间的连接</li>
</ul>
<p><strong>HTTPS：</strong>HTTP+TLS 正式版是2000年</p>
<ul>
<li>HTTPS协议需要使用证书，证书需要到CA申请，需要花钱</li>
<li>HTTPS运行在TCP+TLS之上，内容都是被加密的</li>
<li>HTTP和HTTPS使用的是不同的连接方式，HTTPS是443端口</li>
<li>HTTPS实现过程会降低访问速度，但是优化优化还是可以接受的，毕竟安全多了</li>
</ul>
<p><strong>HTTP2.0</strong>：2015年</p>
<ul>
<li>头信息和数据体都是二进制，称为头信息帧和数据帧</li>
<li>复用TCP连接，在一个连接里，客户端和浏览器都可以同时发送多个请求或回应，且不用按顺序一一对应，避免了“队头阻塞”，此双向的实时通信称为多工(Multiplexing)</li>
<li>引入头信息压缩机制（header compression），头信息使用gzip或compress压缩后再发送；客户端和服务器同时维护一张头信息表，所有字段都会存入这个表，生成一个索引号，不发送同样字段，只发送索引号，提高速度</li>
<li>HTTP/2.0允许服务器未经请求，主动向客户端发送数据，即服务器推送（server push）</li>
</ul>
<h3 id="HTTP请求访问的完整过程"><a href="#HTTP请求访问的完整过程" class="headerlink" title="HTTP请求访问的完整过程"></a>HTTP请求访问的完整过程</h3><p>复用的多线程I/O结构</p>
<p>7个过程</p>
<p><strong>1.建立连接：</strong>接收或拒绝连接请求</p>
<p><strong>2.接收请求：</strong>接收客户端请求报文中对某资源的一次请求过程</p>
<ul>
<li>单进程I/O模型：启动一个进程处理用户请求，而且每次只处理一个，多个请求被串行响应</li>
<li>多进程I/O模型：并行启动多个进程，每个进程响应一个连接请求</li>
<li>复用I/O结构：启动一个进程，同时响应N个连接请求</li>
<li>复用的多进程I/O模型：启动M个进程，每个进程响应N个连接请求，同时接收M*N个请求</li>
</ul>
<p><strong>3.处理请求：</strong>服务器对请求报文进行解析，并获取请求的资源及请求方法等相关信息，根据方法，资源，首部和可选的主体部分对请求进行处理</p>
<ul>
<li>常用的请求方法：GET、POST、HEAD、PUT、DELETE、TRACE、OPTIONS</li>
</ul>
<p><strong>4.访问资源：</strong>服务器获取请求报文中请求的资源web服务器，即存放了web资源的服务器，负责向请求者提供对方请求的静态资源，或动态运行后生成的资源</p>
<p><strong>5.构建响应报文：</strong>一旦web服务器识别出了资源，就执行请求方法中描述的动作，并返回响应报文。响应报文中包含有响应状态码、响应首部，如果生成了响应主体，还包括响应实体。</p>
<p>1）响应实体：如果事务处理产生了响应实体，就将内容放在响应报文中会送回去。响应报文中包括：</p>
<ul>
<li>描述了响应主体MIME类型的Content-Type首部</li>
<li>描述了响应主体长度的Content-Length</li>
<li>实际报文的主体内容</li>
</ul>
<p>2）URL重定向：web服务构建的响应并非客户端请求的资源，而是资源另外一个访问路径</p>
<p>3）MIME类型：web服务器要负责确定响应主体的MIME类型。多种配置服务器的方法可以将MIME类型与资源管理起来</p>
<p><strong>6.发送响应报文：</strong>web服务器通过连接发送响应数据也会面临与接收数据一样的问题，服务器可能有很多条到各个客户端的连接，有些是空闲的，有些在向服务器发送数据，还有一些在想客户端会送响应数据。服务器要记录连接的状态，还要特别注意对持久连接的处理。非持久连接可以自己关闭，持久连接需要服务器端确定怎么关闭、什么时候关闭，所以服务器端要计算好Content-Length首部，不然客户端就无法知道响应什么时候结束。</p>
<p><strong>7.记录日志：</strong>最后，当事务结束，web服务器会在日志文件中添加一个条目，来描述已执行的事务</p>
<h2 id="2-HTTPD安装和组成"><a href="#2-HTTPD安装和组成" class="headerlink" title="2 HTTPD安装和组成"></a>2 HTTPD安装和组成</h2><h3 id="1-常见HTTP服务器程序"><a href="#1-常见HTTP服务器程序" class="headerlink" title="1.常见HTTP服务器程序"></a>1.常见HTTP服务器程序</h3><ul>
<li>httpd Apache，存在C10K问题（10K connections）</li>
<li>Nginx 解决C10K问题</li>
</ul>
<p>官方帮助文档：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://httpd.apache.org/docs/current/</span></span><br></pre></td></tr></table></figure>

<h3 id="2-Apache介绍"><a href="#2-Apache介绍" class="headerlink" title="2.Apache介绍"></a>2.Apache介绍</h3><p>目前版本：httpd 2.4</p>
<p>Apache特性：</p>
<ul>
<li>高度模块化：core + modules</li>
<li>DSO：Dynamic Shared Object 动态加载/卸载共享库</li>
<li>MPM：Multi-Processing Module 多路处理模块</li>
</ul>
<p>Apache功能：</p>
<ul>
<li>反向代理</li>
<li>负载均衡</li>
<li>路径别名</li>
<li>丰富的用户认证机制：basic，digest</li>
<li>支持第三方模块</li>
</ul>
<h3 id="MPM-multi-processing-module"><a href="#MPM-multi-processing-module" class="headerlink" title="MPM multi-processing module"></a>MPM multi-processing module</h3><ul>
<li><p><strong>prefork：</strong>预派生模式–&gt;多进程I/O结构–&gt;一个进程一个线程，一个请求一个进程，请求几个就开几个进程；</p>
<p>CentOS7的httpd默认模式</p>
<p> 一个主进程，生成和回收多个子进程，创建套接字，不响应请求</p>
<p>多个子进程，工作进程，每个子进程处理一个请求</p>
<p>系统初始化时，默认预先生成几个子进程等待请求</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ pstree -p | grep httpd</span><br><span class="line">           |-httpd(2895)-+-httpd(2896)</span><br><span class="line">           |             |-httpd(2897)</span><br><span class="line">           |             |-httpd(2898)</span><br><span class="line">           |             |-httpd(2899)</span><br><span class="line">           |             &#96;-httpd(2900)</span><br></pre></td></tr></table></figure>

<p>这种模式稳定，占内容，适用于访问量不大的场景</p>
</li>
<li><p><strong>worker：</strong>复用的多进程I/O模型，多线程多进程，Windows的IIS使用此模型</p>
<p>一个主进程，生成多个m子进程，每个子进程负责生n个线程，每个线程响应一个请求，并发响应</p>
<p>请求：m * n</p>
<p>worker MPM是一种多进程多线程混合的模型，有一个控制进程，启动多个子进程，每个子进程里面包含固定数量的线程，使用线程来处理请求，当线程不够用的使用再启动一个新的子进程，然后在子进程里面再启动线程去处理请求，由于它使用了线程处理请求，因此可以承受更高的并发。</p>
<p>优点：相比prefork占用的内存少，可以处理更多的请求</p>
<p>缺点：使用keep-alive的长连接方式，某个线程会一直被占用，即使没有数据传输，也一定要等到超时才能断开连接，如果过多的线程被这样占用，会导致在高并发情况下的无服务线程可用的情况</p>
</li>
<li><p><strong>event：</strong>事件驱动模式；CentOS8默认模式</p>
<p> event是worker模式的进步改良，它也是一个主进程生成m个子进程，子进程再生成n个线程，每个线程接收一个请求，但是它改进了一点，它的每个子进程的一个线程是监听线程，专门对其他线程进行管理。当有真实请求来临的时候，监工线程把一个线程分配给这个请求，当这个线程执行完毕后，工作线程会把接下来的会话监听工作交给监工线程，自己去处理新的请求。而监工进程会监听会话，如果超时，监工线程就把这个socket删除。</p>
<p>利用了TCP的一个选项TCP_DEFER_ACCEPT，只有数据发送的时候才开始建立连接。这样可以实现简单的防攻击（大量TCP连接）</p>
<p>优点：单线程响应多请求，占用更少的内存，高并发下表现更优秀，会有一个专门的线程来管理keep-alive类型的线程，当有请求过来的时候，将请求传递给服务线程，执行完毕后，又运行它释放</p>
<p>缺点：没有线程安全控制？</p>
</li>
</ul>
<h3 id="3-相关文件"><a href="#3-相关文件" class="headerlink" title="3.相关文件"></a>3.相关文件</h3><h4 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a><strong>配置文件</strong></h4><ul>
<li>/etc/httpd/conf/httpd.conf  主配置文件</li>
<li>/etc/httpd/conf.d/*.conf  子配置文件</li>
<li>/etc/httpd/conf.d/conf.modules.d/  模块加载的配置文件</li>
</ul>
<p>配置文件的组成：</p>
<ul>
<li>Global Environment</li>
<li>Main Server Configuration</li>
<li>Virtual Host</li>
</ul>
<p>格式说明：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">directive value</span><br><span class="line">指令 值</span><br></pre></td></tr></table></figure>



<h4 id="服务单元文件："><a href="#服务单元文件：" class="headerlink" title="服务单元文件："></a>服务单元文件：</h4><ul>
<li>/lib/systemd/system/httpd.service  服务管理文件</li>
<li>/etc/sysconfig/httpd     给service文件提供变量，如果在服务启动或停止中有什么想写的变量可以写在这里</li>
</ul>
<h4 id="语法检查命令：http-t"><a href="#语法检查命令：http-t" class="headerlink" title="语法检查命令：http -t"></a>语法检查命令：<code>http -t</code></h4><h4 id="控制工具：apachectl"><a href="#控制工具：apachectl" class="headerlink" title="控制工具：apachectl"></a>控制工具：<code>apachectl</code></h4><h4 id="站点网页文档存放目录：-var-www-html"><a href="#站点网页文档存放目录：-var-www-html" class="headerlink" title="站点网页文档存放目录：/var/www/html"></a>站点网页文档存放目录：/var/www/html</h4><h4 id="模块文件存放路径："><a href="#模块文件存放路径：" class="headerlink" title="模块文件存放路径："></a>模块文件存放路径：</h4><ul>
<li>/etc/httpd/modules</li>
<li>/usr/lib64/httpd/modules</li>
</ul>
<h4 id="日志路径：-var-log-httpd"><a href="#日志路径：-var-log-httpd" class="headerlink" title="日志路径：/var/log/httpd"></a>日志路径：/var/log/httpd</h4><ul>
<li>access_log：访问日志</li>
<li>error_log：错误日志</li>
</ul>
<h3 id="4-编译安装"><a href="#4-编译安装" class="headerlink" title="4.编译安装"></a>4.编译安装</h3><p>Centos7上由于APR版本低，编译2.4版本的HTTPD会失败，因此要先编译安装一个APR</p>
<p>ABI：Application binary interface</p>
<p>API：Application Programming interface</p>
<p>APR：Apache Portable Run-time libraries，Apache可移植运行库，Apache强依赖于这个库</p>
<p>编译安装HTTPD脚本，记得要把APR的编译加入</p>
<p>下载HTTPD的地址</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;apache&#x2F;&#x2F;httpd&#x2F;httpd-2.4.46.tar.bz2</span><br></pre></td></tr></table></figure>

<p>下载APR的地址</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;mirrors.bfsu.edu.cn&#x2F;apache&#x2F;&#x2F;apr&#x2F;apr-1.7.0.tar.gz</span><br></pre></td></tr></table></figure>

<p>下载APR-util的地址</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;mirrors.bfsu.edu.cn&#x2F;apache&#x2F;&#x2F;apr&#x2F;apr-util-1.6.1.tar.gz</span><br></pre></td></tr></table></figure>

<p>APR的这两个包下载完，解压，然后把解压出来的内容都放到HTTPD解压的文件夹下</p>
<p><code>/httpd_source_tree_root/srclib/apr</code> and <code>/httpd_source_tree_root/srclib/apr-util</code></p>
<p>然后在配置的时候加上<code>./configure --with-included-apr</code>，这样就可以一起编译安装了</p>
<p>依赖的软件包：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install gcc make pcre-devel openssl-devel expat-devel bzip2</span><br></pre></td></tr></table></figure>

<p>开始编译</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">cd httpd-2.4.26</span><br><span class="line">➜  httpd-2.4.46 .&#x2F;configure \</span><br><span class="line">&gt; --prefix&#x3D;&#x2F;apps&#x2F;httpd \</span><br><span class="line">&gt; --enable-so \</span><br><span class="line">&gt; --enable-ssl \</span><br><span class="line">&gt; --enable-cgi \</span><br><span class="line">&gt; --enable-rewrite \</span><br><span class="line">&gt; --with-zlib \</span><br><span class="line">&gt; --with-pcre \</span><br><span class="line">&gt; --with-included-apr \</span><br><span class="line">&gt; --enable-modules&#x3D;most \</span><br><span class="line">&gt; --enable-mpms-shared&#x3D;all \</span><br><span class="line">&gt; --with-mpm&#x3D;prefork</span><br><span class="line"></span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>

<p>创建用户和组</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">useradd -r -s /sbin/nologin -M -d /apps/httpd  -U apache</span><br><span class="line">vim /apps/httpd/conf/httpd.conf</span><br><span class="line">User daemon</span><br><span class="line">Group daemon  都改成 apache</span><br></pre></td></tr></table></figure>

<p>修改环境变量</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/profile.d/httpd.sh</span><br><span class="line">PATH=/apps/httpd/bin:<span class="variable">$PATH</span></span><br></pre></td></tr></table></figure>

<p>修改帮助文档</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim &#x2F;etc&#x2F;man_db.conf</span><br><span class="line">MANDATORY_MANPATH       &#x2F;apps&#x2F;httpd&#x2F;man</span><br></pre></td></tr></table></figure>

<p>创建service文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">  1 [Unit]</span><br><span class="line">  2 Description&#x3D;The Apache HTTP Server</span><br><span class="line">  3 After&#x3D;network.target remote-fs.target nss-lookup.target</span><br><span class="line">  4 Documentation&#x3D;man:httpd(8)</span><br><span class="line">  5 Documentation&#x3D;man:apachectl(8)</span><br><span class="line">  6 </span><br><span class="line">  7 [Service]</span><br><span class="line">  8 Type&#x3D;forking</span><br><span class="line">  9 ExecStart&#x3D;&#x2F;apps&#x2F;httpd&#x2F;bin&#x2F;apachectl -k start</span><br><span class="line"> 10 ExecReload&#x3D;&#x2F;apps&#x2F;httpd&#x2F;bin&#x2F;apachectl -k graceful</span><br><span class="line"> 11 ExecStop&#x3D;&#x2F;apps&#x2F;httpd&#x2F;bin&#x2F;apachectl -k stop</span><br><span class="line"> 12 # We want systemd to give httpd some time to finish gracefully, but still want</span><br><span class="line"> 13 # it to kill httpd after TimeoutStopSec if something went wrong during the</span><br><span class="line"> 14 # graceful stop. Normally, Systemd sends SIGTERM signal right after the</span><br><span class="line"> 15 # ExecStop, which would kill httpd. We are sending useless SIGCONT here to give</span><br><span class="line"> 16 # httpd time to finish.</span><br><span class="line"> 17 KillSignal&#x3D;SIGCONT                                                                      </span><br><span class="line"> 18 PrivateTmp&#x3D;true</span><br><span class="line"> 19 </span><br><span class="line"> 20 [Install]</span><br><span class="line"> 21 WantedBy&#x3D;multi-user.target</span><br><span class="line">~                                                      </span><br></pre></td></tr></table></figure>



<p>脚本：编译安装HTTPD 2.4.46</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env bash</span><br><span class="line">#</span><br><span class="line">#</span><br><span class="line">#Author:	lvzhehui</span><br><span class="line">#QQ:		734709865</span><br><span class="line">#Date:		2020-10-27</span><br><span class="line">#FileName:	install_httpd_2.4.46.sh</span><br><span class="line">#Descripting:	</span><br><span class="line">#Copyright (C):	2020 All rights reserved</span><br><span class="line"></span><br><span class="line">. &#x2F;etc&#x2F;init.d&#x2F;functions</span><br><span class="line"></span><br><span class="line">#定义软件的压缩包名称</span><br><span class="line">APR&#x3D;apr-1.7.0.tar.gz</span><br><span class="line">APR_UTIL&#x3D;apr-util-1.6.1.tar.gz</span><br><span class="line">HTTPD&#x3D;httpd-2.4.46.tar.bz2</span><br><span class="line">#取出.tar前的字符</span><br><span class="line">FILENAME_HTTPD&#x3D;$&#123;HTTPD%.tar*&#125;</span><br><span class="line">FILENAME_APR&#x3D;$&#123;APR%.tar*&#125;</span><br><span class="line">FILENAME_APR_UTIL&#x3D;$&#123;APR_UTIL%.tar*&#125;</span><br><span class="line">#定义下载目录和安装目录</span><br><span class="line">DOWNLOAD_DIR&#x3D;&#x2F;usr&#x2F;local&#x2F;src</span><br><span class="line">INSTALL_DIR&#x3D;&#x2F;apps&#x2F;httpd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">check_env ()</span><br><span class="line">&#123;</span><br><span class="line">    id apache &amp;&gt;&#x2F;dev&#x2F;null</span><br><span class="line">    if [ $? -eq 0 ];then</span><br><span class="line">        echo &quot;apache用户名已存在，脚本退出&quot;</span><br><span class="line">        exit 3</span><br><span class="line">    fi</span><br><span class="line">    if [ -d $&#123;INSTALL_DIR&#125; ];then</span><br><span class="line">        echo &quot;$&#123;INSTALL_DIR&#125;已存在，脚本退出&quot;</span><br><span class="line">        exit 3</span><br><span class="line">    fi</span><br><span class="line">    if [ -f $&#123;DOWNLOAD_DIR&#125;&#x2F;$&#123;HTTPD&#125; ];then</span><br><span class="line">        echo &quot;$&#123;DOWNLOAD_DIR&#125;目录下已存在$&#123;HTTPD&#125;，脚本退出&quot;</span><br><span class="line">        exit 3</span><br><span class="line">    fi</span><br><span class="line">    echo &quot;没有干扰项，可以进行安装！&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">install_httpd () </span><br><span class="line">&#123;</span><br><span class="line">    echo &quot;开始编译安装HTTPD&quot;</span><br><span class="line">    yum -y install install gcc make pcre-devel openssl-devel expat-devel bzip2 &amp;&gt;&#x2F;dev&#x2F;null \</span><br><span class="line">    &amp;&amp; action &quot;依赖包安装完成!&quot; || &#123; action false &quot;安装依赖包失败&quot; ;exit 3; &#125; </span><br><span class="line">    mkdir -p &#x2F;apps&#x2F;httpd</span><br><span class="line">    useradd -r -s &#x2F;sbin&#x2F;nologin -d &#x2F;apps&#x2F;httpd -M -U -u 80 apache</span><br><span class="line">    echo &quot;开始下载压缩文件&quot;</span><br><span class="line">    cd $&#123;DOWNLOAD_DIR&#125;</span><br><span class="line">    wget https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;apache&#x2F;&#x2F;httpd&#x2F;$&#123;HTTPD&#125; &amp;&gt;&#x2F;dev&#x2F;null</span><br><span class="line">    wget https:&#x2F;&#x2F;mirrors.bfsu.edu.cn&#x2F;apache&#x2F;&#x2F;apr&#x2F;$&#123;APR&#125; &amp;&gt;&#x2F;dev&#x2F;null</span><br><span class="line">    wget https:&#x2F;&#x2F;mirrors.bfsu.edu.cn&#x2F;apache&#x2F;&#x2F;apr&#x2F;$&#123;APR_UTIL&#125; &amp;&gt;&#x2F;dev&#x2F;null</span><br><span class="line">    echo &quot;开始解压文件到：$&#123;DOWNLOAD_DIR&#125;&quot;</span><br><span class="line">    tar xf $&#123;HTTPD&#125; </span><br><span class="line">    tar xf $&#123;APR&#125; </span><br><span class="line">    tar xf $&#123;APR_UTIL&#125; </span><br><span class="line">    mv $&#123;FILENAME_APR&#125; $&#123;FILENAME_APR_UTIL&#125; $&#123;FILENAME_HTTPD&#125;&#x2F;srclib&#x2F;</span><br><span class="line">    mv $&#123;FILENAME_HTTPD&#125;&#x2F;srclib&#x2F;$&#123;FILENAME_APR&#125; $&#123;FILENAME_HTTPD&#125;&#x2F;srclib&#x2F;apr</span><br><span class="line">    mv $&#123;FILENAME_HTTPD&#125;&#x2F;srclib&#x2F;$&#123;FILENAME_APR_UTIL&#125; $&#123;FILENAME_HTTPD&#125;&#x2F;srclib&#x2F;apr-util</span><br><span class="line">    cd $&#123;FILENAME_HTTPD&#125;</span><br><span class="line">    #开始编译环节</span><br><span class="line">    .&#x2F;configure \</span><br><span class="line">    --prefix&#x3D;&#x2F;apps&#x2F;httpd \</span><br><span class="line">    --enable-so \</span><br><span class="line">    --enable-ssl \</span><br><span class="line">    --enable-cgi \</span><br><span class="line">    --enable-rewrite \</span><br><span class="line">    --with-zlib \</span><br><span class="line">    --with-pcre \</span><br><span class="line">    --with-included-apr \</span><br><span class="line">    --enable-modules&#x3D;most \</span><br><span class="line">    --enable-mpms-shared&#x3D;all \</span><br><span class="line">    --with-mpm&#x3D;prefork &amp;&gt;&#x2F;dev&#x2F;null</span><br><span class="line">    if [ $? -eq 0 ];then</span><br><span class="line">        action &quot;Configuration successful!&quot;</span><br><span class="line">    else</span><br><span class="line">        action false &quot;Configuration false,please check .&#x2F;configure options&quot;</span><br><span class="line">        exit 3</span><br><span class="line">    fi</span><br><span class="line">    TIME_1&#x3D;&#96;date +%s&#96;</span><br><span class="line">    make &amp;&gt;&#x2F;dev&#x2F;null &amp;&amp; make install &amp;&gt;&#x2F;dev&#x2F;null</span><br><span class="line">    if [ $? -eq 0 ];then</span><br><span class="line">        action &quot;Making Finished&quot;</span><br><span class="line">        TIME_2&#x3D;&#96;date +%s&#96;</span><br><span class="line">        TIME_USED&#x3D;$(( TIME_2 - TIME2 ))</span><br><span class="line">    else</span><br><span class="line">        action false &quot;Making false&quot;</span><br><span class="line">        exit 3</span><br><span class="line">    fi</span><br><span class="line">    #编译完成，开始修改配置文件 </span><br><span class="line">    sed -i.bak -e &#39;s&#x2F;^User daemon&#x2F;User apache&#x2F;&#39; \</span><br><span class="line">        -e &#39;s&#x2F;^Group daemon&#x2F;Group apache&#x2F;&#39; $&#123;INSTALL_DIR&#125;&#x2F;conf&#x2F;httpd.conf</span><br><span class="line">    cat&gt;&#x2F;etc&#x2F;profile.d&#x2F;httpd.sh&lt;&lt;EOF</span><br><span class="line">PATH&#x3D;$&#123;INSTALL_DIR&#125;&#x2F;bin:\$PATH</span><br><span class="line">EOF</span><br><span class="line">    source &#x2F;etc&#x2F;profile.d&#x2F;httpd.sh</span><br><span class="line">    echo &quot;MANDATORY_MANPATH       $&#123;INSTALL_DIR&#125;&#x2F;man&quot; &gt;&gt; &#x2F;etc&#x2F;man_db.conf</span><br><span class="line">    #生成service文件</span><br><span class="line">    cat&gt;&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;httpd.service&lt;&lt;EOF</span><br><span class="line">[Unit]</span><br><span class="line">Description&#x3D;The Apache HTTP Server</span><br><span class="line">After&#x3D;network.target remote-fs.target nss-lookup.target</span><br><span class="line">Documentation&#x3D;man:httpd(8)</span><br><span class="line">Documentation&#x3D;man:apachectl(8)</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type&#x3D;forking</span><br><span class="line">ExecStart&#x3D;$&#123;INSTALL_DIR&#125;&#x2F;bin&#x2F;apachectl -k start</span><br><span class="line">ExecReload&#x3D;$&#123;INSTALL_DIR&#125;&#x2F;httpd&#x2F;bin&#x2F;apachectl -k graceful</span><br><span class="line">ExecStop&#x3D;$&#123;INSTALL_DIR&#125;&#x2F;bin&#x2F;apachectl -k stop</span><br><span class="line"># We want systemd to give httpd some time to finish gracefully, but still want</span><br><span class="line"># it to kill httpd after TimeoutStopSec if something went wrong during the</span><br><span class="line"># graceful stop. Normally, Systemd sends SIGTERM signal right after the</span><br><span class="line"># ExecStop, which would kill httpd. We are sending useless SIGCONT here to give</span><br><span class="line"># httpd time to finish.</span><br><span class="line">KillSignal&#x3D;SIGCONT                                                                      </span><br><span class="line">PrivateTmp&#x3D;true</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy&#x3D;multi-user.target</span><br><span class="line">EOF</span><br><span class="line">    chown -R apache.apache $&#123;INSTALL_DIR&#125;</span><br><span class="line">    systemctl daemon-reload</span><br><span class="line">    systemctl enable --now httpd.service &amp;&gt;&#x2F;dev&#x2F;null</span><br><span class="line">    if [ $? -eq 0 ];then</span><br><span class="line">        action &quot;httpd服务启动成功！&quot;</span><br><span class="line">    else</span><br><span class="line">        action false &quot;httpd服务启动失败&quot;</span><br><span class="line">    fi</span><br><span class="line">    echo &quot;编译用时：$&#123;TIME_USED&#125;s&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">check_env</span><br><span class="line"></span><br><span class="line">install_httpd</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="3-HTTPD常用配置选项"><a href="#3-HTTPD常用配置选项" class="headerlink" title="3 HTTPD常用配置选项"></a>3 HTTPD常用配置选项</h2><p>主配置文件：<code>httpd.conf</code></p>
<p>子配置文件夹，<code>/conf</code>，只要名称后缀是<code>.conf</code>就可以</p>
<p>默认配置：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ grep -Ev <span class="string">&#x27;^#|^$|^ &#x27;</span> /etc/httpd/conf/httpd.conf</span><br><span class="line">ServerRoot <span class="string">&quot;/etc/httpd&quot;</span>				<span class="comment">#默认目录</span></span><br><span class="line">Listen 80							<span class="comment">#监听端口，可以设置多个监听IP和端口</span></span><br><span class="line">Include conf.modules.d/*.conf</span><br><span class="line">User apache</span><br><span class="line">Group apache</span><br><span class="line">ServerAdmin root@localhost</span><br><span class="line">&lt;Directory /&gt;</span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line">DocumentRoot <span class="string">&quot;/var/www/html&quot;</span></span><br><span class="line">&lt;Directory <span class="string">&quot;/var/www&quot;</span>&gt;</span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line">&lt;Directory <span class="string">&quot;/var/www/html&quot;</span>&gt;</span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line">&lt;IfModule dir_module&gt;</span><br><span class="line">&lt;/IfModule&gt;</span><br><span class="line">&lt;Files <span class="string">&quot;.ht*&quot;</span>&gt;</span><br><span class="line">&lt;/Files&gt;</span><br><span class="line">ErrorLog <span class="string">&quot;logs/error_log&quot;</span></span><br><span class="line">LogLevel warn</span><br><span class="line">&lt;IfModule log_config_module&gt;</span><br><span class="line">&lt;/IfModule&gt;</span><br><span class="line">&lt;IfModule alias_module&gt;</span><br><span class="line">&lt;/IfModule&gt;</span><br><span class="line">&lt;Directory <span class="string">&quot;/var/www/cgi-bin&quot;</span>&gt;</span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line">&lt;IfModule mime_module&gt;</span><br><span class="line">&lt;/IfModule&gt;</span><br><span class="line">AddDefaultCharset UTF-8</span><br><span class="line">&lt;IfModule mime_magic_module&gt;</span><br><span class="line">&lt;/IfModule&gt;</span><br><span class="line">EnableSendfile on</span><br><span class="line">IncludeOptional conf.d/*.conf</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="1-serverName"><a href="#1-serverName" class="headerlink" title="1.serverName"></a>1.serverName</h3><p><strong>解决总是提示ServerName异常：在httpd.conf中设置一个ServerName就行了</strong></p>
<h3 id="2-包含其他配置文件"><a href="#2-包含其他配置文件" class="headerlink" title="2.包含其他配置文件"></a>2.包含其他配置文件</h3><p>指令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Include conf&#x2F;extra&#x2F;proxy-html.conf</span><br><span class="line">IncludeOptional conf&#x2F;extra&#x2F;proxy-html.conf</span><br><span class="line">#他们两个的区别就是，Include后面的文件如果写错位置或者不存在会报错，IncludeOptional后面的不会</span><br></pre></td></tr></table></figure>

<h3 id="3-监听的IP和Port"><a href="#3-监听的IP和Port" class="headerlink" title="3.监听的IP和Port"></a>3.监听的IP和Port</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Listen [IP:]Port</span><br></pre></td></tr></table></figure>

<p>说明：</p>
<p>（1）省略IP表示为本机所有IP</p>
<p>（2）Listen指令至少一个，可重复出现多次</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Listen 192.168.0.1:8080</span><br><span class="line">Listen 80</span><br></pre></td></tr></table></figure>

<h3 id="4-持久连接"><a href="#4-持久连接" class="headerlink" title="4.持久连接"></a>4.持久连接</h3><p>Persistence Connection：连接建立，每个资源获取完成后不会断开连接，而是继续等待其他的请求完成，默认开启持久连接</p>
<p>断开条件：</p>
<ul>
<li>时间限制：以秒为单位，默认5s，httpd支持毫秒级</li>
<li>请求数量：请求数达到指定值，也会断开</li>
</ul>
<p>副作用：对并发量大的服务器，持久连接会使有些请求得不到响应</p>
<p>折中：使用较短的持久连接时间</p>
<p>持久连接时间：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">KeepAlive On|Off</span><br><span class="line">KeepAliveTimeout 15  #持久连接时间15s，默认是5s</span><br><span class="line">MaxKeepAliveRequests 500 #持久连接的最大接收请求数，默认值1000</span><br></pre></td></tr></table></figure>

<p>测试：使用Telnet模拟一次Http的GET请求</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ telnet 10.0.0.11 80</span><br><span class="line">GET &#x2F; HTTP&#x2F;1.1</span><br><span class="line">Host: 10.0.0.11</span><br><span class="line"></span><br><span class="line">HTTP&#x2F;1.1 200 OK</span><br><span class="line">Date: Tue, 27 Oct 2020 13:51:03 GMT</span><br><span class="line">Server: Apache&#x2F;2.4.46 (Unix)</span><br><span class="line">Last-Modified: Tue, 27 Oct 2020 13:50:44 GMT</span><br><span class="line">ETag: &quot;2d-5b2a7554f01a3&quot;</span><br><span class="line">Accept-Ranges: bytes</span><br><span class="line">Content-Length: 45</span><br><span class="line">Content-Type: text&#x2F;html</span><br><span class="line"></span><br><span class="line">&lt;html&gt;&lt;body&gt;&lt;h1&gt;It works!&lt;&#x2F;h1&gt;&lt;&#x2F;body&gt;&lt;&#x2F;html&gt;   #网页内容</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="5-DSO（Dynamic-Shared-Object）"><a href="#5-DSO（Dynamic-Shared-Object）" class="headerlink" title="5.DSO（Dynamic Shared Object）"></a>5.DSO（Dynamic Shared Object）</h3><p>加载动态模块配置，不需重启即生效</p>
<p>动态模块的路径：/usr/lib64/httpd/modules/，如果是编译安装，那么是在/path_to_install/httpd/modules</p>
<p>在主配置中指定加载模块配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ServerRoot &quot;&#x2F;apps&#x2F;httpd&quot;</span><br><span class="line">Include conf&#x2F;extra&#x2F;*.conf</span><br></pre></td></tr></table></figure>

<p>加载指定模块的方式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LoadModule &lt;mod_name&gt; &lt;mod_path&gt;</span><br></pre></td></tr></table></figure>

<p>查看httpd加载的模块</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">httpd -l  #静态编译的模块</span><br><span class="line">httpd -M  #静态和动态编译的模块</span><br></pre></td></tr></table></figure>

<h3 id="6-MPM（Multi-Processing-Module）多路处理模块"><a href="#6-MPM（Multi-Processing-Module）多路处理模块" class="headerlink" title="6.MPM（Multi-Processing Module）多路处理模块"></a>6.MPM（Multi-Processing Module）多路处理模块</h3><ul>
<li>prefork，预派生模式，多进程单线程，稳定，并发性不好，centos7默认</li>
<li>worker，多进程多线程，资源利用率好，但是在高并发时可能出现线程被占用</li>
<li>event，事件模式，有一个线程去管理其他线程，利用率高，centos8默认</li>
</ul>
<p>具体加载模块是在主配置文件，模块中的各种配置是在conf/extra文件下的http-mpm.conf中修改和查看</p>
<p>例如：修改MPM的工作模式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">vim httpd.conf</span><br><span class="line"> 63 # Example:</span><br><span class="line"> 64 # LoadModule foo_module modules&#x2F;mod_foo.so</span><br><span class="line"> 65 #</span><br><span class="line"> 66 LoadModule mpm_event_module modules&#x2F;mod_mpm_event.so                                    </span><br><span class="line"> 67 #LoadModule mpm_prefork_module modules&#x2F;mod_mpm_prefork.so</span><br><span class="line"> 68 #LoadModule mpm_worker_module modules&#x2F;mod_mpm_worker.so</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="查看每个MPM模块的配置：prefork"><a href="#查看每个MPM模块的配置：prefork" class="headerlink" title="查看每个MPM模块的配置：prefork"></a>查看每个MPM模块的配置：prefork</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">vim conf&#x2F;extra&#x2F;httpd-mpm.conf</span><br><span class="line"></span><br><span class="line"> 21 # prefork MPM</span><br><span class="line"> 22 # StartServers: number of server processes to start</span><br><span class="line"> 23 # MinSpareServers: minimum number of server processes which are kept spare</span><br><span class="line"> 24 # MaxSpareServers: maximum number of server processes which are kept spare</span><br><span class="line"> 25 # MaxRequestWorkers: maximum number of server processes allowed to start</span><br><span class="line"> 26 # MaxConnectionsPerChild: maximum number of connections a server process serves</span><br><span class="line"> 27 #                         before terminating</span><br><span class="line"> 28 &lt;IfModule mpm_prefork_module&gt;</span><br><span class="line"> 29     StartServers             5</span><br><span class="line"> 30     MinSpareServers          5</span><br><span class="line"> 31     MaxSpareServers         10</span><br><span class="line"> 32     MaxRequestWorkers      250</span><br><span class="line"> 33     MaxConnectionsPerChild   0</span><br><span class="line"> 34 &lt;&#x2F;IfModule&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="worker"><a href="#worker" class="headerlink" title="worker"></a>worker</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">36 # worker MPM</span><br><span class="line">37 # StartServers: initial number of server processes to start</span><br><span class="line">38 # MinSpareThreads: minimum number of worker threads which are kept spare</span><br><span class="line">39 # MaxSpareThreads: maximum number of worker threads which are kept spare</span><br><span class="line">40 # ThreadsPerChild: constant number of worker threads in each server process</span><br><span class="line">41 # MaxRequestWorkers: maximum number of worker threads</span><br><span class="line">42 # MaxConnectionsPerChild: maximum number of connections a server process serves</span><br><span class="line">43 #                         before terminating</span><br><span class="line">44 &lt;IfModule mpm_worker_module&gt;</span><br><span class="line">45     StartServers             3</span><br><span class="line">46     MinSpareThreads         75</span><br><span class="line">47     MaxSpareThreads        250 </span><br><span class="line">48     ThreadsPerChild         25</span><br><span class="line">49     MaxRequestWorkers      400</span><br><span class="line">50     MaxConnectionsPerChild   0</span><br><span class="line">51 &lt;&#x2F;IfModule&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="event"><a href="#event" class="headerlink" title="event"></a>event</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">53 # event MPM</span><br><span class="line">54 # StartServers: initial number of server processes to start</span><br><span class="line">55 # MinSpareThreads: minimum number of worker threads which are kept spare</span><br><span class="line">56 # MaxSpareThreads: maximum number of worker threads which are kept spare</span><br><span class="line">57 # ThreadsPerChild: constant number of worker threads in each server process</span><br><span class="line">58 # MaxRequestWorkers: maximum number of worker threads</span><br><span class="line">59 # MaxConnectionsPerChild: maximum number of connections a server process serves</span><br><span class="line">60 #                         before terminating</span><br><span class="line">61 &lt;IfModule mpm_event_module&gt;</span><br><span class="line">62     StartServers             3</span><br><span class="line">63     MinSpareThreads         75</span><br><span class="line">64     MaxSpareThreads        250</span><br><span class="line">65     ThreadsPerChild         25</span><br><span class="line">66     MaxRequestWorkers      400</span><br><span class="line">67     MaxConnectionsPerChild   0</span><br><span class="line">68 &lt;&#x2F;IfModule&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="7-修改主页路径，需要添加授权选项"><a href="#7-修改主页路径，需要添加授权选项" class="headerlink" title="7.修改主页路径，需要添加授权选项"></a>7.修改主页路径，需要添加授权选项</h3><p><code>vim httpd.conf</code></p>
<p>DocumentRoot选项指定了访问httpd服务时访问的主目录，下面的标签中都是对选项的控制操作</p>
<ul>
<li>DocumentRoot指向的路径为URL的起始路径</li>
<li>/path必须显示授权后才可以访问</li>
</ul>
<p>URL和磁盘文件路径的映射关系：</p>
<p><code>http://10.0.0.11:80/index.html --&gt; /apps/httpd/htdocs/index.html</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">227 DocumentRoot &quot;/apps/httpd/htdocs&quot;</span><br><span class="line">228 &lt;Directory &quot;/apps/httpd/htdocs&quot;&gt;</span><br><span class="line">229     #</span><br><span class="line">230     # Possible values for the Options directive are &quot;None&quot;, &quot;All&quot;,</span><br><span class="line">231     # or any combination of:</span><br><span class="line">232     #   Indexes Includes FollowSymLinks SymLinksifOwnerMatch ExecCGI MultiViews</span><br><span class="line">233     #</span><br><span class="line">234     # Note that &quot;MultiViews&quot; must be named *explicitly* --- &quot;Options All&quot;</span><br><span class="line">235     # doesn&#x27;t give it to you.</span><br><span class="line">236     #</span><br><span class="line">237     # The Options directive is both complicated and important.  Please see</span><br><span class="line">238     # http://httpd.apache.org/docs/2.4/mod/core.html#options</span><br><span class="line">239     # for more information.</span><br><span class="line">240     #</span><br><span class="line">241     Options Indexes FollowSymLinks</span><br><span class="line">242 </span><br><span class="line">243     #</span><br><span class="line">244     # AllowOverride controls what directives may be placed in .htaccess files.</span><br><span class="line">245     # It can be &quot;All&quot;, &quot;None&quot;, or any combination of the keywords:</span><br><span class="line">246     #   AllowOverride FileInfo AuthConfig Limit</span><br><span class="line">247     #</span><br><span class="line">248     AllowOverride None</span><br><span class="line">249 </span><br><span class="line">250     #</span><br><span class="line">251     # Controls who can get stuff from this server.</span><br><span class="line">252     #</span><br><span class="line">253     Require all granted</span><br><span class="line">254 &lt;/Directory&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="8-定义站点主页面"><a href="#8-定义站点主页面" class="headerlink" title="8.定义站点主页面"></a>8.定义站点主页面</h3><p>这个指的是Apache默认会使用哪个文件作为起始页面</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">257 <span class="comment"># DirectoryIndex: sets the file that Apache will serve if a directory</span></span><br><span class="line">258 <span class="comment"># is requested.</span></span><br><span class="line">259 <span class="comment">#</span></span><br><span class="line">260 &lt;IfModule dir_module&gt;</span><br><span class="line">261     DirectoryIndex index.html</span><br><span class="line">262 &lt;/IfModule&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="9-对访问资源的控制"><a href="#9-对访问资源的控制" class="headerlink" title="9.对访问资源的控制"></a>9.对访问资源的控制</h3><p>可以针对文件系统的资源进行访问控制</p>
<p>文件系统路径：</p>
<h5 id="基于目录的控制"><a href="#基于目录的控制" class="headerlink" title="基于目录的控制"></a><strong>基于目录的控制</strong></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;directory &quot;&#x2F;path&quot;&gt;</span><br><span class="line">...</span><br><span class="line">&lt;&#x2F;directory&gt;</span><br></pre></td></tr></table></figure>

<h5 id="基于文件的控制"><a href="#基于文件的控制" class="headerlink" title="基于文件的控制"></a>基于文件的控制</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;File &quot;&#x2F;path&#x2F;file&quot;&gt;</span><br><span class="line">...</span><br><span class="line">&lt;&#x2F;File&gt;</span><br></pre></td></tr></table></figure>

<h5 id="基于文件通配符"><a href="#基于文件通配符" class="headerlink" title="基于文件通配符"></a>基于文件通配符</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;File &quot;&#x2F;path&#x2F;*.conf&quot;&gt;</span><br><span class="line">...</span><br><span class="line">&lt;&#x2F;File&gt;</span><br></pre></td></tr></table></figure>

<h5 id="基于扩展正则表达式"><a href="#基于扩展正则表达式" class="headerlink" title="基于扩展正则表达式"></a>基于扩展正则表达式</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;FileMatch &quot;regex&quot;&gt;</span><br><span class="line">...</span><br><span class="line">&lt;&#x2F;FileMatch&gt;</span><br></pre></td></tr></table></figure>

<p>例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">268 &lt;Files &quot;.ht*&quot;&gt;</span><br><span class="line">269     Require all denied</span><br><span class="line">270 &lt;&#x2F;Files&gt;</span><br></pre></td></tr></table></figure>

<h3 id="10-针对目录和URL实现访问控制"><a href="#10-针对目录和URL实现访问控制" class="headerlink" title="10.针对目录和URL实现访问控制"></a>10.针对目录和URL实现访问控制</h3><p>（1）Options指令：</p>
<p>​    后面跟一个或多个空白字符分隔的选项列表，在选项前的<code>+,-</code>，表示增加或减少指定选项</p>
<p>​    常见选项：</p>
<ul>
<li>Indexes：指明的URL路径下不存在与定义的主页面资源向符的资源文件时，返回索引列表给用户</li>
<li>FollowSymLinks：允许访问符号链接文件所指向的源文件</li>
<li>None：全部禁用</li>
<li>All：全部允许</li>
</ul>
<p>（2）Allowoverride指令</p>
<p>与访问控制相关的指令可以放在指定目录下的.htaccess（由AccessFileName指令指定，AccessFileName .htaccess为默认值）文件中，覆盖之前的配置命令，只对语句有效</p>
<p>常用选项：</p>
<ul>
<li>AllowOverride ALL     #.htaccess中所有指令都有效</li>
<li>AllowOverride None  #.htaccess文件无效，httpd2.3.9之后的版本的默认值</li>
<li>AllowOverride AuthConfig   #.htaccess文件中，除了AuthConfig其他指令都无法生效</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">option indexes</span><br><span class="line">实现目录</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.htaccess 文件  在这个文件中写入控制命令，然后调用</span><br></pre></td></tr></table></figure>



<h3 id="11-基于客户端IP地址实现访问控制"><a href="#11-基于客户端IP地址实现访问控制" class="headerlink" title="11.基于客户端IP地址实现访问控制"></a>11.基于客户端IP地址实现访问控制</h3><p>两种控制方法：</p>
<ul>
<li>基于IP地址</li>
<li>基于用户账号</li>
</ul>
<p>基于客户端的IP地址的访问控制：</p>
<ul>
<li><p>无明确授权的目录，默认拒绝</p>
</li>
<li><p>允许所有主机访问：Require all granted</p>
</li>
<li><p>拒绝所有主机访问：Require all denied</p>
</li>
<li><p>控制特定的IP访问：</p>
<p>Require ip IPADDR：授权特定IP的访问</p>
<p>Require not ip IPADDR：拒绝特定IP的方位</p>
</li>
<li><p>控制特定主机访问：</p>
<p>Require host HOSTNAME：授权特定主机访问</p>
<p>Require not host HOSTNAME：拒绝特定主机访问</p>
</li>
</ul>
<p>特定的Require格式：</p>
<p>第一种：在这个Require标签中的命令必须全部匹配的IP才能访问</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;RequireAll&gt;</span><br><span class="line">	Require all granted</span><br><span class="line">	Require not ip 10.0.0.9</span><br><span class="line">&lt;&#x2F;RequireAll&gt;</span><br></pre></td></tr></table></figure>

<p>第二种：有一个成功匹配的条件就能访问</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;RequireAny&gt;</span><br><span class="line">	Require all denied</span><br><span class="line">	Require ip 10.0.0.7</span><br><span class="line">&lt;&#x2F;RequireAny&gt;</span><br></pre></td></tr></table></figure>

<h3 id="12-日志设定"><a href="#12-日志设定" class="headerlink" title="12.日志设定"></a>12.日志设定</h3><p>httpd有两种日志类型</p>
<ul>
<li>访问日志</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">访问日志有两个地方需要知道，第一个是存放位置，第二个是日志的格式</span><br><span class="line">存放位置：CustomLog &quot;logs&#x2F;access_log&quot; combined  后面的这个combined是自己定义的</span><br><span class="line">日志的格式：</span><br><span class="line"></span><br><span class="line">196     LogFormat &quot;%h %l %u %t \&quot;%r\&quot; %&gt;s %b \&quot;%&#123;Referer&#125;i\&quot; \&quot;%&#123;User-Agent&#125;i\&quot;&quot; combined</span><br><span class="line">197     LogFormat &quot;%h %l %u %t \&quot;%r\&quot; %&gt;s %b&quot; common</span><br><span class="line">198 </span><br><span class="line">199     &lt;IfModule logio_module&gt;</span><br><span class="line">200       # You need to enable mod_logio.c to use %I and %O</span><br><span class="line">201       LogFormat &quot;%h %l %u %t \&quot;%r\&quot; %&gt;s %b \&quot;%&#123;Referer&#125;i\&quot; \&quot;%&#123;User-Agent&#125;i\&quot; %I %O&quot; combinedio</span><br><span class="line">202     &lt;&#x2F;IfModule&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>格式的具体说明：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">大概说明：</span><br><span class="line">http:&#x2F;&#x2F;httpd.apache.org&#x2F;docs&#x2F;current&#x2F;mod&#x2F;mod_log_config.html#logformat</span><br><span class="line">具体参数：</span><br><span class="line">http:&#x2F;&#x2F;httpd.apache.org&#x2F;docs&#x2F;current&#x2F;mod&#x2F;mod_log_config.html#formats</span><br></pre></td></tr></table></figure>

<p>大概格式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">定义日志格式的格式：</span><br><span class="line">LogFormat &quot;xxx&quot; nickname</span><br><span class="line">使用日志的格式：</span><br><span class="line">CustomLog filename.log nickname        #这个nickname就是上面定义的nickname，可以定义多个格式，然后选择其中一个，然后把他的nickname写在customlog这里</span><br></pre></td></tr></table></figure>

<p>几个常见的格式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">%h	客户端IP地址</span><br><span class="line">%l	远程用户，启用mod_ident生效，如果没有使用用户，那么就是&quot;-&quot;</span><br><span class="line">%u	验证远程用户，basic digest，非登录用户时，是“-”</span><br><span class="line">%t	服务器接收到请求的时间，可以加格式，%&#123;%F %T&#125;t</span><br><span class="line">%r	请求报文的首行，记录了方法，请求资源，以及协议版本</span><br><span class="line">%&gt;s	响应码</span><br><span class="line">%b	以字节显示响应报文的大小，不包括响应报文的首部</span><br><span class="line">%&#123;VARNAME&#125;i	请求报文首部中，VARNAME，这个字段的值，比如Refer字段，就表示从哪里跳转过来的，User-Agent表示用户的代理程序，也就是浏览器</span><br></pre></td></tr></table></figure>



<ul>
<li>错误日志</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">错误日志一个是存放位置，另一个是日志的记录等级</span><br><span class="line">ErrorLog &quot;logs&#x2F;error_log&quot;</span><br><span class="line"># LogLevel: Control the number of messages logged to the error_log.</span><br><span class="line">186 # Possible values include: debug, info, notice, warn, error, crit,</span><br><span class="line">187 # alert, emerg.</span><br><span class="line">188 #</span><br><span class="line">189 LogLevel warn</span><br></pre></td></tr></table></figure>

<p>例子：</p>
<p>自定义格式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">LogFormat &quot;%h %l %u \&quot;%&#123;%F %T&#125;t\&quot; %&gt;s %&#123;User-Agent&#125;i&quot; testlog</span><br><span class="line">#主机IP，用户名，认证，设定了时间格式，首部行，状态码，浏览器信息，nickname是testlog</span><br><span class="line">CustomLog &quot;logs&#x2F;access_log&quot; testlog</span><br><span class="line"></span><br><span class="line">tail -f &#x2F;var&#x2F;log&#x2F;httpd&#x2F;access_log</span><br><span class="line">10.0.0.2 - - &quot;2020-10-29 17:14:03&quot; &quot;GET &#x2F; HTTP&#x2F;1.1&quot; 304 Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;86.0.4240.111 Safari&#x2F;537.36 Edg&#x2F;86.0.622.56</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="13-设定默认字符集"><a href="#13-设定默认字符集" class="headerlink" title="13.设定默认字符集"></a>13.设定默认字符集</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AddDefaultCharset UTF-8</span><br></pre></td></tr></table></figure>

<h3 id="14-定义路径别名"><a href="#14-定义路径别名" class="headerlink" title="14.定义路径别名"></a>14.定义路径别名</h3><p>格式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Alias &#x2F;URL&#x2F; &quot;&#x2F;PATH&#x2F;&quot;</span><br></pre></td></tr></table></figure>

<p>注意一点：一个目录就算写了别名，也一定要声明他的访问权限才可以，否则还是无法访问</p>
<p>范例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> 1 &lt;Directory &#x2F;data&#x2F;&gt;</span><br><span class="line"> 2     allowoverride none</span><br><span class="line"> 3     options Indexes</span><br><span class="line"> 4     &lt;RequireAny&gt;</span><br><span class="line"> 5         require ip 10.0.0.119</span><br><span class="line"> 6         require all denied                                                              </span><br><span class="line"> 7     &lt;&#x2F;RequireAny&gt;</span><br><span class="line"> 8 &lt;&#x2F;Directory&gt;</span><br><span class="line"> 9 </span><br><span class="line">10 &lt;IfModule alias_module&gt;</span><br><span class="line">11     Alias &#x2F;download  &quot;&#x2F;data&#x2F;&quot;</span><br><span class="line">12 &lt;&#x2F;IfModule&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="15-基于用户名的访问控制"><a href="#15-基于用户名的访问控制" class="headerlink" title="15.基于用户名的访问控制"></a>15.基于用户名的访问控制</h3><p>分两步：</p>
<ul>
<li>认证质询：响应码为401，拒绝客户端请求，并说明客户端需要账号和密码</li>
<li>认证：客户端发来的报文中的账号和密码匹配成功了，那么服务器才返回资源</li>
</ul>
<p>认证的方式：</p>
<ul>
<li>basic：明文认证</li>
<li>digest：消息摘要认证，兼容性差</li>
</ul>
<p>安全域：需要用户认证后才能访问的路径</p>
<p>需要的条件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">1.一个目录</span><br><span class="line">&lt;Directory &#x2F;path&gt;</span><br><span class="line">Options None</span><br><span class="line">AllowOverride None</span><br><span class="line">AuthType Basic               #认证的方式</span><br><span class="line">AuthName &quot;Prompt&quot;			 #提示用户的话</span><br><span class="line">AuthUserFile &quot;&#x2F;path&#x2F;user_password_file&quot;  	#认证文件，里面应该有账号和密码</span><br><span class="line">require user user1 user2   #或者写全部，require valid-user  #要求哪些用户可以来认证</span><br><span class="line">&lt;&#x2F;Directory&gt;</span><br><span class="line"></span><br><span class="line">2.一个文件</span><br><span class="line">用于存放账号密码的文件是用命令生成的：</span><br><span class="line">htpasswd [options] &#x2F;path&#x2F;filename username</span><br></pre></td></tr></table></figure>

<p>例子：</p>
<p>先写一个目录，然后规定认证方式，认证文件，认证用户</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1 &lt;Directory &#x2F;var&#x2F;www&#x2F;html&#x2F;test&#x2F;&gt;</span><br><span class="line">2 AuthType Basic                                                                          </span><br><span class="line">3 Authname &quot;验证&quot;</span><br><span class="line">4 Authuserfile &quot;&#x2F;var&#x2F;www&#x2F;html&#x2F;.htpasswd&quot;</span><br><span class="line">5 Require valid-user</span><br><span class="line">6 &lt;&#x2F;Directory&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>创建密码文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">htpasswd -c &#x2F;var&#x2F;www&#x2F;html&#x2F;.htpasswd xiaohong</span><br></pre></td></tr></table></figure>



<h3 id="操作：实现家目录共享"><a href="#操作：实现家目录共享" class="headerlink" title="操作：实现家目录共享"></a>操作：实现家目录共享</h3><p>基于模块实现：mod_userdir.so</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;IfModule mod_userdir.c&gt;</span><br><span class="line">	UserDir html</span><br><span class="line">&lt;&#x2F;IfModule&gt;</span><br><span class="line">&lt;Directory &#x2F;home&#x2F;lv&#x2F;html&gt;</span><br><span class="line">	require all granted</span><br><span class="line">&lt;&#x2F;Directory&gt;</span><br><span class="line">访问的时候：http:&#x2F;&#x2F;IP&#x2F;~lv&#x2F;html&#x2F;</span><br></pre></td></tr></table></figure>



<h3 id="16-操作：隐藏服务器版本信息"><a href="#16-操作：隐藏服务器版本信息" class="headerlink" title="16.操作：隐藏服务器版本信息"></a>16.操作：隐藏服务器版本信息</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ServerTokens prod  建议使用</span><br><span class="line">使用之前：</span><br><span class="line">Server: Apache&#x2F;2.4.6 (CentOS)</span><br><span class="line">使用之后的版本信息：</span><br><span class="line">Server: Apache</span><br></pre></td></tr></table></figure>

<p>PHP也可以隐藏版本信息，是在<code>/etc/php.ini</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">expose_php &#x3D; Off</span><br><span class="line">这个开启之后连PHP都不写，什么都没了</span><br></pre></td></tr></table></figure>

<p>通过curl检查报文头</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -I http:&#x2F;&#x2F;10.0.0.7&#x2F;</span><br></pre></td></tr></table></figure>

<p>操作：隐藏服务器错误信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ServerSignature ON | Off | EMail</span><br></pre></td></tr></table></figure>



<h3 id="17-操作：禁止trace方法"><a href="#17-操作：禁止trace方法" class="headerlink" title="17.操作：禁止trace方法"></a>17.操作：禁止trace方法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TraceEnable On | Off | Extended</span><br></pre></td></tr></table></figure>

<p>默认是开启的，不安全</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@node_7 html]$curl -IX OPTIONS 127.0.0.1</span><br><span class="line">HTTP&#x2F;1.1 200 OK</span><br><span class="line">Date: Thu, 29 Oct 2020 10:57:42 GMT</span><br><span class="line">Server: Apache</span><br><span class="line">Allow: POST,OPTIONS,GET,HEAD,TRACE</span><br><span class="line">Content-Length: 0</span><br><span class="line">Content-Type: text&#x2F;html; charset&#x3D;UTF-8</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>关闭后：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@node_7 html]$curl -IX OPTIONS 127.0.0.1</span><br><span class="line">HTTP&#x2F;1.1 200 OK</span><br><span class="line">Date: Thu, 29 Oct 2020 10:58:38 GMT</span><br><span class="line">Server: Apache</span><br><span class="line">Allow: POST,OPTIONS,GET,HEAD</span><br><span class="line">Content-Length: 0</span><br><span class="line">Content-Type: text&#x2F;html; charset&#x3D;UTF-8</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="18-操作：状态页面"><a href="#18-操作：状态页面" class="headerlink" title="18.操作：状态页面"></a>18.操作：状态页面</h3><p>通过模块实现：mod_status.so</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LoadModule status_module modules&#x2F;mod_status.so</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1 &lt;Location &quot;&#x2F;status&quot;&gt;</span><br><span class="line">2     SetHandler server-status</span><br><span class="line">3     &lt;RequireAny&gt;</span><br><span class="line">4         require all denied</span><br><span class="line">5         require ip 10.0.0.2</span><br><span class="line">6         require ip 10.0.0.7                                                             </span><br><span class="line">7     &lt;&#x2F;RequireAny&gt;</span><br><span class="line">8 &lt;&#x2F;Location&gt;</span><br></pre></td></tr></table></figure>



<h3 id="多虚拟主机"><a href="#多虚拟主机" class="headerlink" title="多虚拟主机"></a>多虚拟主机</h3><p>一台物理主机上实现多个网站</p>
<p>网站的唯一标识：</p>
<ul>
<li>IP相同，但端口不同 –&gt;只要访问的是一个物理主机，那么不管是哪个IP地址，只要端口一样网站就一样</li>
<li>IP不同，但端口均为默认端口</li>
<li>FQDN不同，IP和端口都相同</li>
</ul>
<p>使用FQDN更好，FQDN：Full Qualified Domain Name</p>
<h4 id="第一种：使用端口进行区分"><a href="#第一种：使用端口进行区分" class="headerlink" title="第一种：使用端口进行区分"></a>第一种：使用端口进行区分</h4><p>1.创建独立的文件目录 –&gt;每个网站</p>
<p>2.修改配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">listen port1</span><br><span class="line">listen port2</span><br><span class="line">&lt;virutallhost *:port1&gt;</span><br><span class="line">documentroot &#x2F;data&#x2F;web1</span><br><span class="line">&lt;directory &#x2F;data&#x2F;web1&gt;</span><br><span class="line">require all granted</span><br><span class="line">&lt;&#x2F;directory&gt;</span><br><span class="line">&lt;&#x2F;virutalhost&gt;</span><br></pre></td></tr></table></figure>

<h4 id="第二种：使用IP进行区分"><a href="#第二种：使用IP进行区分" class="headerlink" title="第二种：使用IP进行区分"></a>第二种：使用IP进行区分</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;virtualhost IP:80&gt;，使用IP进行区别</span><br></pre></td></tr></table></figure>

<p>问题：一个网卡多个IP如何临时设置和写入配置文件？</p>
<h4 id="第三种：基于全限定域名进行区分"><a href="#第三种：基于全限定域名进行区分" class="headerlink" title="第三种：基于全限定域名进行区分"></a>第三种：基于全限定域名进行区分</h4><p>servername 进行区别，所以需要多个域名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -v www.a.com</span><br></pre></td></tr></table></figure>

<p>顺序的重要性，如果不写host，那么是基于主机头在配置文件中的顺序来进行默认访问的，没有主机头的网站将不能访问</p>
<p>基本配置方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;VirtualHost IP:PORT&gt;</span><br><span class="line">ServerName FQDN</span><br><span class="line">DocumentRoot &quot;&#x2F;path&quot;</span><br><span class="line">&lt;&#x2F;VirtualHost&gt;</span><br></pre></td></tr></table></figure>

<p>建议把虚拟主机的配置文件放在独立的配置文件中</p>
<p>其他可以使用的指令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ServerAlias：虚拟主机的别名</span><br><span class="line">ErrorLog：错误日志，如果不写，那么虚拟主机的日志都会写到&#x2F;var&#x2F;log&#x2F;httpd&#x2F;error_log中</span><br><span class="line">CustomerLog：访问日志</span><br><span class="line">&lt;Directory&gt;  xxx  &lt;&#x2F;Directory&gt;</span><br></pre></td></tr></table></figure>

<p>只使用FQDN方式，因为这个是最好的</p>
<p>需要生成三个主目录，需要让访问这个IP的三个网站的用户机器上，有他们的DNS解析，可以通过手动修改<code>/etc/hosts</code>文件来完成</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">10.0.0.11   www.a.com www.b.com www.c.com</span><br></pre></td></tr></table></figure>

<p>配置文件：存放在<code>conf.d/</code>下，这个配置文件三个网站，每个配置文件都差不多，主要是几个部分：</p>
<p>1.定义虚拟主机部分</p>
<p><code>&lt;VirtualHost IP:Port&gt;  &lt;/VirtualHost&gt;</code>，这里面写网站名称，这是区分这三个网页的关键，在报文中体现为<code>Host字段</code>，还有定义网页的主目录，<code>DocumentRoot</code>，这里定义了每个网站的默认目录，也就是访问这个URL的时候<code>http://www.xxx.com/</code>，默认在哪个目录</p>
<p>2.给目录授权</p>
<p><code>&lt;Directory&gt;  &lt;/Directory&gt;</code></p>
<p>具体配置文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"> 1 &lt;VirtualHost *:80&gt;</span><br><span class="line"> 2 ServerName www.a.com</span><br><span class="line"> 3 DocumentRoot &quot;&#x2F;data&#x2F;a.com&#x2F;htdocs&quot;</span><br><span class="line"> 4 ErrorLog &quot;logs&#x2F;error_log&quot;</span><br><span class="line"> 5 CustomLog &quot;logs&#x2F;access_log&quot; testlog</span><br><span class="line"> 6 &lt;Directory &quot;&#x2F;data&#x2F;a.com&#x2F;htdocs&quot;&gt;</span><br><span class="line"> 7 require all granted</span><br><span class="line"> 8 &lt;&#x2F;Directory&gt;</span><br><span class="line"> 9 &lt;&#x2F;VirtualHost&gt;</span><br><span class="line">10 </span><br><span class="line">11 &lt;VirtualHost *:80&gt;</span><br><span class="line">12 ServerName www.b.com</span><br><span class="line">13 DocumentRoot &quot;&#x2F;data&#x2F;b.com&#x2F;htdocs&quot;</span><br><span class="line">14 ErrorLog &quot;logs&#x2F;error_log&quot;</span><br><span class="line">15 CustomLog &quot;logs&#x2F;access_log&quot; testlog</span><br><span class="line">16 &lt;Directory &quot;&#x2F;data&#x2F;b.com&#x2F;htdocs&quot;&gt;</span><br><span class="line">17 require all granted</span><br><span class="line">18 &lt;&#x2F;Directory&gt;</span><br><span class="line">19 &lt;&#x2F;VirtualHost&gt;</span><br><span class="line">20 </span><br><span class="line">21 &lt;VirtualHost *:80&gt;</span><br><span class="line">22 ServerName www.c.com</span><br><span class="line">23 DocumentRoot &quot;&#x2F;data&#x2F;c.com&#x2F;htdocs&quot;</span><br><span class="line">24 ErrorLog &quot;logs&#x2F;error_log&quot;</span><br><span class="line">25 CustomLog &quot;logs&#x2F;access_log&quot; testlog                                                     </span><br><span class="line">26 &lt;Directory &quot;&#x2F;data&#x2F;c.com&#x2F;htdocs&quot;&gt;</span><br><span class="line">27 require all granted</span><br><span class="line">28 &lt;&#x2F;Directory&gt;</span><br><span class="line">29 &lt;&#x2F;VirtualHost&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>测试：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 phpmyadmin]$curl www.a.com</span><br><span class="line">a:nihao,pengyou!</span><br><span class="line">[root@centos8 phpmyadmin]$curl www.b.com</span><br><span class="line">b:nihao,pengyou!</span><br><span class="line">[root@centos8 phpmyadmin]$curl www.c.com</span><br><span class="line">c:nihao,pengyou!</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="压缩"><a href="#压缩" class="headerlink" title="压缩"></a>压缩</h3><p>使用模块的方法实现：mod_deflate</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LoadMOdule deflate_module modules&#x2F;mod_deflate.so</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SetOutputFilter DEFLATE</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -I --compressed www.a.com&#x2F;m.html</span><br></pre></td></tr></table></figure>



<h3 id="实现HTTPS"><a href="#实现HTTPS" class="headerlink" title="实现HTTPS"></a>实现HTTPS</h3><p>Apache实现HTTPS的过程</p>
<p>1.为服务器申请数字证书，可以通过私有CA实现，创建CA，自签名，创建证书申请，签发证书</p>
<p>2.配置httpd支持使用SSL(TLS)，以及使用的证书</p>
<p>3.测试基于https访问相应的主机</p>
<p>下载模块，<code>mod_ssl</code>，这个模块中带了几个httpd的配置文件，里面开启了监听443端口和加载了ssl模块</p>
<p>CA，证书</p>
<p>怎么开的443端口？配置文件里写<code>Listen 443</code>就开了，证书和私钥和CA的证书写入到ssl.conf配置文件中</p>
<p>例子：</p>
<p>/etc/pki/tls/certs下自带了证书，可以直接通过https访问</p>
<h3 id="URL重定向"><a href="#URL重定向" class="headerlink" title="URL重定向"></a>URL重定向</h3><p>301：Moved Permanently</p>
<p>302：Moved Temporarily</p>
<p>307：Internal Redirect，曾经访问过一个网站后，再输入http时，浏览器会自动跳转到https，只对301生效</p>
<p>配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Redirect status url url1</span><br></pre></td></tr></table></figure>

<p>对于http重定向https不能这么设置，因为会无限套娃</p>
<p>例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Redirect permanent &#x2F; https:&#x2F;&#x2F;10.0.0.11&#x2F;</span><br><span class="line">这么写，当访问的时候是这样：</span><br><span class="line">curl: (47) Maximum (50) redirects followed  重定向次数过多</span><br></pre></td></tr></table></figure>

<p><strong>如果想用这个格式写，需要用特殊格式写</strong></p>
<h3 id="HSTS技术"><a href="#HSTS技术" class="headerlink" title="HSTS技术"></a>HSTS技术</h3><p>HSTS：Http Strict-Transport-Security </p>
<p><code>Header always set Strict-Transport-Security</code></p>
<p>利用首次访问http服务器时获得的302重定向缓存，之后的302规定的有效期内，每次都是307访问，更快速，更安全</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  1 Header always set Strict-Transport-Security &quot;max-age&#x3D;31536000&quot;                    </span><br><span class="line">  2 RewriteEngine on</span><br><span class="line">  3 RewriteRule ^(&#x2F;.*)$ https:&#x2F;&#x2F;%&#123;HTTP_HOST&#125;$1 [redirect&#x3D;302]</span><br><span class="line">参数说明：</span><br><span class="line">max-age：The time, in seconds, that the browser should remember that a site is only to be accessed using HTTPS.</span><br></pre></td></tr></table></figure>



<p>例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 phpmyadmin]$curl -I http:&#x2F;&#x2F;10.0.0.11</span><br><span class="line">HTTP&#x2F;1.1 302 Found</span><br><span class="line">Date: Thu, 29 Oct 2020 12:53:39 GMT</span><br><span class="line">Server: Apache</span><br><span class="line">Strict-Transport-Security: max-age&#x3D;31536000</span><br><span class="line">Location: https:&#x2F;&#x2F;10.0.0.11&#x2F;</span><br><span class="line">Content-Type: text&#x2F;html; charset&#x3D;iso-8859-1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@node_7 conf.d]$curl -LkI 127.0.0.1</span><br><span class="line">HTTP&#x2F;1.1 302 Found</span><br><span class="line">Date: Fri, 30 Oct 2020 00:58:48 GMT</span><br><span class="line">Server: Apache</span><br><span class="line">Strict-Transport-Security: max-age&#x3D;31536000</span><br><span class="line">Location: https:&#x2F;&#x2F;127.0.0.1&#x2F;</span><br><span class="line">Content-Type: text&#x2F;html; charset&#x3D;iso-8859-1</span><br><span class="line"></span><br><span class="line">HTTP&#x2F;1.1 200 OK</span><br><span class="line">Date: Fri, 30 Oct 2020 00:58:48 GMT</span><br><span class="line">Server: Apache</span><br><span class="line">Strict-Transport-Security: max-age&#x3D;31536000</span><br><span class="line">Last-Modified: Thu, 29 Oct 2020 07:07:23 GMT</span><br><span class="line">ETag: &quot;1b-5b2c9ee889711&quot;</span><br><span class="line">Accept-Ranges: bytes</span><br><span class="line">Content-Length: 27</span><br><span class="line">Content-Type: text&#x2F;html; charset&#x3D;UTF-8</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="正向代理和反向代理"><a href="#正向代理和反向代理" class="headerlink" title="正向代理和反向代理"></a>正向代理和反向代理</h3><p>正向代理：用户知道，用户去配置，我觉得正向代理就是一个内容服务器的缓存服务器</p>
<p>反向代理：用户不知道，负责调度用户应该访问哪个后端内容服务器</p>
<h3 id="Sendfile-机制"><a href="#Sendfile-机制" class="headerlink" title="Sendfile 机制"></a>Sendfile 机制</h3><p>内核复制</p>
<p>减少CPU在内核空间和用户空间的切换时间，提高效率</p>
<h3 id="指定文件类型-content-type"><a href="#指定文件类型-content-type" class="headerlink" title="指定文件类型 content type"></a>指定文件类型 content type</h3><h2 id="http-协议和报文头结构"><a href="#http-协议和报文头结构" class="headerlink" title="http 协议和报文头结构"></a>http 协议和报文头结构</h2><p>http协议自身是无状态的，他的设计之初是为了展示的</p>
<p>http请求和http响应</p>
<p>curl -I</p>
<p>curl -vI 可以看到请求头</p>
<p>一个HTTP连接的过程中，应用层是请求和响应两种动作</p>
<h3 id="请求报文格式："><a href="#请求报文格式：" class="headerlink" title="请求报文格式："></a>请求报文格式：</h3><hr>
<p><img src="C:\Users\a\AppData\Roaming\Typora\typora-user-images\image-20201028191354432.png" alt="image-20201028191354432"></p>
<p><strong>开始行：方法 /资源 HTTP/协议版本</strong></p>
<p><strong>首部字段行</strong></p>
<p><strong>空行</strong></p>
<p><strong>实体</strong></p>
<p>范例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">HEAD &#x2F; HTTP&#x2F;1.1</span><br><span class="line">Host: www.jd.com</span><br><span class="line">User-Agent: curl&#x2F;7.61.1</span><br><span class="line">Accept: *&#x2F;*</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="响应报文格式："><a href="#响应报文格式：" class="headerlink" title="响应报文格式："></a>响应报文格式：</h3><hr>
<p><img src="C:\Users\a\AppData\Roaming\Typora\typora-user-images\image-20201028191754710.png" alt="image-20201028191754710"></p>
<p><strong>开始行：HTTP/协议版本 状态码 短语</strong></p>
<p><strong>首部字段行</strong></p>
<p><strong>空行</strong></p>
<p><strong>实体</strong></p>
<p>范例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">HTTP&#x2F;1.1 200 OK</span><br><span class="line">Server: nginx</span><br><span class="line">Date: Wed, 28 Oct 2020 11:16:36 GMT</span><br><span class="line">Content-Type: text&#x2F;html; charset&#x3D;utf-8</span><br><span class="line">Content-Length: 111469</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Cache-Control: max-age&#x3D;30</span><br><span class="line">Expires: Wed, 28 Oct 2020 11:16:57 GMT</span><br><span class="line">Ser: 45.242</span><br><span class="line">Vary: Accept-Encoding</span><br><span class="line">Via: BJ-Y-NX-102(EXPIRED), http&#x2F;1.1 ORI-CLOUD-HB-MIX-23 (jcs [cRs f ]), http&#x2F;1.1 HB-CM-1-MIX-171 (jcs [cRs f ])</span><br><span class="line">X-Content-Type-Options: nosniff</span><br><span class="line">X-Frame-Options: SAMEORIGIN</span><br><span class="line">X-Xss-Protection: 1; mode&#x3D;block</span><br><span class="line">Age: 9</span><br><span class="line">Access-Control-Allow-Origin: *</span><br><span class="line">Timing-Allow-Origin: *</span><br><span class="line">X-Trace: 200;200-1603883792026-0-0-0-1-1;200-1603883796681-0-0-0-1-1</span><br><span class="line">Strict-Transport-Security: max-age&#x3D;360</span><br></pre></td></tr></table></figure>



<hr>
<h3 id="HTTP报文格式解释"><a href="#HTTP报文格式解释" class="headerlink" title="HTTP报文格式解释"></a>HTTP报文格式解释</h3><h4 id="Method-方法"><a href="#Method-方法" class="headerlink" title="Method 方法"></a>Method 方法</h4><p>请求方法，标明客户端希望服务器对资源执行的动作，包括：</p>
<ul>
<li>GET：从服务器获取一个资源</li>
<li>HEAD：只从服务器获取文档的响应首部</li>
<li>POST：向服务器输入数据，通常会再由网关程序继续处理</li>
<li>PUT：将请求的主体部分存储在服务器中，比如上传文件</li>
<li>DELETE：请求删除服务器上指定的文档</li>
<li>TRACE：追踪请求到达服务器中间经过的代理服务器</li>
<li>OPTIONS：请求服务器返回对指定资源支持使用的请求方法</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -IX OPTIONS https:&#x2F;&#x2F;www.jd.com</span><br></pre></td></tr></table></figure>

<ul>
<li>CONNECT：建立一个到由目标资源表示的服务器的隧道</li>
<li>PATCH：用于对资源应用部分修改</li>
</ul>
<h4 id="Version-版本"><a href="#Version-版本" class="headerlink" title="Version 版本"></a>Version 版本</h4><p>格式：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">HTTP/&lt;major&gt;.&lt;minor&gt;</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">HTTP&#x2F;1.1</span><br><span class="line">HTTP&#x2F;2.0</span><br></pre></td></tr></table></figure>

<h4 id="http协议状态码"><a href="#http协议状态码" class="headerlink" title="http协议状态码"></a>http协议状态码</h4><p>由三位数字组成，标记请求处理过程中发生的情况</p>
<p>Mozilla的帮助文档</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;developer.mozilla.org&#x2F;zh-CN&#x2F;docs&#x2F;Web&#x2F;HTTP&#x2F;Status?utm_source&#x3D;mozilla&amp;utm_medium&#x3D;devtools-netmonitor&amp;utm_campaign&#x3D;default</span><br></pre></td></tr></table></figure>

<p>http状态码分类：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">100 - 199：信息响应</span><br><span class="line">200 - 299：成功响应</span><br><span class="line">300 - 399：重定向</span><br><span class="line">400 - 499：客户端错误</span><br><span class="line">500 - 599：服务器端错误</span><br></pre></td></tr></table></figure>

<hr>
<p>状态码由：section 10 of RFC 2616定义，地址<br><a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc2616#section-10">https://tools.ietf.org/html/rfc2616#section-10</a></p>
<p>常用的状态码：</p>
<p><strong>200：OK</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">200：OK</span><br><span class="line">	The request has succeeded. The information returned with the responseis dependent on the method used in the request.</span><br></pre></td></tr></table></figure>

<p><strong>301：Move Permanently</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">301：Move Permanently</span><br><span class="line">   	The requested resource has been assigned a new permanent URI and any</span><br><span class="line">   future references to this resource SHOULD use one of the returned</span><br><span class="line">   URIs.  Clients with link editing capabilities ought to automatically</span><br><span class="line">   re-link references to the Request-URI to one or more of the new</span><br><span class="line">   references returned by the server, where possible. This response is</span><br><span class="line">   cacheable unless indicated otherwise.</span><br><span class="line"></span><br><span class="line">   	The new permanent URI SHOULD be given by the Location field in the</span><br><span class="line">   response. Unless the request method was HEAD, the entity of the</span><br><span class="line">   response SHOULD contain a short hypertext note with a hyperlink to</span><br><span class="line">   the new URI(s).</span><br><span class="line"></span><br><span class="line">   	If the 301 status code is received in response to a request other</span><br><span class="line">   than GET or HEAD, the user agent MUST NOT automatically redirect the</span><br><span class="line">   request unless it can be confirmed by the user, since this might</span><br><span class="line">   change the conditions under which the request was issued.</span><br><span class="line"></span><br><span class="line">      Note: When automatically redirecting a POST request after</span><br><span class="line">      receiving a 301 status code, some existing HTTP&#x2F;1.0 user agents</span><br><span class="line">      will erroneously change it into a GET request.</span><br></pre></td></tr></table></figure>

<p><strong>302：Move Temporary</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">The requested resource resides temporarily under a different URI.</span><br><span class="line">  Since the redirection might be altered on occasion, the client SHOULD</span><br><span class="line">  continue to use the Request-URI for future requests.  This response</span><br><span class="line">  is only cacheable if indicated by a Cache-Control or Expires header</span><br><span class="line">  field.</span><br><span class="line"></span><br><span class="line">  	The temporary URI SHOULD be given by the Location field in the</span><br><span class="line">  response. Unless the request method was HEAD, the entity of the</span><br><span class="line">  response SHOULD contain a short hypertext note with a hyperlink to</span><br><span class="line">  the new URI(s).</span><br><span class="line">  </span><br><span class="line">  	If the 302 status code is received in response to a request other</span><br><span class="line">  than GET or HEAD, the user agent MUST NOT automatically redirect the</span><br><span class="line">  request unless it can be confirmed by the user, since this might</span><br><span class="line">  change the conditions under which the request was issued.</span><br><span class="line"></span><br><span class="line">     Note: RFC 1945 and RFC 2068 specify that the client is not allowed</span><br><span class="line">     to change the method on the redirected request.  However, most</span><br><span class="line">     existing user agent implementations treat 302 as if it were a 303</span><br><span class="line">     response, performing a GET on the Location field-value regardless</span><br><span class="line">     of the original request method. The status codes 303 and 307 have</span><br><span class="line">     been added for servers that wish to make unambiguously clear which</span><br><span class="line">     kind of reaction is expected of the client.</span><br></pre></td></tr></table></figure>

<p><strong>304：Not Modified</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">If the client has performed a conditional GET request and access is</span><br><span class="line">  allowed, but the document has not been modified, the server SHOULD</span><br><span class="line">  respond with this status code. The 304 response MUST NOT contain a</span><br><span class="line">  message-body, and thus is always terminated by the first empty line</span><br><span class="line">  after the header fields.</span><br><span class="line"></span><br><span class="line">  The response MUST include the following header fields:</span><br><span class="line">     - Date, unless its omission is required by section 14.18.1</span><br><span class="line">	If a clockless origin server obeys these rules, and proxies and</span><br><span class="line">  		clients add their own Date to any response received without one (as</span><br><span class="line">  		already specified by [RFC 2068], section 14.19), caches will operate</span><br><span class="line">  		correctly.</span><br><span class="line"></span><br><span class="line">     - ETag and&#x2F;or Content-Location, if the header would have been sent</span><br><span class="line">       in a 200 response to the same request</span><br><span class="line"></span><br><span class="line">     - Expires, Cache-Control, and&#x2F;or Vary, if the field-value might</span><br><span class="line">       differ from that sent in any previous response for the same</span><br><span class="line">       variant</span><br><span class="line"></span><br><span class="line">  If the conditional GET used a strong cache validator (see section</span><br><span class="line">  13.3.3), the response SHOULD NOT include other entity-headers.</span><br><span class="line">  Otherwise (i.e., the conditional GET used a weak validator), the</span><br><span class="line">  response MUST NOT include other entity-headers; this prevents</span><br><span class="line">  inconsistencies between cached entity-bodies and updated headers.</span><br><span class="line"></span><br><span class="line">  If a 304 response indicates an entity not currently cached, then the</span><br><span class="line">  cache MUST disregard the response and repeat the request without the</span><br><span class="line">  conditional.</span><br><span class="line"></span><br><span class="line">  If a cache uses a received 304 response to update a cache entry, the</span><br><span class="line">  cache MUST update the entry to reflect any new field values given in</span><br><span class="line">  the response.</span><br></pre></td></tr></table></figure>

<p><strong>307：Temporary Redirect (Internal Redirect)</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">The requested resource resides temporarily under a different URI.</span><br><span class="line">Since the redirection MAY be altered on occasion, the client SHOULD</span><br><span class="line">continue to use the Request-URI for future requests.  This response</span><br><span class="line">is only cacheable if indicated by a Cache-Control or Expires header</span><br><span class="line">field.</span><br><span class="line"></span><br><span class="line">The temporary URI SHOULD be given by the Location field in the</span><br><span class="line">response. Unless the request method was HEAD, the entity of the</span><br><span class="line">response SHOULD contain a short hypertext note with a hyperlink to</span><br><span class="line">the new URI(s) , since many pre-HTTP&#x2F;1.1 user agents do not</span><br><span class="line">understand the 307 status. Therefore, the note SHOULD contain the</span><br><span class="line">information necessary for a user to repeat the original request on</span><br><span class="line">the new URI.</span><br><span class="line"></span><br><span class="line">If the 307 status code is received in response to a request other</span><br><span class="line">than GET or HEAD, the user agent MUST NOT automatically redirect the</span><br><span class="line">request unless it can be confirmed by the user, since this might</span><br><span class="line">change the conditions under which the request was issued.</span><br></pre></td></tr></table></figure>

<p><strong>401：Unauthorized</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">The request requires user authentication. The response MUST include a</span><br><span class="line"> WWW-Authenticate header field (section 14.47) containing a challenge</span><br><span class="line"> applicable to the requested resource. The client MAY repeat the</span><br><span class="line"> request with a suitable Authorization header field (section 14.8). If</span><br><span class="line"> the request already included Authorization credentials, then the 401</span><br><span class="line"> response indicates that authorization has been refused for those</span><br><span class="line"> credentials. If the 401 response contains the same challenge as the</span><br><span class="line"> prior response, and the user agent has already attempted authentication at least once, then    the user SHOULD be presented the entity that was given in the response, since that entity      might include relevant diagnostic information. HTTP access authentication is explained in     &quot;HTTP  Authentication: Basic and Digest Access Authentication&quot; [43].</span><br></pre></td></tr></table></figure>

<p><strong>403：Forbidden</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> The server understood the request, but is refusing to fulfill it.</span><br><span class="line">Authorization will not help and the request SHOULD NOT be repeated.</span><br><span class="line">If the request method was not HEAD and the server wishes to make</span><br><span class="line">public why the request has not been fulfilled, it SHOULD describe the</span><br><span class="line">reason for the refusal in the entity.  If the server does not wish to</span><br><span class="line">make this information available to the client, the status code 404</span><br><span class="line">(Not Found) can be used instead.</span><br></pre></td></tr></table></figure>

<p><strong>404：Not Found</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">	The server has not found anything matching the Request-URI. No</span><br><span class="line">indication is given of whether the condition is temporary or</span><br><span class="line">permanent. The 410 (Gone) status code SHOULD be used if the server</span><br><span class="line">knows, through some internally configurable mechanism, that an old</span><br><span class="line">resource is permanently unavailable and has no forwarding address.</span><br><span class="line">This status code is commonly used when the server does not wish to</span><br><span class="line">reveal exactly why the request has been refused, or when no other</span><br><span class="line">response is applicable.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>500：Internal Server Error</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The server encountered an unexpected condition which prevented it from fulfilling the request.</span><br></pre></td></tr></table></figure>

<p><strong>502：Bad Gateway</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">The server, while acting as a gateway or proxy, received an invalid</span><br><span class="line">response from the upstream server it accessed in attempting to</span><br><span class="line">fulfill the request.</span><br></pre></td></tr></table></figure>

<p><strong>503：Service Unavailable</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">The server is currently unable to handle the request due to a</span><br><span class="line">temporary overloading or maintenance of the server. The implication</span><br><span class="line">is that this is a temporary condition which will be alleviated after</span><br><span class="line">some delay. If known, the length of the delay MAY be indicated in a</span><br><span class="line">Retry-After header. If no Retry-After is given, the client SHOULD</span><br><span class="line">handle the response as it would for a 500 response.</span><br><span class="line"></span><br><span class="line">   Note: The existence of the 503 status code does not imply that a</span><br><span class="line">   server must use it when becoming overloaded. Some servers may wish</span><br><span class="line">   to simply refuse the connection.</span><br></pre></td></tr></table></figure>

<p><strong>504：Gateway Timeout</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">The server, while acting as a gateway or proxy, did not receive a</span><br><span class="line">timely response from the upstream server specified by the URI (e.g.</span><br><span class="line">HTTP, FTP, LDAP) or some other auxiliary server (e.g. DNS) it needed</span><br><span class="line">to access in attempting to complete the request.</span><br><span class="line"></span><br><span class="line">   Note: Note to implementors: some deployed proxies are known to</span><br><span class="line">   return 400 or 500 when DNS lookups time out.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="头部字段"><a href="#头部字段" class="headerlink" title="头部字段"></a>头部字段</h3><p>如果想查哪个头部字段，就去下面的帮助文档中查找，里面可以点开每个字段，查看具体介绍</p>
<p>Mozilla的帮助文档</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;developer.mozilla.org&#x2F;zh-CN&#x2F;docs&#x2F;Web&#x2F;HTTP&#x2F;Headers</span><br></pre></td></tr></table></figure>

<p>键值对形式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">key: value1 value2</span><br></pre></td></tr></table></figure>

<p>根据不同上下文，可将消息头分为：</p>
<ul>
<li>通用消息头：General headers，同时适用于请求和响应消息，但与最终消息主体中传输的数据无关的消息头</li>
<li>请求消息头：Request headers，包含更多有关要获取的资源或客户端本身信息的消息头</li>
<li>响应消息头：Response headers，包含有关响应的补充信息，如其位置或服务器本身（名称和版本）的消息头</li>
<li>实体消息头：Entity headers，包含有关实体主体的更多信息，比如主体长（Content-Length）读或其他MIME类型</li>
</ul>
<p><strong>查询过的字段：</strong></p>
<p>age：资源存在于代理服务器中的时间，单位是秒</p>
<p>expires：资源的过期时间，这个时间取决于客户端本地的时间</p>
<p>cache-control：</p>
<ul>
<li>max-age：缓存资源的生存时间，这个时间取决于请求报文发送时间，即请求报文发送时间加max-age，就是这个缓存需要刷新的时间</li>
</ul>
<h3 id="Cookie和Session"><a href="#Cookie和Session" class="headerlink" title="Cookie和Session"></a>Cookie和Session</h3><p>介绍文档：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;developer.mozilla.org&#x2F;zh-CN&#x2F;docs&#x2F;Web&#x2F;HTTP&#x2F;Cookies</span><br></pre></td></tr></table></figure>

<p>HTTP协议本身无状态，无法记录用户信息；</p>
<p>因为HTTP协议在最初设计的目的是为了传输文档，后面文档定义了格式，也就是HTML，因此对HTTP来说没有必要有状态；</p>
<p>可是随着Web的不断发展，很多业务都需要状态–&gt;会话管理机制；</p>
<p><strong>会话管理：管理浏览器客户端和服务器端之间会话过程中产生的会话数据</strong>；</p>
<p>为了会话管理，HTTP就需要传输大量重复会话信息，造成了大量的网络带宽消耗，于是出现了Cookie和Session技术；</p>
<h4 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h4><blockquote>
<p>​    Cookie基于HTTP协议，也叫Web Cookie或浏览器Cookie，是服务器发送到用户浏览器并保存在客户端本地的一小块数据，它会在浏览器下次向同一服务器再发起请求时被携带并发送到服务器上。通常，它用于告知服务端两个请求是否来自同一个浏览器，它可以保持用户的登录状态。它可以让无状态的HTTP记录状态信息。</p>
</blockquote>
<p><strong>Cookie主要使用：</strong></p>
<ul>
<li>会话状态管理，比如用户登录状态、购物车、游戏分数</li>
<li>个性化设置，比如用户自定义设置、主题</li>
<li>浏览器行为追踪</li>
</ul>
<p>Cookie的工作流程：</p>
<p>客户端浏览器连接服务器端–&gt;服务器端在向客户端发送响应报文时添加上一个<code>Set-Cookie</code>字段–&gt;客户端浏览器保存Cookie，下次给服务器发送报文时加上Cookie–&gt;服务器端收到报文后，检查Cookie是哪个主机的，然后根据Cookie记录的信息把之前的状态信息发给客户端</p>
<p>Set-Cookie字段：</p>
<ul>
<li>Name=VALUE 赋予Cookie的名称和值</li>
<li>expire=DATE  Cookie的有效期，如果没写明白，那么就是会话结束时到期；过期时间由客户端时间决定<ul>
<li>会话期Cookie：在一个会话期中的Cookie，会话结束就删除</li>
<li>持久性Cookie：基于硬盘保存的Cookie，有特殊的expire和age</li>
</ul>
</li>
<li>path=/PATH ，指明了主机下哪些路径可以接受Cookie</li>
<li>domain=域名，指定了哪些主机可以接受Cookie</li>
<li>Secure：标记为Secure的Cookie应该只通过HTTPS协议传输。但是敏感信息不应该通过Cookie传输</li>
<li>HTTPOnly  <code>HttpOnly</code> 类型的 Cookie 用于阻止了JavaScript 对其的访问性而能在一定程度上缓解此类攻击。</li>
</ul>
<p>浏览器对Cookie的限制：一个页面的Cookie个数应该小于20个，总大小小于4KB</p>
<p>例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-Cookie: id&#x3D;123; Expires&#x3D;Wed, 21 Oct 2020 15:22:00 GMT;</span><br></pre></td></tr></table></figure>

<p>Cookie和Session与浏览器有关，更换浏览器就需要更换Cookie</p>
<p>Cookie和sessionID：都是服务器生成的</p>
<p>Cookie把sessionID传给用户；</p>
<p>Cookie把sessionID传回服务器；</p>
<h4 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h4><p>session是相对于cookie的另外一个状态保持的解决方案，它是通过服务器来保持状态的。session指的是服务器上为每个客户端所开辟的独立存储空间，在其中保持的信息就是用于保存状态的。</p>
<p>服务器在程序运行过程中生成session，每个session有唯一的sessionid。sessionid就像是session的主键，用来标识这个session空间中的内容。</p>
<p>sessionid是怎么给客户端的？</p>
<ul>
<li>URL重写，让客户端获得sessionid</li>
<li>通过cookie存取，但是这个cookie是特殊的cookie，它不是一个磁盘文件，而是存在于内存中</li>
</ul>
<h4 id="session和cookie的区别"><a href="#session和cookie的区别" class="headerlink" title="session和cookie的区别"></a>session和cookie的区别</h4><ul>
<li>cookie通常是服务器端生成，保存在客户端，而session是在服务器端生成，保存在服务器端的内存中，session对服务器来说是一个负载</li>
<li>session比cookie安全，因为session在服务器端，cookie在客户端</li>
<li>cookie有会话级的cookie和持久的cookie，session没有时间限制，需要定期清除</li>
<li>session中有很多数据，只是他只把sessionid这个主要的数据发送给客户端，客户端下次访问的时候带上sessionid就可以匹配到session的所有数据</li>
</ul>
<p>cookie缺点：</p>
<ul>
<li>cookie不安全</li>
<li>cookie占带宽</li>
</ul>
<p>session缺点：</p>
<ul>
<li>不容易在多台服务器之间共享</li>
<li>session保存在服务器内存中，对服务器是个负载</li>
</ul>
<p>实际生产过程是cookie和session混合使用</p>
<h2 id="Web相关工具"><a href="#Web相关工具" class="headerlink" title="Web相关工具"></a>Web相关工具</h2><h3 id="1-links"><a href="#1-links" class="headerlink" title="1 links"></a>1 links</h3><p>命令行浏览器</p>
<h3 id="2-wget"><a href="#2-wget" class="headerlink" title="2 wget"></a>2 wget</h3><p>可以当浏览器用，在容器中常用，因为容器中很可能缺少curl等工具，下面的命令可以把网页内容下载下来，使用cat进行查看</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -qO a.html www.jd.com</span><br></pre></td></tr></table></figure>

<h3 id="3-curl"><a href="#3-curl" class="headerlink" title="3 curl"></a>3 curl</h3><p>测试使用</p>
<p>下载网页</p>
<p>curl -o a.hrml <a target="_blank" rel="noopener" href="http://www.xxx.haha/html">www.xxx.haha/html</a></p>
<p>性能测试工具</p>
<p>ab，不要乱用，本身就是有攻击性质</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ab -c 100 -n 2000 www.baidu.com</span><br></pre></td></tr></table></figure>


    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/11/18/NoSQL%E6%95%B0%E6%8D%AE%E5%BA%93Redis/" rel="prev" title="Redis">
      <i class="fa fa-chevron-left"></i> Redis
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/11/18/KVM%20---%20Kernel-Based%20Virtual%20Machine/" rel="next" title="KVM">
      KVM <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#HTTP%E5%8D%8F%E8%AE%AE%E5%92%8CAPACHE"><span class="nav-number">1.</span> <span class="nav-text">HTTP协议和APACHE</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9D%82%E8%B0%88"><span class="nav-number">1.1.</span> <span class="nav-text">杂谈</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1"><span class="nav-number">1.2.</span> <span class="nav-text">1</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-HTTP-%E8%B6%85%E6%96%87%E6%9C%AC%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AE"><span class="nav-number">1.2.1.</span> <span class="nav-text">1.1 HTTP 超文本传输协议</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%93%E5%BC%80%E4%B8%80%E4%B8%AA%E7%BD%91%E9%A1%B5%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88%E4%B9%8B%E6%B5%8F%E8%A7%88%E5%99%A8%E6%98%AF%E5%A6%82%E4%BD%95%E5%B7%A5%E4%BD%9C%E7%9A%84"><span class="nav-number">1.2.2.</span> <span class="nav-text">打开一个网页发生了什么之浏览器是如何工作的</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#web%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E8%AF%AD%E8%A8%80%EF%BC%9A"><span class="nav-number">1.2.3.</span> <span class="nav-text">web前端开发语言：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MIME"><span class="nav-number">1.2.4.</span> <span class="nav-text">MIME</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#URI%E5%92%8CURL"><span class="nav-number">1.2.5.</span> <span class="nav-text">URI和URL</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BD%91%E7%AB%99%E8%AE%BF%E9%97%AE%E9%87%8F%E7%BB%9F%E8%AE%A1"><span class="nav-number">1.2.6.</span> <span class="nav-text">网站访问量统计</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HTTP%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%9C%BA%E5%88%B6"><span class="nav-number">1.2.7.</span> <span class="nav-text">HTTP的工作机制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HTTP%E8%BF%9E%E6%8E%A5%E8%AF%B7%E6%B1%82-%EF%BC%9F"><span class="nav-number">1.2.8.</span> <span class="nav-text">HTTP连接请求 ？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HTTP%E5%8D%8F%E8%AE%AE%E7%89%88%E6%9C%AC"><span class="nav-number">1.2.9.</span> <span class="nav-text">HTTP协议版本</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#http-1-0%E5%92%8Chttp-1-1%E5%AD%98%E5%9C%A8%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="nav-number">1.2.10.</span> <span class="nav-text">http&#x2F;1.0和http&#x2F;1.1存在的区别</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HTTP%E8%AF%B7%E6%B1%82%E8%AE%BF%E9%97%AE%E7%9A%84%E5%AE%8C%E6%95%B4%E8%BF%87%E7%A8%8B"><span class="nav-number">1.2.11.</span> <span class="nav-text">HTTP请求访问的完整过程</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-HTTPD%E5%AE%89%E8%A3%85%E5%92%8C%E7%BB%84%E6%88%90"><span class="nav-number">1.3.</span> <span class="nav-text">2 HTTPD安装和组成</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%B8%B8%E8%A7%81HTTP%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%A8%8B%E5%BA%8F"><span class="nav-number">1.3.1.</span> <span class="nav-text">1.常见HTTP服务器程序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-Apache%E4%BB%8B%E7%BB%8D"><span class="nav-number">1.3.2.</span> <span class="nav-text">2.Apache介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MPM-multi-processing-module"><span class="nav-number">1.3.3.</span> <span class="nav-text">MPM multi-processing module</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E7%9B%B8%E5%85%B3%E6%96%87%E4%BB%B6"><span class="nav-number">1.3.4.</span> <span class="nav-text">3.相关文件</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">1.3.4.1.</span> <span class="nav-text">配置文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E5%8D%95%E5%85%83%E6%96%87%E4%BB%B6%EF%BC%9A"><span class="nav-number">1.3.4.2.</span> <span class="nav-text">服务单元文件：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AF%AD%E6%B3%95%E6%A3%80%E6%9F%A5%E5%91%BD%E4%BB%A4%EF%BC%9Ahttp-t"><span class="nav-number">1.3.4.3.</span> <span class="nav-text">语法检查命令：http -t</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8E%A7%E5%88%B6%E5%B7%A5%E5%85%B7%EF%BC%9Aapachectl"><span class="nav-number">1.3.4.4.</span> <span class="nav-text">控制工具：apachectl</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AB%99%E7%82%B9%E7%BD%91%E9%A1%B5%E6%96%87%E6%A1%A3%E5%AD%98%E6%94%BE%E7%9B%AE%E5%BD%95%EF%BC%9A-var-www-html"><span class="nav-number">1.3.4.5.</span> <span class="nav-text">站点网页文档存放目录：&#x2F;var&#x2F;www&#x2F;html</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A8%A1%E5%9D%97%E6%96%87%E4%BB%B6%E5%AD%98%E6%94%BE%E8%B7%AF%E5%BE%84%EF%BC%9A"><span class="nav-number">1.3.4.6.</span> <span class="nav-text">模块文件存放路径：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%97%A5%E5%BF%97%E8%B7%AF%E5%BE%84%EF%BC%9A-var-log-httpd"><span class="nav-number">1.3.4.7.</span> <span class="nav-text">日志路径：&#x2F;var&#x2F;log&#x2F;httpd</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85"><span class="nav-number">1.3.5.</span> <span class="nav-text">4.编译安装</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-HTTPD%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E9%80%89%E9%A1%B9"><span class="nav-number">1.4.</span> <span class="nav-text">3 HTTPD常用配置选项</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-serverName"><span class="nav-number">1.4.1.</span> <span class="nav-text">1.serverName</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%8C%85%E5%90%AB%E5%85%B6%E4%BB%96%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">1.4.2.</span> <span class="nav-text">2.包含其他配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E7%9B%91%E5%90%AC%E7%9A%84IP%E5%92%8CPort"><span class="nav-number">1.4.3.</span> <span class="nav-text">3.监听的IP和Port</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E6%8C%81%E4%B9%85%E8%BF%9E%E6%8E%A5"><span class="nav-number">1.4.4.</span> <span class="nav-text">4.持久连接</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-DSO%EF%BC%88Dynamic-Shared-Object%EF%BC%89"><span class="nav-number">1.4.5.</span> <span class="nav-text">5.DSO（Dynamic Shared Object）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-MPM%EF%BC%88Multi-Processing-Module%EF%BC%89%E5%A4%9A%E8%B7%AF%E5%A4%84%E7%90%86%E6%A8%A1%E5%9D%97"><span class="nav-number">1.4.6.</span> <span class="nav-text">6.MPM（Multi-Processing Module）多路处理模块</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E6%AF%8F%E4%B8%AAMPM%E6%A8%A1%E5%9D%97%E7%9A%84%E9%85%8D%E7%BD%AE%EF%BC%9Aprefork"><span class="nav-number">1.4.6.1.</span> <span class="nav-text">查看每个MPM模块的配置：prefork</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#worker"><span class="nav-number">1.4.6.2.</span> <span class="nav-text">worker</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#event"><span class="nav-number">1.4.6.3.</span> <span class="nav-text">event</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-%E4%BF%AE%E6%94%B9%E4%B8%BB%E9%A1%B5%E8%B7%AF%E5%BE%84%EF%BC%8C%E9%9C%80%E8%A6%81%E6%B7%BB%E5%8A%A0%E6%8E%88%E6%9D%83%E9%80%89%E9%A1%B9"><span class="nav-number">1.4.7.</span> <span class="nav-text">7.修改主页路径，需要添加授权选项</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-%E5%AE%9A%E4%B9%89%E7%AB%99%E7%82%B9%E4%B8%BB%E9%A1%B5%E9%9D%A2"><span class="nav-number">1.4.8.</span> <span class="nav-text">8.定义站点主页面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-%E5%AF%B9%E8%AE%BF%E9%97%AE%E8%B5%84%E6%BA%90%E7%9A%84%E6%8E%A7%E5%88%B6"><span class="nav-number">1.4.9.</span> <span class="nav-text">9.对访问资源的控制</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8E%E7%9B%AE%E5%BD%95%E7%9A%84%E6%8E%A7%E5%88%B6"><span class="nav-number">1.4.9.0.1.</span> <span class="nav-text">基于目录的控制</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8E%E6%96%87%E4%BB%B6%E7%9A%84%E6%8E%A7%E5%88%B6"><span class="nav-number">1.4.9.0.2.</span> <span class="nav-text">基于文件的控制</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8E%E6%96%87%E4%BB%B6%E9%80%9A%E9%85%8D%E7%AC%A6"><span class="nav-number">1.4.9.0.3.</span> <span class="nav-text">基于文件通配符</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8E%E6%89%A9%E5%B1%95%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="nav-number">1.4.9.0.4.</span> <span class="nav-text">基于扩展正则表达式</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-%E9%92%88%E5%AF%B9%E7%9B%AE%E5%BD%95%E5%92%8CURL%E5%AE%9E%E7%8E%B0%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6"><span class="nav-number">1.4.10.</span> <span class="nav-text">10.针对目录和URL实现访问控制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-%E5%9F%BA%E4%BA%8E%E5%AE%A2%E6%88%B7%E7%AB%AFIP%E5%9C%B0%E5%9D%80%E5%AE%9E%E7%8E%B0%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6"><span class="nav-number">1.4.11.</span> <span class="nav-text">11.基于客户端IP地址实现访问控制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#12-%E6%97%A5%E5%BF%97%E8%AE%BE%E5%AE%9A"><span class="nav-number">1.4.12.</span> <span class="nav-text">12.日志设定</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#13-%E8%AE%BE%E5%AE%9A%E9%BB%98%E8%AE%A4%E5%AD%97%E7%AC%A6%E9%9B%86"><span class="nav-number">1.4.13.</span> <span class="nav-text">13.设定默认字符集</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#14-%E5%AE%9A%E4%B9%89%E8%B7%AF%E5%BE%84%E5%88%AB%E5%90%8D"><span class="nav-number">1.4.14.</span> <span class="nav-text">14.定义路径别名</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#15-%E5%9F%BA%E4%BA%8E%E7%94%A8%E6%88%B7%E5%90%8D%E7%9A%84%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6"><span class="nav-number">1.4.15.</span> <span class="nav-text">15.基于用户名的访问控制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%93%8D%E4%BD%9C%EF%BC%9A%E5%AE%9E%E7%8E%B0%E5%AE%B6%E7%9B%AE%E5%BD%95%E5%85%B1%E4%BA%AB"><span class="nav-number">1.4.16.</span> <span class="nav-text">操作：实现家目录共享</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#16-%E6%93%8D%E4%BD%9C%EF%BC%9A%E9%9A%90%E8%97%8F%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%89%88%E6%9C%AC%E4%BF%A1%E6%81%AF"><span class="nav-number">1.4.17.</span> <span class="nav-text">16.操作：隐藏服务器版本信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#17-%E6%93%8D%E4%BD%9C%EF%BC%9A%E7%A6%81%E6%AD%A2trace%E6%96%B9%E6%B3%95"><span class="nav-number">1.4.18.</span> <span class="nav-text">17.操作：禁止trace方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#18-%E6%93%8D%E4%BD%9C%EF%BC%9A%E7%8A%B6%E6%80%81%E9%A1%B5%E9%9D%A2"><span class="nav-number">1.4.19.</span> <span class="nav-text">18.操作：状态页面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%9A%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BA"><span class="nav-number">1.4.20.</span> <span class="nav-text">多虚拟主机</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AC%AC%E4%B8%80%E7%A7%8D%EF%BC%9A%E4%BD%BF%E7%94%A8%E7%AB%AF%E5%8F%A3%E8%BF%9B%E8%A1%8C%E5%8C%BA%E5%88%86"><span class="nav-number">1.4.20.1.</span> <span class="nav-text">第一种：使用端口进行区分</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AC%AC%E4%BA%8C%E7%A7%8D%EF%BC%9A%E4%BD%BF%E7%94%A8IP%E8%BF%9B%E8%A1%8C%E5%8C%BA%E5%88%86"><span class="nav-number">1.4.20.2.</span> <span class="nav-text">第二种：使用IP进行区分</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AC%AC%E4%B8%89%E7%A7%8D%EF%BC%9A%E5%9F%BA%E4%BA%8E%E5%85%A8%E9%99%90%E5%AE%9A%E5%9F%9F%E5%90%8D%E8%BF%9B%E8%A1%8C%E5%8C%BA%E5%88%86"><span class="nav-number">1.4.20.3.</span> <span class="nav-text">第三种：基于全限定域名进行区分</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%8B%E7%BC%A9"><span class="nav-number">1.4.21.</span> <span class="nav-text">压缩</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0HTTPS"><span class="nav-number">1.4.22.</span> <span class="nav-text">实现HTTPS</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#URL%E9%87%8D%E5%AE%9A%E5%90%91"><span class="nav-number">1.4.23.</span> <span class="nav-text">URL重定向</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HSTS%E6%8A%80%E6%9C%AF"><span class="nav-number">1.4.24.</span> <span class="nav-text">HSTS技术</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%AD%A3%E5%90%91%E4%BB%A3%E7%90%86%E5%92%8C%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86"><span class="nav-number">1.4.25.</span> <span class="nav-text">正向代理和反向代理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Sendfile-%E6%9C%BA%E5%88%B6"><span class="nav-number">1.4.26.</span> <span class="nav-text">Sendfile 机制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8C%87%E5%AE%9A%E6%96%87%E4%BB%B6%E7%B1%BB%E5%9E%8B-content-type"><span class="nav-number">1.4.27.</span> <span class="nav-text">指定文件类型 content type</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#http-%E5%8D%8F%E8%AE%AE%E5%92%8C%E6%8A%A5%E6%96%87%E5%A4%B4%E7%BB%93%E6%9E%84"><span class="nav-number">1.5.</span> <span class="nav-text">http 协议和报文头结构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%B7%E6%B1%82%E6%8A%A5%E6%96%87%E6%A0%BC%E5%BC%8F%EF%BC%9A"><span class="nav-number">1.5.1.</span> <span class="nav-text">请求报文格式：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%93%8D%E5%BA%94%E6%8A%A5%E6%96%87%E6%A0%BC%E5%BC%8F%EF%BC%9A"><span class="nav-number">1.5.2.</span> <span class="nav-text">响应报文格式：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HTTP%E6%8A%A5%E6%96%87%E6%A0%BC%E5%BC%8F%E8%A7%A3%E9%87%8A"><span class="nav-number">1.5.3.</span> <span class="nav-text">HTTP报文格式解释</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Method-%E6%96%B9%E6%B3%95"><span class="nav-number">1.5.3.1.</span> <span class="nav-text">Method 方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Version-%E7%89%88%E6%9C%AC"><span class="nav-number">1.5.3.2.</span> <span class="nav-text">Version 版本</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#http%E5%8D%8F%E8%AE%AE%E7%8A%B6%E6%80%81%E7%A0%81"><span class="nav-number">1.5.3.3.</span> <span class="nav-text">http协议状态码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%B4%E9%83%A8%E5%AD%97%E6%AE%B5"><span class="nav-number">1.5.4.</span> <span class="nav-text">头部字段</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Cookie%E5%92%8CSession"><span class="nav-number">1.5.5.</span> <span class="nav-text">Cookie和Session</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Cookie"><span class="nav-number">1.5.5.1.</span> <span class="nav-text">Cookie</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Session"><span class="nav-number">1.5.5.2.</span> <span class="nav-text">Session</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#session%E5%92%8Ccookie%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="nav-number">1.5.5.3.</span> <span class="nav-text">session和cookie的区别</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Web%E7%9B%B8%E5%85%B3%E5%B7%A5%E5%85%B7"><span class="nav-number">1.6.</span> <span class="nav-text">Web相关工具</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-links"><span class="nav-number">1.6.1.</span> <span class="nav-text">1 links</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-wget"><span class="nav-number">1.6.2.</span> <span class="nav-text">2 wget</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-curl"><span class="nav-number">1.6.3.</span> <span class="nav-text">3 curl</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">huihui</p>
  <div class="site-description" itemprop="description">学习和看笔记</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">10</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">huihui</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  













<script>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : 'forest',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script>


  

  

</body>
</html>
