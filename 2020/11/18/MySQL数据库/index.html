<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="MySQL是什么">
<meta property="og:type" content="article">
<meta property="og:title" content="MYSQL">
<meta property="og:url" content="http://example.com/2020/11/18/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93/index.html">
<meta property="og:site_name" content="辉辉的数据库">
<meta property="og:description" content="MySQL是什么">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="c:/Users/a/Desktop/dfff6efbab0d51a715a36f867daeacf8.png">
<meta property="og:image" content="c:/Users/a/AppData/Roaming/Typora/typora-user-images/image-20200925200135006.png">
<meta property="og:image" content="c:/Users/a/AppData/Roaming/Typora/typora-user-images/image-20200926192208219.png">
<meta property="og:image" content="c:/Users/a/AppData/Roaming/Typora/typora-user-images/image-20201009104011312.png">
<meta property="og:image" content="c:/Users/a/AppData/Roaming/Typora/typora-user-images/image-20200928095706768.png">
<meta property="og:image" content="c:/Users/a/AppData/Roaming/Typora/typora-user-images/image-20200928095754867.png">
<meta property="og:image" content="c:/Users/a/AppData/Roaming/Typora/typora-user-images/image-20200929165555349.png">
<meta property="og:image" content="c:/Users/a/AppData/Roaming/Typora/typora-user-images/image-20200929165621541.png">
<meta property="og:image" content="c:/Users/a/AppData/Roaming/Typora/typora-user-images/image-20200929171429834.png">
<meta property="og:image" content="c:/Users/a/AppData/Roaming/Typora/typora-user-images/image-20200929173016961.png">
<meta property="article:published_time" content="2020-11-18T00:48:10.000Z">
<meta property="article:modified_time" content="2020-11-19T00:46:10.859Z">
<meta property="article:author" content="huihui">
<meta property="article:tag" content="notes">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="c:/Users/a/Desktop/dfff6efbab0d51a715a36f867daeacf8.png">

<link rel="canonical" href="http://example.com/2020/11/18/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>MYSQL | 辉辉的数据库</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">辉辉的数据库</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">我们要丈量大地！</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/11/18/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="huihui">
      <meta itemprop="description" content="学习和看笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="辉辉的数据库">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          MYSQL
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-11-18 08:48:10" itemprop="dateCreated datePublished" datetime="2020-11-18T08:48:10+08:00">2020-11-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-11-19 08:46:10" itemprop="dateModified" datetime="2020-11-19T08:46:10+08:00">2020-11-19</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="MySQL是什么"><a href="#MySQL是什么" class="headerlink" title="MySQL是什么"></a>MySQL是什么</h2><a id="more"></a>

<ul>
<li><p>关系型数据库管理软件–RDBMS</p>
<ul>
<li>数据库是数据库，MySQL是管理数据库的软件</li>
<li>实体-联系模型E-R<ul>
<li>实体Entity：客观存在并且可以相互区分的客观事物或抽象事件称为实体</li>
<li>属性：实体所具有的特征或性质</li>
<li>联系：联系是数据之间的关联集合，是客观存在的应用语义链<ul>
<li>实体和属性之间的联系</li>
<li>实体和实体之间的联系</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>数据冗余和性能的矛盾关系，冗余越小，在查询数据的时候就会越消耗性能</p>
</li>
<li><p>数据库的范式，有很多范式，但是一般数据只需满足第三范式（3NF）即可</p>
<ul>
<li><p>第一范式：1NF（normal form）</p>
<p>无重复的列，每一列都是不可分割的基本数据项，同一列中不能有多个值，即实体中的某个属性不能有多个值或者不能有重复的属性，确保每一列的原子性。除去同类型的字段，就是无重复的列。</p>
<p>总结：消除重复列</p>
<p>比如下面表中xiaolv，他的年龄只能有一个，不能有两个</p>
</li>
</ul>
<table>
<thead>
<tr>
<th align="center">name</th>
<th align="center">age</th>
</tr>
</thead>
<tbody><tr>
<td align="center">xiaoli</td>
<td align="center">20</td>
</tr>
<tr>
<td align="center">xiaolv</td>
<td align="center">20,22（两个值是错误的）</td>
</tr>
</tbody></table>
<ul>
<li><p>第二范式</p>
<p>第二范式必须先满足第一范式，属性完全依赖于主键，要求表中的每个行必须可以被唯一的区分，通常为表加上每行的唯一标识PK，非PK的字段需要与整个PK有直接的相关性</p>
<p>总结：消除部分依赖</p>
<p>比如下面的ID就是主键，每行都不相同，name和age字段依赖于ID</p>
</li>
</ul>
<table>
<thead>
<tr>
<th align="center">ID</th>
<th align="center">name</th>
<th align="center">age</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="center">xiaolv</td>
<td align="center">20</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">xiaohui</td>
<td align="center">21</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">xiaozhe</td>
<td align="center">20</td>
</tr>
</tbody></table>
<ul>
<li><p>第三范式</p>
<p>第三范式必须先满足第二范式，不依赖于其他非主属性。第三范式要求一个数据表中不包含已在其他表中已包含的非主键字信息，非PK的字段间不能有从属关系</p>
<p>总结：消除全部依赖</p>
</li>
</ul>
</li>
<li><p>mysql客户端工具：</p>
<ul>
<li>mysql</li>
<li>mysqladmin</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -ppasswd -Pport</span><br><span class="line"></span><br><span class="line">mysql [options] [database]</span><br><span class="line">-A,--no-auto-rehash 禁止补全</span><br><span class="line">-u,--user&#x3D; 用户名，默认为root</span><br><span class="line">-h,--host&#x3D; 服务器名，默认为localhost</span><br><span class="line">-p,--password 用户密码，默认为空密码</span><br><span class="line">-P,--port&#x3D; 服务器端口</span><br><span class="line">-S,--socket 指定连接socket文件路径</span><br><span class="line">-D，--datebase&#x3D; 指定默认数据库</span><br><span class="line">-C，--compress 启用压缩</span><br><span class="line">-e &quot;SQL&quot; 执行SQL命令</span><br><span class="line">-V,--version 显示版本</span><br><span class="line">-v,--verbos 显示详细信息</span><br><span class="line">--print-defaults 获取程序默认使用的配置</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysqladmin -uroot -ppasswd ping</span><br><span class="line">mysqladmin [options] command command ...</span><br></pre></td></tr></table></figure>
</li>
<li><p>服务器端配置</p>
</li>
</ul>
<p>服务器端（mysqld）配置：</p>
<p>1.命令行选项</p>
<p>2.配置文件</p>
<ul>
<li><p>/etc/my.cnf</p>
</li>
<li><p>/etc/my.cnf.d/mysql-server.cnf</p>
<ul>
<li><p>```<br> 13 [mysqld]<br> 14 datadir=/var/lib/mysql<br> 15 socket=/var/lib/mysql/mysql.sock<br> 16 log-error=/var/log/mysql/mysqld.log<br> 17 pid-file=/run/mysqld/mysqld.pid</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">socket地址：</span><br><span class="line"></span><br><span class="line">* ip socket地址：监听在tcp的3306端口，支持远程通信，侦听3306&#x2F;tcp端口可以绑定有一个或全部接口的IP上</span><br><span class="line">* Unix sock：监听在sock文件上，仅支持本机通信，如：&#x2F;var&#x2F;lib&#x2F;mysql.sock,说明，host为localhost时自动使用unix sock</span><br><span class="line"></span><br><span class="line">## MySQL数据库怎么安装</span><br><span class="line"></span><br><span class="line">在实际生产环境中大多使用编译安装或二进制安装</span><br><span class="line"></span><br><span class="line">* 编写脚本，实现二进制方式安装MySQL</span><br><span class="line"></span><br><span class="line">MySQL的三大分支</span><br><span class="line"></span><br><span class="line">* mysql</span><br><span class="line">* mariadb</span><br><span class="line">* percona server</span><br><span class="line"></span><br><span class="line">数据库应该尽量少被访问，尽量分担数据库的压力</span><br><span class="line"></span><br><span class="line">脚本在二进制安装.md中</span><br><span class="line"></span><br><span class="line">* yum install </span><br><span class="line">* 编译安装</span><br><span class="line">  * 建议内存4G以上</span><br><span class="line">  </span><br><span class="line">  * 下载并解压源码包</span><br><span class="line">  </span><br><span class="line">  * 源码编译安装，使用cmake，指定一些环境</span><br><span class="line">  </span><br><span class="line">  * &#96;&#96;&#96;</span><br><span class="line">    cd mariadb-10.2.18&#x2F;cmake . \</span><br><span class="line">    -DCMAKE_INSTALL_PREFIX&#x3D;&#x2F;app&#x2F;mysql \</span><br><span class="line">    -DMYSQL_DATADIR&#x3D;&#x2F;data&#x2F;mysql&#x2F; \</span><br><span class="line">    -DSYSCONFDIR&#x3D;&#x2F;etc&#x2F;  \</span><br><span class="line">    -DMYSQL_USER&#x3D;mysql \</span><br><span class="line">    -DWITH_INNOBASE_STORAGE_ENGINE&#x3D;1 \</span><br><span class="line">    -DWITH_ARCHIVE_STORAGE_ENGINE&#x3D;1 \</span><br><span class="line">    -DWITH_BLACKHOLE_STORAGE_ENGINE&#x3D;1 \</span><br><span class="line">    -DWITH_PARTITION_STORAGE_ENGINE&#x3D;1  \</span><br><span class="line">    -DWITHOUT_MROONGA_STORAGE_ENGINE&#x3D;1 \</span><br><span class="line">    -DWITH_DEBUG&#x3D;0 \</span><br><span class="line">    -DWITH_READLINE&#x3D;1 \</span><br><span class="line">    -DWITH_SSL&#x3D;system \</span><br><span class="line">    -DWITH_ZLIB&#x3D;system\</span><br><span class="line">    -DWITH_LIBWRAP&#x3D;0 \</span><br><span class="line">    -DENABLED_LOCAL_INFILE&#x3D;1  \</span><br><span class="line">    -DMYSQL_UNIX_ADDR&#x3D;&#x2F;data&#x2F;mysql&#x2F;mysql.sock \</span><br><span class="line">    -DDEFAULT_CHARSET&#x3D;utf8 \</span><br><span class="line">    -DDEFAULT_COLLATION&#x3D;utf8_general_ci</span><br><span class="line">    make &amp;&amp; make install </span><br></pre></td></tr></table></figure>

<p>提示：如果出错，执行rm -f CMakeCache.txt</p>
<p>剩下的步骤与二进制安装相同</p>
</li>
</ul>
</li>
<li><p>二进制安装，相比编译安装就是少了编译过程</p>
<ul>
<li>1.创建mysql组和用户</li>
<li>2.创建数据库存放目录，修改这个目录所有者、所有组的信息</li>
<li>3.下载源码，解压到/usr/local下</li>
<li>4.创建软链接 ln -s /usr/local/mysqlxxxx   mysql</li>
<li>5.配置文件复制到/etc/my.cnf</li>
<li>6.使用自带脚本生成数据库文件</li>
<li>7.使用自带脚本制作开机启动脚本</li>
<li>8.配置开机启动</li>
<li>9.启动安全加固脚本</li>
</ul>
</li>
</ul>
<p>1.MySQL账户</p>
<p>2.MySQL配置文件</p>
<p>3.MySQL工具</p>
<p>4.MySQL数据库文件</p>
<p>5.MySQL登录方式文件</p>
<p>mysql</p>
<p>mysqladmin</p>
<h2 id="SQL语言"><a href="#SQL语言" class="headerlink" title="SQL语言"></a>SQL语言</h2><p>SQL的注释：</p>
<ul>
<li>– 注释内容 单行注释，注意有空格</li>
<li>/**/ 多行注释</li>
</ul>
<p>MySQL注释：</p>
<ul>
<li>“#”号后面跟注释内容，有空格</li>
</ul>
<p>SQL关键字建议大写</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GRANT ALL PRIVILEGES ON *.* TO &#39;root&#39;@&#39;%&#39; IDENTIFIED BY &#39;passwd&#39; WITH GRANT OPTION;</span><br><span class="line">#这个是指定访问的IP和账号</span><br><span class="line">delete from user where host&#x3D;xxx and user&#x3D;xxx;</span><br><span class="line">#这个是删除一个用户</span><br><span class="line">flush privileges;</span><br><span class="line">#刷新数据库</span><br></pre></td></tr></table></figure>

<p>数据库的组件：</p>
<p>数据库、表、索引、视图、用户、存储过程、函数、触发器、事件调度器</p>
<p>命名规则：</p>
<ul>
<li>必须以字母开头，可包括数字和三个特殊字符（# _ $）</li>
<li>不要使用MySQL的保留字</li>
</ul>
<p>SQL的语句分类：</p>
<ul>
<li><p>DDL:数据定义语言 Data Defination Language</p>
<p>表：二维关系</p>
<p>设计表：遵循规范</p>
<p>定义：字段，索引</p>
<p>​    字段：字段名，字段数据类型，修饰符</p>
<p>​    约束，索引：应该创建在经常用作查询条件的字段上</p>
<ul>
<li><p>CREATE</p>
<p>第一种创建表的方式：直接创建</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">(root@localhost) [ahui]&gt;create table if not exists student (</span><br><span class="line">id int UNSIGNED AUTO_INCREMENT PRIMARY KEY,</span><br><span class="line">name VARCHAR(20) NOT NULL,</span><br><span class="line">age tinyint UNSIGNED,</span><br><span class="line">gender ENUM(&#39;F&#39;,&#39;M&#39;) default &#39;M&#39;)ENGINE&#x3D;InnoDB AUTO_INCREMENT&#x3D;10 DEFAULT CHARSET&#x3D;utf8;</span><br><span class="line">(root@localhost) [ahui]&gt;desc student;</span><br><span class="line">+--------+---------------------+------+-----+---------+----------------+</span><br><span class="line">| Field  | Type                | Null | Key | Default | Extra          |</span><br><span class="line">+--------+---------------------+------+-----+---------+----------------+</span><br><span class="line">| id     | int(10) unsigned    | NO   | PRI | NULL    | auto_increment |</span><br><span class="line">| name   | varchar(20)         | NO   |     | NULL    |                |</span><br><span class="line">| age    | tinyint(3) unsigned | YES  |     | NULL    |                |</span><br><span class="line">| gender | enum(&#39;F&#39;,&#39;M&#39;)       | YES  |     | M       |                |</span><br><span class="line">+--------+---------------------+------+-----+---------+----------------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br><span class="line">(root@localhost) [ahui]&gt;insert student (name,age)values(&#39;xiaolv&#39;,20);</span><br><span class="line">(root@localhost) [ahui]&gt;insert student (name,age,gender)values(&#39;xiaohong&#39;,20,&#39;f&#39;);</span><br><span class="line">(root@localhost) [ahui]&gt;select * from student;</span><br><span class="line">+----+----------+------+--------+</span><br><span class="line">| id | name     | age  | gender |</span><br><span class="line">+----+----------+------+--------+</span><br><span class="line">| 10 | xiaolv   |   20 | M      |</span><br><span class="line">| 11 | xiaohong |   20 | F      |</span><br><span class="line">+----+----------+------+--------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>关于AUTO_INCREMENT，通过更改系统参数可以修改步进值和默认起始的值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">(root@localhost) [ahui]&gt;show variables like &#39;auto_increment%&#39;;</span><br><span class="line">+--------------------------+-------+</span><br><span class="line">| Variable_name            | Value |</span><br><span class="line">+--------------------------+-------+</span><br><span class="line">| auto_increment_increment | 10    |</span><br><span class="line">| auto_increment_offset    | 3     |</span><br><span class="line">+--------------------------+-------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line">#上面的参数是修改过的，默认都是1</span><br><span class="line">(root@localhost) [ahui]&gt;set @@auto_increment_increment&#x3D;10;</span><br><span class="line">(root@localhost) [ahui]&gt;set @@auto_increment_offset&#x3D;3;</span><br><span class="line">(root@localhost) [ahui]&gt;desc autoincre;</span><br><span class="line">(root@localhost) [ahui]&gt;desc autoincre;</span><br><span class="line">+-------+---------+------+-----+---------+----------------+</span><br><span class="line">| Field | Type    | Null | Key | Default | Extra          |</span><br><span class="line">+-------+---------+------+-----+---------+----------------+</span><br><span class="line">| col   | int(11) | NO   | PRI | NULL    | auto_increment |</span><br><span class="line">+-------+---------+------+-----+---------+----------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">(root@localhost) [ahui]&gt;select * from autoincre;</span><br><span class="line">+-----+</span><br><span class="line">| col |</span><br><span class="line">+-----+</span><br><span class="line">|   3 |</span><br><span class="line">|  13 |</span><br><span class="line">|  23 |</span><br><span class="line">|  33 |</span><br><span class="line">+-----+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>第二种创建表的方式：通过查询现存表创建：查询到的数据之间插入表中成为新表的数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">(root@localhost) [ahui]&gt;create table human select user,host from mysql.user;</span><br><span class="line">(root@localhost) [ahui]&gt;select * from human;</span><br><span class="line">+---------------+-----------+</span><br><span class="line">| user          | host      |</span><br><span class="line">+---------------+-----------+</span><br><span class="line">| root          | 10.0.0.%  |</span><br><span class="line">| mysql.session | localhost |</span><br><span class="line">| mysql.sys     | localhost |</span><br><span class="line">| root          | localhost |</span><br><span class="line">+---------------+-----------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>第三种方式：通过复制现存表的表结构创建，但是不复制数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">(root@localhost) [ahui]&gt;create table teacher like student;</span><br><span class="line">(root@localhost) [ahui]&gt;desc teacher;</span><br><span class="line">+--------+---------------------+------+-----+---------+----------------+</span><br><span class="line">| Field  | Type                | Null | Key | Default | Extra          |</span><br><span class="line">+--------+---------------------+------+-----+---------+----------------+</span><br><span class="line">| id     | int(10) unsigned    | NO   | PRI | NULL    | auto_increment |</span><br><span class="line">| name   | varchar(20)         | NO   |     | NULL    |                |</span><br><span class="line">| age    | tinyint(3) unsigned | YES  |     | NULL    |                |</span><br><span class="line">| gender | enum(&#39;F&#39;,&#39;M&#39;)       | YES  |     | M       |                |</span><br><span class="line">+--------+---------------------+------+-----+---------+----------------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br><span class="line">(root@localhost) [ahui]&gt;select * from teacher;</span><br><span class="line">Empty set (0.00 sec)</span><br><span class="line">#表中没有数据，是空的，只有数据表的结构</span><br></pre></td></tr></table></figure>

<p>查看engine</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(root@localhost) [ahui]&gt;show engines;</span><br></pre></td></tr></table></figure>

<p>查看表：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(root@localhost) [ahui]&gt;show tables;</span><br></pre></td></tr></table></figure>

<p>查看表结构：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(root@localhost) [ahui]&gt;desc student;</span><br></pre></td></tr></table></figure>

<p>查看创建表命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(root@localhost) [ahui]&gt;show create table student;</span><br></pre></td></tr></table></figure>

<p>查看表状态：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">(root@localhost) [ahui]&gt;show table  status like &#39;student&#39;\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">           Name: student</span><br><span class="line">         Engine: InnoDB</span><br><span class="line">        Version: 10</span><br><span class="line">     Row_format: Dynamic</span><br><span class="line">           Rows: 2</span><br><span class="line"> Avg_row_length: 8192</span><br><span class="line">    Data_length: 16384</span><br><span class="line">Max_data_length: 0</span><br><span class="line">   Index_length: 0</span><br><span class="line">      Data_free: 0</span><br><span class="line"> Auto_increment: 12</span><br><span class="line">    Create_time: 2020-09-22 20:33:27</span><br><span class="line">    Update_time: 2020-09-22 20:37:04</span><br><span class="line">     Check_time: NULL</span><br><span class="line">      Collation: utf8_general_ci</span><br><span class="line">       Checksum: NULL</span><br><span class="line"> Create_options: </span><br><span class="line">        Comment: </span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line">#\G是竖着显示内容</span><br></pre></td></tr></table></figure>

<p>查看数据库中全部表的状态：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(root@localhost) [ahui]&gt;show table status from ahui ;</span><br></pre></td></tr></table></figure>
</li>
<li><p>DROP</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(root@localhost) [(none)]&gt;drop database if exists ahui;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>ALTER</p>
<p>add,change,modify</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(root@localhost) [(none)]&gt;alter database ahui character set utf8;</span><br><span class="line">mysql&gt; alter table info change name1 name varchar(20);</span><br></pre></td></tr></table></figure>

<p>查看所有数据库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW DATABASES;</span><br></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li><p>DML：数据库操纵语言 Data Manipulation Language</p>
<ul>
<li><p>INSERT</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert table_name [(column1,...)] values (value1,...) (value2...)...</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;insert info (id,name,gender,age) values (4,&#39;ming&#39;,&#39;M&#39;,24);</span><br></pre></td></tr></table></figure>



</li>
</ul>
</li>
</ul>
<ul>
<li><p>DELETE</p>
<p>删除表中的数据，但不会自动缩减数据文件的大小</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">DELETE [] FROM TABLE_NAME</span><br><span class="line">	[WHERE CONDITIONS]</span><br><span class="line">	[ORDER BY]</span><br><span class="line">	[LIMIT ROW_COUNT]</span><br><span class="line">	可以先排序再指定删除的行数</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;delete from info where id &#x3D;4;</span><br></pre></td></tr></table></figure>

<p>注意一定要有限制条件，否则将清空表中的所有数据</p>
<p>如果想清空表，保留表结构，也可以使用下面语句，此语句会自动缩减数据文件的大小</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TRUNCATE TABLE TABLE_NAME</span><br></pre></td></tr></table></figure>

<p>缩减表大小</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">OPTIMIZE TABLE TABLE_NAME</span><br></pre></td></tr></table></figure>
</li>
<li><p>UPDATE</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">UPDATE [] TABLE_REFERENCE</span><br><span class="line">	SET COL_NAME&#x3D;&#123;exper1|default&#125;...</span><br><span class="line">	[WHERE CONDITIONS]</span><br><span class="line">	[ORDER BY]</span><br><span class="line">	[LIMIT ROW_COUNT]</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; update info set id&#x3D;6 where name &#x3D; &#39;hui&#39;;</span><br></pre></td></tr></table></figure>

<p>注意要有限制条件，否则将修改所有行的指定字段，可以用mysql选项避免此错误：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql -U | --safe-updates | --i-am-a-dummy </span><br><span class="line">可以把 mysql -U 做成别名，</span><br><span class="line">alias mysql&#x3D;&quot;mysql -U&quot;</span><br><span class="line">设置了 -U 选项后使用删除的时候必须跟上一个主键的条件！</span><br></pre></td></tr></table></figure>
</li>
<li><p>DQL：数据查询语言 Data Query Language</p>
<ul>
<li>SELECT</li>
</ul>
</li>
</ul>
<p>select语句处理的顺序</p>
<p>SQL解析–&gt;FROM–&gt;ON–&gt;JOIN和WHERE并列地位–&gt;GROUP BY–&gt;HAVING–&gt;SELECT–&gt;ORDER BY–&gt;LIMIT</p>
<p>执行查询路径中的组件：</p>
<p><img src="C:\Users\a\Desktop\dfff6efbab0d51a715a36f867daeacf8.png" alt="dfff6efbab0d51a715a36f867daeacf8"></p>
<pre><code>* 单表操作</code></pre>
<p>  between … and</p>
<p>  distinct </p>
<p>  模糊查询:like %,_ </p>
<p>  ​    数据库、数据表是区分大小写的，因为他们都是文件（目录）</p>
<p>  ​    字段名、数据是不区分大小写的</p>
<p>  GROUP分组，涉及到前后次序</p>
<p>  ​    groupby xxx having conditions=xxx</p>
<p>  ​    where conditions = xxx groupby xxx</p>
<p>  正则表达式查询：rlike,regexp</p>
<p>  order by asc desc</p>
<p>  字段的别名</p>
<p>  limit N 或者可以跳过前几条后开始显示</p>
<p>  对查询结果加锁</p>
<pre><code>* 多表查询

  子查询

  ​    普通子查询

  ​    IN 子查询

  ​    exists 和 not exists

  exists（包括 not exists）子句的返回值是一个BOOL值。exists内部有一个子查询语句，将其称为exists的内查询语句。其内查询语句返回一个结果集，exists子句根据其内查询的结果集空或非空，返回一个布尔值。将外查询的每一行带入内查询作为检验，如果内查询返回的结果为非空值，则exists子句返回true，外查询的这一行数据便可作为外查询的结果返回，否则不能作为结果。

  联合查询 union，union all

  交叉连接：笛卡尔乘积，两个表完全组合一遍 cross join

  内连接 inner join table_name on 涉及到别名

  外连接 涉及到别名

  ​    左外连接 left outer join table_name on 

  ​    有外连接 right outer join table_name on

  ​    只取非交集 左连接或右连接再加一个key的where条件

  ​    全外连接 full outer join table_name on 

  ​    mysql不支持 full outer写法，但是可以通过组合左右连接来union实现

  自连接</code></pre>
<ul>
<li>DCL：数据控制语言 Data Control Language<ul>
<li>GRANT</li>
<li>REVOKE</li>
<li>COMMIT</li>
<li>ROLLBACK</li>
</ul>
</li>
</ul>
<p>软件开发：CRUD 增删改查</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM table1</span><br><span class="line">WHERE price&gt;666;</span><br></pre></td></tr></table></figure>

<p>字符集：UTF8MB4 4个字节，生产环境记得修改字符集</p>
<ul>
<li>SHOW COLLATION  字符集的排序规则</li>
<li>SHOW VARIABLES LIKE ‘collation%’</li>
<li>SHOW CHARACTER SET</li>
<li>SHOW variables like ‘character%’ 查看当前数据库中使用的字符集</li>
</ul>
<p>数据类型：</p>
<p>数据长什么样</p>
<p>数据需要多少空间来存放</p>
<p>系统内置数据类型</p>
<p>用户定义数据类型</p>
<p>选择正确的数据类型对于获得高性能至关重要，三大原则：</p>
<p>1.更小的通常更好，尽量使用可正确存储数据的最小数据类型</p>
<p>2.简单就好，简单数据类型的操作通常需要更少的CPU周期</p>
<p>3.尽量避免NULL，包含为NULL的列，对MySQL更难优化</p>
<ul>
<li><p>整数型</p>
<ul>
<li>tinyint 1个字节</li>
<li>int 4个字节</li>
</ul>
</li>
<li><p>浮点型</p>
</li>
<li><p>定数型</p>
</li>
<li><p>字符串</p>
<ul>
<li>char(n) 固定长度，最多255个字符，注意不是字节</li>
<li>varchar(n) 可变长度，最多65535个字符</li>
</ul>
</li>
<li><p>修饰符</p>
<ul>
<li>NULL    数据列可包含NULL值，默认值</li>
<li>NOT NULL 数据列不允许包含NULL值，*为必填选项</li>
<li>DEFAULT 默认值</li>
<li>ENUM（’’,’’）限制值只能是设定的</li>
<li>PRIMARY KEY 主键，所有记录中此字段的值不能重复，且不能为NULL</li>
<li>UNIQUE KEY  唯一键，所有记录中此字段的值不能重复，但可以为NULL</li>
<li>CHARACTER SET name 指定一个字符集</li>
<li>适合数值型的修饰符<ul>
<li>AUTO_INCREMENT 自动递增，适用于整数类型 最大是2^32次方-1 4294967295</li>
<li>UNSIGNED 无符号</li>
</ul>
</li>
<li>日期时间类型<ul>
<li>data 日期 ‘2020-09-22’</li>
<li>time 时间 ‘20:20:20’</li>
<li>datatime 日期时间 ‘2020-09-22 20:20:30’</li>
<li>timestamp 自动存储记录修改时间</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>视图 VIEW</p>
<p>视图是虚拟的表，类似表的别名，视图存在于数据库目录下，是以文件形式存放的</p>
<p>视图可以隐藏数据表的结构</p>
<p>视图可以修改原始表的数据，视图中的数据实际存储在基表中，因此对视图数据的修改也会对基表修改，视图的修改操作受基表限制</p>
<p>创建视图</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CREATE VIEW view_name [(column_list)]</span><br><span class="line">	as select_statement</span><br><span class="line">	[with[cascaded|local] check option]</span><br></pre></td></tr></table></figure>

<p>查看视图定义：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#显示创建视图和表的过程</span><br><span class="line">show create table v_name;</span><br><span class="line">或</span><br><span class="line">show create view v_name;</span><br></pre></td></tr></table></figure>

<p>删除视图</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DROP VIEW [if exists]</span><br><span class="line">	view_name[,view_name] ...</span><br><span class="line">	[restrict|cascade]</span><br></pre></td></tr></table></figure>

<p>函数 FUNCTION</p>
<p>​    函数必须有()</p>
<p>​    内置函数和自定义函数</p>
<p>​    mysql数据库的proc表中</p>
<p>​    函数只能被调用select function_name()，不能独立使用;</p>
<p>创建函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CREATE [AGGREAGTE] FUNCTION function_name(parameter_name type,....)</span><br><span class="line">	RETURN &#123;STRING|INTEGER|REAL&#125;</span><br><span class="line">	runtime_body</span><br></pre></td></tr></table></figure>

<p>说明：</p>
<ul>
<li>参数可以有多个，也可以没有</li>
<li>无论有没有参数，必须有()</li>
<li>必须有且只有一个返回值</li>
</ul>
<p>查看函数列表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW FUNCTION STATUS;</span><br></pre></td></tr></table></figure>

<p>查看函数定义</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW CREATE FUNCTION function_name</span><br></pre></td></tr></table></figure>

<p>删除自定义函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP FUNCTION function_name</span><br></pre></td></tr></table></figure>

<p>调用函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select function_name();</span><br></pre></td></tr></table></figure>

<p>Mysql中的变量</p>
<p>​    系统变量 @@var_name 引用</p>
<p>​    普通变量 @var_name 适用于当前会话</p>
<p>​    局部变量 var_name 函数体内部有效，其他地方无效</p>
<p>存储过程 PROCEDURE</p>
<p>​    存储过程：多表SQL的语句的集合，可以独立执行，存储过程保存在mysql.proc表中</p>
<p>​    call procdure_name;</p>
<p>创建存储过程</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CREATE PROCEDURE procedure_name ([parameter]...)</span><br><span class="line">routime_body</span><br><span class="line">proc_parameter :[IN|OUT|INOUT] parameter_name type</span><br></pre></td></tr></table></figure>

<p>查看存储过程列表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW PROCEDURE STATUS</span><br></pre></td></tr></table></figure>

<p>查看存储过程定义</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW CREATE PROCEDURE procedure_name</span><br></pre></td></tr></table></figure>

<p>调用存储过程</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">call procedure_name [(parameter)]</span><br><span class="line">#说明：当没有参数时可以不写 ()</span><br></pre></td></tr></table></figure>

<p>存储过程通过ALTER只能修改注释等无关紧要的东西，不能修改存储过程体，所以要修改存储过程，方法就是删除重建</p>
<p>删除存储过程</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP PROCEDURE [if exists] procedure_name</span><br></pre></td></tr></table></figure>

<p>触发器 TRIGGER</p>
<p>​    触发器的执行不是由程序调用，也不是由手动启动，而是由时间来触发、激活从而实现执行</p>
<p>​    触发器只对insert,delete,update这三个动作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE [ DEFINER &#x3D; &#123;USER|CURRENT_USER&#125; ]</span><br><span class="line">	TRIGGER trigger_name</span><br><span class="line">	trigger_time &#123;before|after&#125; trigger_event</span><br><span class="line">	on table_name for each row</span><br><span class="line">	trigger_body</span><br></pre></td></tr></table></figure>

<p>触发器文件在/var/lib/mysql/dbname/trigger_name.TRN</p>
<p>查看触发器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#通过show命令查看</span><br><span class="line">SHOW TRIGGERs ;</span><br><span class="line">#通过查看information_schema.triggers表</span><br><span class="line">mysql&gt; select * from information_schema.triggers where trigger_name &#x3D; &#39;student_count_delete&#39;;</span><br></pre></td></tr></table></figure>

<p>删除触发器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP TRIGGER trigger_name</span><br></pre></td></tr></table></figure>

<p>事件 EVENT</p>
<p>​    存放在mysql.event表中</p>
<p>​    秒钟级别</p>
<p>​    环境变量：@@event_scheduler</p>
<p>查看事件管理器是否开启，默认是关闭0,1是开启</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select @@event_scheduler;</span><br></pre></td></tr></table></figure>

<p>事件管理器开启后会开启一个线程</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHWO PROCESSLIST</span><br></pre></td></tr></table></figure>

<p>可以通过在配置文件中添加 event_scheduler = on  来永久开启</p>
<h3 id="用户账户管理"><a href="#用户账户管理" class="headerlink" title="用户账户管理"></a>用户账户管理</h3><p>mysql.user表中存放用户信息</p>
<p>用户账户：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#39;USERNAME&#39;@&#39;HOST&#39;</span><br><span class="line">USERNAME :操作系统的用户名</span><br><span class="line">@HOST：主机名，IP地址或者Network</span><br><span class="line">	通配符：% 表示所有  _ 表示任意一个字符</span><br><span class="line">	示例：172.16.%.% user@192.168.1.%</span><br></pre></td></tr></table></figure>



<h4 id="账号创建-CREATE-USER"><a href="#账号创建-CREATE-USER" class="headerlink" title="账号创建 CREATE USER"></a>账号创建 CREATE USER</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CREATE USER &#39;USERNAME&#39;@&#39;HOSTNAME&#39; [IDENTIFIED BY &#39;密码&#39;]</span><br><span class="line">新建用户默认权限：USEAGE</span><br><span class="line">mysql&gt; create user &#39;lv&#39;@&#39;10.0.0.%&#39; identified by &#39;centos&#39;;</span><br></pre></td></tr></table></figure>

<p>用户重命名：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RENAME USER old_user_name TO new_user_name;</span><br></pre></td></tr></table></figure>



<h4 id="账号删除"><a href="#账号删除" class="headerlink" title="账号删除"></a>账号删除</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP USER &#39;user_name&#39;@&#39;hostname&#39;</span><br></pre></td></tr></table></figure>

<h4 id="账号密码修改"><a href="#账号密码修改" class="headerlink" title="账号密码修改"></a>账号密码修改</h4><p>注意：</p>
<ul>
<li>新版MYSQL中用户密码可以保存在mysql.user表的authentication_string字段</li>
<li>旧版的密码在mysql.password字段，如果两个字段都存在数据，那么authentication_string优先级更高</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set password for root@&#39;localhost&#39;  password(&#39;centos&#39;) </span><br></pre></td></tr></table></figure>

<p>官方推荐这样操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter user user_name&#39;@&#39;hostname identified by &#39;password&#39; ;</span><br></pre></td></tr></table></figure>

<p>忘记密码的操作</p>
<p>1.关闭验证环节</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">--skip-grant-tables</span><br><span class="line">--skip-networking</span><br></pre></td></tr></table></figure>

<p>2.登录mysql数据库，修改密码</p>
<h4 id="账号授权"><a href="#账号授权" class="headerlink" title="账号授权"></a>账号授权</h4><p>权限的类型</p>
<ul>
<li>管理类<ul>
<li>用户管理等</li>
</ul>
</li>
<li>程序类<ul>
<li>函数、存储过程等的控制</li>
</ul>
</li>
<li>数据库级别<ul>
<li>数据库的增改删</li>
</ul>
</li>
<li>表级别<ul>
<li>数据表的增改删</li>
</ul>
</li>
<li>字段级别<ul>
<li>规定哪些字段可以操作，比如select ((col1),(col2)…)</li>
</ul>
</li>
</ul>
<p>操作符：GRANT,REVOKE</p>
<p>所有权限：ALL PRIVILEGES 或 ALL</p>
<p>授权：GRANT</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GRANT priv_type [(column_list)]，...ON [object_type] priv_level TO &#39;user&#39;@&#39;host&#39;</span><br><span class="line">[IDENTIFIED BY &#39;PASSWORD&#39;] [WITH GRANT OPTION];</span><br><span class="line"></span><br><span class="line">priv_type：all [privileges]</span><br><span class="line">object_type：table | function | procedure</span><br><span class="line">priv_level：*(所有库) | *.* | db_name.* | db_name.table_name | table_name(当前库的表) | db_name.routine_name(指定库的函数，存储过程，触发器)</span><br><span class="line">with_option：grant option</span><br><span class="line">	| max_queries_per_hour count</span><br><span class="line">	| max_updates_per_hour count</span><br><span class="line">	| max_connections_per_hour count</span><br><span class="line">	| max_user_connections count</span><br></pre></td></tr></table></figure>

<p>例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GRANT  ALL PRIVILEGES ON *.* TO &#39;USER_NAME&#39;@&#39;HOSTNAME&#39; IDENTIFIED BY &#39;PASSWORD&#39;;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; grant all on hellodb.* to &#39;lv&#39;@&#39;10.0.0.%&#39; ;</span><br><span class="line">#把hellodb下的所有权限发给lv@10.0.0.%用户</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; grant select on mysql.* to &#39;lv&#39;@&#39;10.0.0.%&#39;;</span><br></pre></td></tr></table></figure>

<p>取消授权：REVOKE</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">REVOKE priv_type [(column_list)]... on [object_type] priv_level from user..</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; revoke select on mysql.* from &#39;lv&#39;@&#39;10.0.0.%&#39; ;</span><br></pre></td></tr></table></figure>

<p>查看用户权限：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW GRANTS FOR XXX@XXX;</span><br></pre></td></tr></table></figure>

<p>例如</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show grants for &#39;lv&#39;@&#39;10.0.0.%&#39;;</span><br><span class="line">+--------------------------------------------------------+</span><br><span class="line">| Grants for lv@10.0.0.%                                 |</span><br><span class="line">+--------------------------------------------------------+</span><br><span class="line">| GRANT USAGE ON *.* TO &#39;lv&#39;@&#39;10.0.0.%&#39;                  |</span><br><span class="line">| GRANT ALL PRIVILEGES ON &#96;hellodb&#96;.* TO &#39;lv&#39;@&#39;10.0.0.%&#39; |</span><br><span class="line">| GRANT SELECT ON &#96;mysql&#96;.* TO &#39;lv&#39;@&#39;10.0.0.%&#39;           |</span><br><span class="line">+--------------------------------------------------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>注意：数据库启动的时候会自动读取mysql库中的全部权限表到内存，对于不能及时重读授权表的命令，可以手动执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; flush privileges;</span><br></pre></td></tr></table></figure>




<h2 id="MySQL架构和性能优化"><a href="#MySQL架构和性能优化" class="headerlink" title="MySQL架构和性能优化"></a>MySQL架构和性能优化</h2><p><img src="C:\Users\a\AppData\Roaming\Typora\typora-user-images\image-20200925200135006.png" alt="image-20200925200135006"></p>
<p>Mysql是单进程多线程的</p>
<p>连接器：一个API，支持各种语言开发的连接工具</p>
<p>连接池：认证，线程控制，内存检查</p>
<p>SQL接口：解释器，进行语法检查</p>
<p>解析器：查询翻译、权限检查</p>
<p>寻路优化：访问路径统计</p>
<p>缓存和缓冲区：这个不是上面的缓存访问，而是跟内存和磁盘打交道的缓存</p>
<p>插件存储引擎：面试常问，工作中对于引擎的选择是比较固定的</p>
<p>文件系统：</p>
<p>文件和日志：</p>
<h3 id="存储引擎"><a href="#存储引擎" class="headerlink" title="存储引擎"></a>存储引擎</h3><p>mysql是插件式存储引擎，它能够替换使用选择多种不同的引擎</p>
<p>存储引擎负责把具体分析结果完成对磁盘上文件路径访问的转换，数据库中的行数据是存储在磁盘块上的，因此存储引擎要把数据库数据映射为磁盘块，并把磁盘块加载至内存中；（逻辑关系转化成物理数据文件）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">show engines</span><br><span class="line">show variables like &#39;%engine%&#39;</span><br><span class="line">--default_storage_engines,default_storage_engines</span><br><span class="line">storage_engine</span><br><span class="line">show table status from table_name</span><br><span class="line">show create table table_name</span><br><span class="line">create TABLE table_name () ENGINE&#x3D;INNODB</span><br><span class="line">ALTER TABLE table_name ENGINE&#x3D;INNODB</span><br></pre></td></tr></table></figure>

<p><strong>MyISAM和InnoDB的区别</strong></p>
<table>
<thead>
<tr>
<th>属性</th>
<th>MyISAM</th>
<th>InnoDB</th>
</tr>
</thead>
<tbody><tr>
<td>锁的颗粒度</td>
<td>表级锁</td>
<td>行级锁</td>
</tr>
<tr>
<td>集群索引</td>
<td>不支持</td>
<td>支持</td>
</tr>
<tr>
<td>MVCC</td>
<td>不支持</td>
<td>支持</td>
</tr>
<tr>
<td>外键</td>
<td>不支持</td>
<td>支持</td>
</tr>
<tr>
<td>存储空间</td>
<td>256TB</td>
<td>64TB</td>
</tr>
<tr>
<td>事务</td>
<td>不支持</td>
<td>支持</td>
</tr>
<tr>
<td>速度</td>
<td>相对快</td>
<td>相对慢</td>
</tr>
</tbody></table>
<blockquote>
<p>InnoDB：Supports transactions, row-level locking, foreign keys and encryption for tables</p>
<p>MyISAM：Non-transactional engine with good performance and small data footprint</p>
</blockquote>
<p>MVCC：多版本并发控制机制 </p>
<p>​    数据的时间戳，INSERT和DELETE</p>
<p>InnoDB的数据文件是两个，一个数据定义，一个存放数据  </p>
<blockquote>
<p>name.frm  数据定义</p>
<p>name.ibd   真实数据以及索引</p>
</blockquote>
<p>MyISAM数据文件三个，一个索引，一个数据，一个定义</p>
<p>行–&gt;页–&gt;extent–&gt;segment</p>
<p>数据库的读取是以一页作为基本单位，一个页16KB，对比文件系统的块，文件系统的块Block是4KB</p>
<p>存储引擎是对表来说的，是对表的管理，同一个数据库中的表可以用不同的存储引擎</p>
<h3 id="MySQL中的系统数据库"><a href="#MySQL中的系统数据库" class="headerlink" title="MySQL中的系统数据库"></a>MySQL中的系统数据库</h3><ul>
<li><p>MySQL数据库</p>
<p>是MYsql的核心数据库，主要负责存储数据库的用户、权限设置、关键字等Mysql自己需要使用的控制和管理信息</p>
</li>
<li><p>performance_schema</p>
<p>MYsql 5.5 新增的数据库，主要用户手机数据库服务器性能参数，库里表的存储引擎均为PERFORMANCE_SCHEMA，用户不能创建存储引擎为PREFORMANCE_SHCEMA的表</p>
</li>
<li><p>information_schema</p>
<p>一个虚拟数据库，物理上并不存在information_schema数据库类似于”数据字典”，提供了访问数据库元数据的方式，即数据的数据。比如数据库名或表明，列类型，访问权限等</p>
</li>
<li><p>sys</p>
<p>MYSQL5.7之后新增加的数据库，库中的所有数据来源于performance_schma，目标是把performance_schema的复杂程度降低，让DBA能更好的阅读这个库里的内容。</p>
</li>
</ul>
<h3 id="服务器配置和状态"><a href="#服务器配置和状态" class="headerlink" title="服务器配置和状态"></a>服务器配置和状态</h3><p>通过mysqld的选项、服务器系统变量和服务器状态变量进行MySQL的配置和查看状态</p>
<p>官方文档：<a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/server-option-variable-reference.html">https://dev.mysql.com/doc/refman/5.7/en/server-option-variable-reference.html</a></p>
<p><a target="_blank" rel="noopener" href="https://mariadb.com/kb/en/library/full-list-of-mariadb-options-system-and-status-variables/">https://mariadb.com/kb/en/library/full-list-of-mariadb-options-system-and-status-variables/</a></p>
<h4 id="服务器选项"><a href="#服务器选项" class="headerlink" title="服务器选项"></a>服务器选项</h4><p>写入配置文件，持久保存</p>
<p>Default options are read from the following files in the given order:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;etc&#x2F;my.cnf &#x2F;etc&#x2F;mysql&#x2F;my.cnf ~&#x2F;.my.cnf</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#打印出当前服务启动时的默认选项</span><br><span class="line">[root@localhost local]#mysqld --print-defaults</span><br><span class="line">mysqld would have been started with the following arguments:</span><br><span class="line">--datadir&#x3D;&#x2F;data&#x2F;mysql --socket&#x3D;&#x2F;data&#x2F;mysql&#x2F;mysql.sock --skip_name_resolve&#x3D;on --port&#x3D;3306</span><br><span class="line">#打印出可用选项</span><br><span class="line">[root@localhost local]#mysql --verbose --help</span><br></pre></td></tr></table></figure>



<h4 id="服务器系统变量"><a href="#服务器系统变量" class="headerlink" title="服务器系统变量"></a>服务器系统变量</h4><p>变量临时修改，无法持久保存</p>
<p>系统变量分为全局（GLOBAL）和会话（session）两种</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">show global variables;#查看全局变量</span><br><span class="line">show [session] variables;#查看所有变量</span><br><span class="line">select @@variable;#查看某个变量的值</span><br><span class="line">SET GLOBAL system_var_name&#x3D;value;</span><br><span class="line">SET @@GLOBAL.SYSTEM_VAR_NAME&#x3D;value;</span><br><span class="line">SET system_var_name&#x3D;value;</span><br><span class="line">SET @@system_var_name&#x3D;value;</span><br></pre></td></tr></table></figure>

<p>max_connection 最大连接数，一个数据库1000左右的连接数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">--character_set_server,character_set_server</span><br><span class="line">--max_connections,max_connections</span><br><span class="line">#如果该最大连接数不成功，应该是ulimits限制的，可以在&#x2F;etc&#x2F;my.cnf中加一句</span><br><span class="line">LimitNOFILE&#x3D;65535</span><br></pre></td></tr></table></figure>





<h4 id="服务器状态变量"><a href="#服务器状态变量" class="headerlink" title="服务器状态变量"></a>服务器状态变量</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">show status like &#39;variables&#39;;</span><br><span class="line">show global status;</span><br><span class="line">show status;</span><br></pre></td></tr></table></figure>



<h4 id="服务器变量SQL-MODE"><a href="#服务器变量SQL-MODE" class="headerlink" title="服务器变量SQL_MODE"></a>服务器变量SQL_MODE</h4><p>SQL_MODE：对其设置可以完成一些约束检查的工作，可分别进行全局的设置或当前会话的设置</p>
<p>文档：<a target="_blank" rel="noopener" href="https://mariadb.com/kb/en/library/sql-mode/">https://mariadb.com/kb/en/library/sql-mode/</a></p>
<p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/server-options.html#option_mysqld_sql-mode">https://dev.mysql.com/doc/refman/5.7/en/server-options.html#option_mysqld_sql-mode</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">--sql_mode,sql_mode</span><br><span class="line">select @@sql_mode;</span><br></pre></td></tr></table></figure>

<p>常见MODE：</p>
<ul>
<li>NO_AUTO_CREATE_USER：禁止GRANT创建密码为空的用户</li>
<li>NO_ZERO_DATE：在严格模式，不允许使用”0000000”的时间</li>
<li>ONLY_FULL_GROUP_BY：对于GROUP BY聚合操作，如果在SELECT中的列，没有在GROUP BY中出现，那么将认为这个SQL是不合法的</li>
<li>NO_BACKSLASH_ESCAPES：反斜杠“\”被视为普通字符而不是逃逸符</li>
<li>PIPES_AS_CONCAT：将“||”视为连接操作符而非“或”运算符</li>
</ul>
<h3 id="Query-Cache-查询缓存"><a href="#Query-Cache-查询缓存" class="headerlink" title="Query Cache 查询缓存"></a>Query Cache 查询缓存</h3><p>Redis代替</p>
<p>能用别的应用解决，就不要用数据库实现</p>
<p>查询缓存的启用和使用，hash算法，因此对语句的要求很高，必须一模一样，连空格什么的都得一样才能从缓存中读取</p>
<p>查询缓存优化</p>
<h3 id="索引-INDEX"><a href="#索引-INDEX" class="headerlink" title="索引 INDEX"></a>索引 INDEX</h3><h4 id="索引介绍"><a href="#索引介绍" class="headerlink" title="索引介绍"></a>索引介绍</h4><p>索引是排序的快速查找的特殊数据结构，定义作为查找条件的字段上，又称为键key，索引通过存储引擎实现</p>
<p>适合读操作；不适合频繁更改的数据表</p>
<p>优点</p>
<ul>
<li>索引可以降低服务器需要扫描的数据量，减少了IO次数</li>
<li>索引可以帮助服务器避免排序和使用临时表</li>
<li>索引可以帮助将随机I/O转为顺序I/O</li>
</ul>
<p>缺点</p>
<ul>
<li>占用额外空间，影响插入速度</li>
</ul>
<p>索引类型：</p>
<ul>
<li>B+ TREE,HASH,R TREE,FULL TEXT</li>
<li>聚簇索引，非聚簇索引：数据和索引是否存储在一起</li>
<li>主键索引、二级索引</li>
<li>稠密索引、稀疏索引：是否引用了每一个数据项</li>
<li>简单索引、组合索引</li>
<li>左前缀索引：取前面的字符做索引</li>
<li>覆盖索引：从索引中即可取出要查询的数据，性能高</li>
</ul>
<h5 id="索引结构"><a href="#索引结构" class="headerlink" title="索引结构"></a>索引结构</h5><p>参考链接 : <a target="_blank" rel="noopener" href="https://www.cs.usfca.edu/~galles/visualization/Algorithms.html">https://www.cs.usfca.edu/~galles/visualization/Algorithms.html</a></p>
<ul>
<li><p>二叉树</p>
</li>
<li><p>红黑树</p>
</li>
<li><p>B树</p>
</li>
<li><p>Hash索引</p>
<p>基于哈希表实现，只有精确匹配索引中的所有列的查询才有效，索引自身只存储索引列对应哈希值和数据指针，索引结构紧凑，查询性能好；Memory存储引擎支持显式HASH索引，适用于：= &lt;=&gt;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;&#x3D;&gt; 符号是专门比较NULL值的，表示等于NULL，也就是 IS NULL</span><br></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li>B+树，INNODB就是用B+树作为索引</li>
</ul>
<p>B+树索引的特点：</p>
<p>1.查询类型</p>
<ul>
<li>全值匹配：精确所有索引列，如：姓lv,名zhehui,年龄25</li>
<li>匹配最左侧前缀：即只使用索引的第一列，如：姓lv</li>
<li>匹配列前缀：只匹配一列值的开头部分，如：姓以l开头的记录</li>
<li>匹配范围值：如：姓lv和wang之间</li>
<li>精确匹配某一列范围并范围匹配另一列：如：姓lv，名以z开头的记录</li>
<li>只访问索引的查询</li>
<li>如果不从最左列开始，则无法使用索引，如：查询名为zhehui,或姓的结尾是g</li>
<li>不能跳过索引中的列：？如：查找姓wang，年龄30，只能使用索引第一列</li>
</ul>
<p>mysql中 a% 可以利用索引模糊查询 %a就不可以利用索引了</p>
<p>B+树具有查询次数少，可查询数据数量大的特点</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">B+树的数据存放量计算：</span><br><span class="line">1.B+树的高度</span><br><span class="line">2.根节点的指针数</span><br><span class="line">3.单个叶子记录的行数</span><br><span class="line">1*2*3 得到的就是总的行数据</span><br><span class="line">例子：</span><br><span class="line">1.B+树高2层</span><br><span class="line">2.根节点的指针数：大小16KB，一个指针6B，主键ID的数据类型是bigint，占8B，那么指针数就是：16KB&#x2F;14B&#x3D;1170个指针</span><br><span class="line">3.单个叶子记录的行数:大小16KB，一个记录1KB，那么就是16条记录</span><br><span class="line">所以总的记录数是：16*1170&#x3D;18720</span><br><span class="line">当B+树是3层的时候就是 16*1170*1170&#x3D;21902400，两千万级别的数据量</span><br></pre></td></tr></table></figure>



<h4 id="索引优化"><a href="#索引优化" class="headerlink" title="索引优化"></a>索引优化</h4><ul>
<li>独立地使用列：尽量避免其参与运算，独立的列指索引列不能是表达式的一部分，也不能是函数的参数，在where条件中，始终将索引列单独放在比较符号的一侧，尽量不要在列上进行运算</li>
<li>左前缀索引：构建指定索引字段的左侧的字符数，要通过索引选择性（不重复的索引值和数据表的记录总数的比值）来评估，尽量使用短索引，如果可以，应该制定一个前缀长度</li>
<li>多列索引：AND操作时适合使用多列索引，而非为每个列创建单独的索引</li>
<li>选择合适的索引列顺序：无排序和分组时，将选择性最高的列放左侧</li>
<li>只要列中含有NULL值，就最好不要在此列设置索引，复合索引如果有NULL值，此列在使用时也不会使用索引</li>
<li>对于经常在where子句使用的列，最好设置索引</li>
<li>对于有多个列where或者order by子句，应该建立复合索引</li>
<li>对于like子句，以%或_开头的列不会使用索引，以%结尾会使用索引</li>
<li>尽量不要使用not in 和 &lt;&gt; 操作，虽然可以使用索引，但是性能不高</li>
<li>不要使用RLIKE正则表达式，这会导致索引失效</li>
<li>查询时，能不要使用“*”就不要使用，尽量写字段名，比如：select id,name,age from students;</li>
<li>大部分情况连接效率远大于子查询</li>
<li>在有大量记录的表分页时使用limit</li>
<li>对于经常使用的查询，可以开启查询缓存</li>
<li>多使用explain和profile分析查询语句</li>
<li>查看慢查询日志，找出执行时间长的SQL语句优化</li>
</ul>
<h4 id="管理索引"><a href="#管理索引" class="headerlink" title="管理索引"></a>管理索引</h4><ul>
<li>创建索引</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CREATE INDEX INDEX_NAME ON table_name(col(length));</span><br><span class="line"></span><br><span class="line">ALTER TABLE table_name ADD  INDEX index_name(index_col_name[length]);</span><br></pre></td></tr></table></figure>

<ul>
<li>查看索引</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SHOW INDEXES FROM table_name;</span><br><span class="line"></span><br><span class="line">set global userstat&#x3D;1;#开启统计</span><br><span class="line">show index_statistics;#统计有多少查询利用了索引</span><br></pre></td></tr></table></figure>

<ul>
<li>优化表空间</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">OPTIMIZE TABLE table_name;</span><br></pre></td></tr></table></figure>



<ul>
<li>删除索引</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP INDEXES INDEX_NAME ON table_name;</span><br></pre></td></tr></table></figure>

<p>ExPLAIN工具</p>
<p>参考资料：<a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/explain-output.html">https://dev.mysql.com/doc/refman/5.7/en/explain-output.html</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">explain select_statment</span><br><span class="line">例子：</span><br><span class="line">MariaDB [hellodb]&gt; explain select stuid,name,age,classid from students where stuid&#x3D;10;</span><br><span class="line">+------+-------------+----------+-------+---------------+---------+---------+-------+------+-------+</span><br><span class="line">| id   | select_type | table    | type  | possible_keys | key     | key_len | ref   | rows | Extra |</span><br><span class="line">+------+-------------+----------+-------+---------------+---------+---------+-------+------+-------+</span><br><span class="line">|    1 | SIMPLE      | students | const | PRIMARY       | PRIMARY | 4       | const | 1    |       |</span><br><span class="line">+------+-------------+----------+-------+---------------+---------+---------+-------+------+-------+</span><br><span class="line">1 row in set (0.000 sec)</span><br></pre></td></tr></table></figure>

<p>explain输出信息说明：</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>执行编号，标识select所属的行</td>
</tr>
<tr>
<td>select_type</td>
<td>SIMPLE|PRIMARY</td>
</tr>
<tr>
<td>table</td>
<td>访问引用哪个表</td>
</tr>
<tr>
<td>type</td>
<td>关联类型或访问类型，即MYSQL决定的如何去查询表中的行的方式</td>
</tr>
<tr>
<td>possible_keys</td>
<td>查询可能会用到的索引</td>
</tr>
<tr>
<td>key</td>
<td>显示mysql决定采用哪个索引来优化查询</td>
</tr>
<tr>
<td>key_len</td>
<td>显示mysql在索引里使用的字节数</td>
</tr>
<tr>
<td>ref</td>
<td>根据索引返回表中匹配某单个值的所有行</td>
</tr>
<tr>
<td>rows</td>
<td>为了找到所需的行而需要读取的行数，估算值，不精确</td>
</tr>
<tr>
<td>extra</td>
<td>额外信息</td>
</tr>
</tbody></table>
<p>type类型：type类型是访问类型，结果值从好到坏依次是：</p>
<p>system &gt; const &gt; eq_ref &gt; ref &gt; fulltext &gt; ref_or_null &gt; index_merge &gt; unique_subquery &gt; index_subquery &gt; range &gt; index &gt; all，一般来说，得保证查询至少到达range级别，最好到ref</p>
<table>
<thead>
<tr>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>ALL</td>
<td>最坏的情况，全表扫描</td>
</tr>
<tr>
<td>index</td>
<td>和全表一样。</td>
</tr>
<tr>
<td>range</td>
<td>范围扫描，一个有限制的索引扫描</td>
</tr>
<tr>
<td>ref</td>
<td>一种索引访问，它返回所有匹配某单个值的行</td>
</tr>
<tr>
<td>eq_ref</td>
<td>最多只返回一条符合条件的记录</td>
</tr>
<tr>
<td>const</td>
<td>当确定最多只会有一行匹配的时候，mysql优化器会在查询前读取它而且只读取一次，因此非常快</td>
</tr>
<tr>
<td>system</td>
<td>这个const连接类型的一种特例，表仅有一行满足条件</td>
</tr>
<tr>
<td>null</td>
<td>意味着mysql能在优化阶段分解查询语句，在执行阶段甚至用不到访问表或索引</td>
</tr>
</tbody></table>
<h3 id="并发控制"><a href="#并发控制" class="headerlink" title="并发控制"></a>并发控制</h3><h4 id="锁机制"><a href="#锁机制" class="headerlink" title="锁机制"></a>锁机制</h4><p>锁：</p>
<ul>
<li>读锁，共享锁，也称S锁，只读不可写（包括当前事务），多个读互不阻塞</li>
<li>写锁：独占锁，排他锁，也称为X锁，写锁会阻塞其他事务的读和写</li>
</ul>
<p>读锁和读锁是兼容的，写锁和其他锁都不兼容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">例如：</span><br><span class="line">  S锁和S锁是兼容的，X锁和其他锁都不兼容，举个例子，事务T1获取了一个行r1的S锁，另一个事务T2还可以获得行r1的S锁，此时T1和T2共同获得r1的S锁，此种情况称为锁兼容；但是当另外一个事务T3此时如果想获得行r1的X锁，则必须等到r1的全部锁释放之后才可以，此种情况称为锁冲突</span><br></pre></td></tr></table></figure>

<p>锁的颗粒度</p>
<ul>
<li>表级锁：MyISAM</li>
<li>行级锁：InnoDB</li>
</ul>
<p>实现：</p>
<ul>
<li>存储引擎</li>
<li>服务器级</li>
</ul>
<p>分类：</p>
<ul>
<li>隐式锁：由搜索引擎自动加锁</li>
<li>显式锁：用户手动请求</li>
</ul>
<p>锁策略：在锁颗粒度及数据安全性寻求的平衡机制</p>
<h4 id="显式使用锁"><a href="#显式使用锁" class="headerlink" title="显式使用锁"></a>显式使用锁</h4><p>帮助:<a target="_blank" rel="noopener" href="https://mariadb.com/kb/en/lock-tables/">https://mariadb.com/kb/en/lock-tables/</a></p>
<p>加锁：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lock tables table_name lock_type;</span><br><span class="line">lock_type:READ和WRITE</span><br></pre></td></tr></table></figure>

<p>解锁：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unlock  tables;</span><br></pre></td></tr></table></figure>

<p>关闭正在打开的表（清除查询缓存），通常在备份前加全局读锁</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FLUSH TABLES [table_name] [with read lock]</span><br></pre></td></tr></table></figure>



<h4 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h4><p>事务：Transactions 一组原子性的SQL语句，或一个独立的工作单元</p>
<p>事务日志：记录事务信息，实现undo,redo等故障恢复功能</p>
<h5 id="事务特性"><a href="#事务特性" class="headerlink" title="事务特性"></a>事务特性</h5><p><strong>ACID特性：</strong></p>
<p>A：automicity 原子性；整个事务中的所有操作要么全部成功执行，要么全部失败后回滚</p>
<p>C：consistency 一致性；数据库总是从一个一致性状态转换成另一个一致性状态</p>
<p>I：isolation 隔离性；一个事务所做出的的操作在提交之前，是不能为其他事务所见；隔离有多种隔离级别，实现并发</p>
<p>D：durability 持久性；一旦事务提交，其所做的修改会永久保存于数据库中</p>
<p>Transcation 生命周期</p>
<p><img src="C:\Users\a\AppData\Roaming\Typora\typora-user-images\image-20200926192208219.png" alt="image-20200926192208219"></p>
<h5 id="管理事务"><a href="#管理事务" class="headerlink" title="管理事务"></a>管理事务</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--autocommit,autocommit</span><br></pre></td></tr></table></figure>

<p>显示启动事务：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">BEGIN</span><br><span class="line">BEGIN WORK</span><br><span class="line">START TRANSACTION</span><br></pre></td></tr></table></figure>

<p>结束事务：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#提交</span><br><span class="line">COMMIT</span><br><span class="line">#回滚</span><br><span class="line">ROLLBACK</span><br></pre></td></tr></table></figure>

<p>注意：1.只有事务性存储引擎支持（存储引擎支持事务）</p>
<p>​            2.只有DML语句可以,DDL语句无法回滚!(CREATE,DROP,TRUNCATE,ALTER)</p>
<p>自动提交：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">set autocommit&#x3D;&#123;1|0&#125;</span><br><span class="line">默认为1，为0时设为非自动提交</span><br><span class="line">建议：显示请求和提交事务，而不要使用“自动提交”功能</span><br></pre></td></tr></table></figure>

<p>事务支持保存点：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SAVEPOINT identifier</span><br><span class="line">ROLLBACK [WORK] TO [SAVEPOINT] identifier</span><br><span class="line">RELEASE SAVEPOINT identifier</span><br></pre></td></tr></table></figure>

<p>查看事务：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#查看当前正在进行的事务</span><br><span class="line">SELECT * FROM INFORMATION_SCHEMA.INNODB_TRX;</span><br><span class="line">#查看当前锁定的事务</span><br><span class="line">SELECT * FROM INFORMATION_SCHEMA.INNODB_LOCKS;</span><br><span class="line">#查看当前等锁的事务</span><br><span class="line">SELECT * FROM INFORMATION_SCHEMA.INNODB_LOCK_WAITS;</span><br><span class="line">#查看当前进程，如果有事务被锁可以通过进程号杀死</span><br><span class="line">show processlist;</span><br><span class="line">#杀死</span><br><span class="line">kill id;</span><br></pre></td></tr></table></figure>



<h5 id="事务隔离级别"><a href="#事务隔离级别" class="headerlink" title="事务隔离级别"></a>事务隔离级别</h5><p>MYsql支持四种隔离级别</p>
<table>
<thead>
<tr>
<th>隔离级别</th>
<th>脏读</th>
<th>不可重复读</th>
<th>幻读</th>
<th>加读锁</th>
</tr>
</thead>
<tbody><tr>
<td>读未提交</td>
<td>可以出现</td>
<td>可以出现</td>
<td>可以出现</td>
<td>否</td>
</tr>
<tr>
<td>读提交</td>
<td>不允许出现</td>
<td>可以出现</td>
<td>可以出现</td>
<td>否</td>
</tr>
<tr>
<td>可重复读</td>
<td>不允许出现</td>
<td>不允许出现</td>
<td>可以出现</td>
<td>否</td>
</tr>
<tr>
<td>序列化</td>
<td>不允许出现</td>
<td>不允许出现</td>
<td>不允许出现</td>
<td>是</td>
</tr>
</tbody></table>
<p>读未提交：READ UNCOMMITTED</p>
<p>​    可读取到未提交数据，产生脏读</p>
<p>读提交：READ COMMITTED</p>
<p>​    可读取到提交数据，但未提交数据不可读，产生不可重复读，即可读取到多个提交数据，导致每次读取数据不一致</p>
<p>可重复读：REPETABLE READ</p>
<p>​    可重复读，多次读取数据都一致，产生幻读，即读取过程中，即使有其他提交的事务修改数据，仍只能读取到未修改前的旧数据。此为mysql默认设置</p>
<p>序列化：SERIALIZABLE</p>
<p>​    可串行化，未提交的读事务阻塞修改事务（加读锁，但不阻塞读事务），或者未提交的修改事务阻塞读事务（加写锁，其他事务的读，写都不可以执行）。会导致并发性能差</p>
<p>MVCC和事务的隔离级别：</p>
<p>MVCC（多版本并发控制机制）只在REPETABLE READ 和 READ COMMITED 两个隔离级别下工作。其他两个隔离级别都和MVCC不兼容，因为READ UNCOMMITED总是读取最新的数据行，而不是符合当前事务版本的数据行。而SERIALIZABLE则会对所有读取的行都加锁</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MVCC：Multi-Version Concurrency Control</span><br></pre></td></tr></table></figure>

<p>插入时间戳，根据时间戳来管理要查询到的数据；MVCC只对读有效果，对写无效；</p>
<p>幻读：幻读产生的原因是事务的写操作；T1事务第一次select出来的内容是A，然后T2事务执行了一个插入数据的操作并提交了，本来这样的操作在可重复读的隔离级别中T1是看不到数据改变的，但是T1接下来执行了一个UPDATE操作，update操作修改的数据恰好匹配到了T2刚刚提交的数据，那么这个数据就会被T1修改，接下来T1执行select就会看到T2提交的数据，当然已经被update修改过了。这就是幻读，第一次select和第二次select看到的内容不一致。</p>
<p>指定事务隔离级别：</p>
<p>变量：tx_isolation</p>
<p>服务器选项：transaction-isolation</p>
<ul>
<li>服务器变量tx_isolation指定，默认为REPETABLE READ，可在GLOBAL和SESSION级进行设置</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SET tx_isolation&#x3D;&#39;READ-UNCOMMITED|READ-COMMITED|REPETABLE-READ|SERIALIZABLE&#39;</span><br></pre></td></tr></table></figure>

<ul>
<li>服务器选项中指定</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim &#x2F;etc&#x2F;my.cnf</span><br><span class="line">[myslqd]</span><br><span class="line">transaction-isolation&#x3D;SERIALIZABLE</span><br></pre></td></tr></table></figure>

<p>死锁：</p>
<p>两个或多个事务在同一资源互相占用，并请求锁定对方占用的资源的状态</p>
<p>当要出现死锁时，数据库会自动发现并解决，解决方式是停止执行时间短的那个事务</p>
<h3 id="日志管理"><a href="#日志管理" class="headerlink" title="日志管理"></a>日志管理</h3><p>Mysql支持丰富的日志类型，如下：</p>
<ul>
<li>事务日志：transaction log</li>
</ul>
<blockquote>
<p>事务日志的写入类型为“追加”，因此其操作为“顺序IO”；通常也被称为：预写式日志 write ahead logging</p>
</blockquote>
<blockquote>
<p>事务日志文件：ib_logfile0,ib_logfile1</p>
</blockquote>
<ul>
<li>错误日志 error log</li>
<li>通用日志 general log</li>
<li>慢查询日志 slow query log</li>
<li>二进制日志 binary log</li>
<li>中继日志 reley log，在主从复制架构中，从服务器用于保存从主服务器的二进制日志中读取的事件</li>
</ul>
<h4 id="事务日志"><a href="#事务日志" class="headerlink" title="事务日志"></a>事务日志</h4><p>事务日志：transaction log</p>
<ul>
<li>redo log：实现WAL（Write Ahead Log），数据更新前先记录redo log  具体名字是：ib_logfile 默认最多50M，默认两个文件，写满就重新写，建议把这个存储值的大小调整大一些，文件个数调整成3个，存放的位置建议是一个干净的只放日志的分区，这样速度更快</li>
<li>undo log：保存与执行的操作相反的操作，用于实现rollback  具体的文件是在每个数据表的name.ibd中</li>
</ul>
<p>事务型存储引擎自行管理和使用，建议和数据文件分开存放</p>
<p>Innodb事务日志相关配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [hellodb]&gt; show variables like &#39;%innodb_log%&#39;;</span><br><span class="line">+-----------------------------+-----------+</span><br><span class="line">| Variable_name               | Value     |</span><br><span class="line">+-----------------------------+-----------+</span><br><span class="line">| innodb_log_buffer_size      | 16777216  |</span><br><span class="line">| innodb_log_checksums        | ON        |</span><br><span class="line">| innodb_log_compressed_pages | ON        |</span><br><span class="line">| innodb_log_file_size        | 100663296 |</span><br><span class="line">| innodb_log_files_in_group   | 1         |</span><br><span class="line">| innodb_log_group_home_dir   | .&#x2F;        |</span><br><span class="line">| innodb_log_optimize_ddl     | OFF       |</span><br><span class="line">| innodb_log_write_ahead_size | 8192      |</span><br><span class="line">+-----------------------------+-----------+</span><br><span class="line">8 rows in set (0.000 sec)</span><br><span class="line"></span><br><span class="line">innodb_log_file_size #每个日志文件大小</span><br><span class="line">innodb_log_files_in_group #日志组成员个数</span><br><span class="line">innodb_log_group_home_dir #事务文件路径</span><br><span class="line">innodb_flush_log_at_trx_commit #默认为1</span><br></pre></td></tr></table></figure>

<p>事务日志性能优化</p>
<p><img src="C:\Users\a\AppData\Roaming\Typora\typora-user-images\image-20201009104011312.png" alt="image-20201009104011312"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">innodb_flush_log_at_trx_commit&#x3D;0|1|2</span><br><span class="line">1 此为默认值，日志缓冲区将写入日志文件，并在每次事务后执行刷新到磁盘。完全遵循ACID特性，但是磁盘I&#x2F;O会变多，对数据来说最安全</span><br><span class="line">0 提交时没有写磁盘的操作；而是每秒执行一次将日志缓冲区的提交的事务写入刷新到磁盘。这样可提供更好的性能，但数据库服务崩溃可能丢失最后一秒的事务，速度最快，I&#x2F;O</span><br><span class="line">2 每次提交后都会写入OS的缓冲区，但每秒才会进行一次刷新到磁盘文件的操作。性能比0略差一些，但操作系统或停电可能导致最后一秒的数据丢失。</span><br><span class="line">1模式最慢但最安全；</span><br><span class="line">0模式最快但不安全；</span><br><span class="line">2模式中等速度中等安全</span><br><span class="line">推荐2模式</span><br></pre></td></tr></table></figure>



<h4 id="错误日志"><a href="#错误日志" class="headerlink" title="错误日志"></a>错误日志</h4><p>mysql启动和关闭过程中输出的事件信息</p>
<p>记录mysql运行过程中产生的错误信息</p>
<p>event_scheduler运行一个event时产生的日志信息</p>
<p>在主从复制架构中的从服务器上启动从服务器线程时产生的信息</p>
<p>错误文件路径</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SHOW GLOABL VARIABLES LIKE &#39;log_error&#39;;</span><br><span class="line">+---------------+------------------------+</span><br><span class="line">| Variable_name | Value                  |</span><br><span class="line">+---------------+------------------------+</span><br><span class="line">| log_error     | &#x2F;data&#x2F;mysql&#x2F;mysqld.log |</span><br><span class="line">+---------------+------------------------+</span><br><span class="line">1 row in set (0.001 sec)</span><br></pre></td></tr></table></figure>

<p>记录哪些警告信息至错误日志文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">log_warnings&#x3D;0|1|2|3...</span><br><span class="line">MariaDB [(none)]&gt; show variables like &#39;log_warnings&#39;;</span><br><span class="line">+---------------+-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+---------------+-------+</span><br><span class="line">| log_warnings  | 2     |</span><br><span class="line">+---------------+-------+</span><br><span class="line">1 row in set (0.000 sec)</span><br></pre></td></tr></table></figure>

<h4 id="通用日志"><a href="#通用日志" class="headerlink" title="通用日志"></a>通用日志</h4><p>通用日志：记录对数据库的通用操作，包括错误的SQL语句</p>
<p>通用日志可以保存在file(默认值)或table(mysql.general_log)</p>
<p>通用日志相关设置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">general_log&#x3D;ON|OFF</span><br><span class="line">general_log_file&#x3D;HOSTNAME.log</span><br><span class="line">log_output&#x3D;TABLE|FILE|NONE</span><br></pre></td></tr></table></figure>

<p>范例：查找执行次数最多的前三个</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select argument,count(argument) from general_log group by argument order by count(argument) desc limit 3</span><br></pre></td></tr></table></figure>

<p>范例：对访问的语句进行排序</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost mysql]#mysql -uroot -p&#39;centos&#39; -e &quot;select argument from mysql.general_log&quot; | awk &#39;&#123;sql[$0]++&#125;END&#123;for (i in sql) &#123;print sql[i],i&#125;&#125;&#39;|sort -nr</span><br></pre></td></tr></table></figure>



<h4 id="慢查询日志"><a href="#慢查询日志" class="headerlink" title="慢查询日志"></a>慢查询日志</h4><p>慢查询日志：记录执行查询时长超出指定时长的操作</p>
<p>慢查询相关变量：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">slow_query_log&#x3D;ON|OFF #开启或关闭慢查询，支持全局和会话，只有全局设置才会生成慢查询</span><br><span class="line">long_query_time&#x3D;N #慢查询的阈值，单位秒，默认为10s</span><br><span class="line">slow_query_log_file&#x3D;HOSTNAME-slow.log #慢查询日志</span><br><span class="line">log_slow_filter&#x3D;admin,filesort,filesort_on_disk,full_join,full_scan,query_cache,query_cache_miss,tmp_table,tmp_table_on_disk</span><br><span class="line">#只有是上述查询类型且查询时长超过long_query_time阈值，才记录日志</span><br><span class="line">log_queries_not_using_indexes&#x3D;ON #不使用索引或使用全索引扫描的情况下，不论是否达到慢查询阈值。是不是要记录，默认是不记录的</span><br><span class="line">log_slow_rate_limit&#x3D;1 #多少次查询才记录，mariadb特有</span><br><span class="line">log_slow_verbosity&#x3D;query_plan,explain #记录内容</span><br><span class="line">log_slow_queries&#x3D;off #同slow_query_log</span><br></pre></td></tr></table></figure>

<p>慢查询分析工具</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#mysqldumpslow -s c -t 10 &#x2F;data&#x2F;mysql&#x2F;slow.log</span><br></pre></td></tr></table></figure>



<h4 id="使用profile工具"><a href="#使用profile工具" class="headerlink" title="使用profile工具"></a>使用profile工具</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#开启profile工具</span><br><span class="line">set profiling &#x3D; on</span><br><span class="line">#查看查询语句的执行时间</span><br><span class="line">show profiles;</span><br><span class="line">#显示语句的详细执行步骤和时长</span><br><span class="line">show profile for query N;  # N 是通过show profiles 看到的ID</span><br><span class="line">#显示CPU使用情况</span><br><span class="line">show profile cpu for query N # N 是 看到的ID</span><br></pre></td></tr></table></figure>



<h4 id="二进制日志（备份）"><a href="#二进制日志（备份）" class="headerlink" title="二进制日志（备份）"></a>二进制日志（备份）</h4><h5 id="二进制日志的作用："><a href="#二进制日志的作用：" class="headerlink" title="二进制日志的作用："></a>二进制日志的作用：</h5><ul>
<li>记录导致数据改变或潜在导致数据改变的SQL语句</li>
<li>记录已提交的日志</li>
<li>不依赖于存储引擎类型</li>
</ul>
<p>通过“重放”二进制日志文件中的事件来生成数据副本</p>
<p>建议二进制文件和数据文件分开存放</p>
<h5 id="二进制日志记录的三种模式"><a href="#二进制日志记录的三种模式" class="headerlink" title="二进制日志记录的三种模式"></a>二进制日志记录的三种模式</h5><ul>
<li>基于“语句”记录：statement，记录语句，默认模式（mariadb 10.2.3以下），日志量较少</li>
<li>基于“行”记录：row，记录数据，日志量较大，更加安全，建议使用的格式</li>
<li>混合模式：mixed，让系统自行判断该基于哪种方式进行，默认模式（mariadb 10.2.4以上）</li>
</ul>
<h5 id="格式配置"><a href="#格式配置" class="headerlink" title="格式配置"></a>格式配置</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#mariadb 10.5.5 默认是mixed</span><br><span class="line">MariaDB [hellodb]&gt; show variables like &#39;binlog_format&#39;;</span><br><span class="line">+---------------+-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+---------------+-------+</span><br><span class="line">| binlog_format | MIXED |</span><br><span class="line">+---------------+-------+</span><br><span class="line">1 row in set (0.001 sec)</span><br><span class="line"></span><br><span class="line">#MYsql 8.0 中默认是row</span><br><span class="line">mysql&gt; show variables like &#39;binlog_format&#39;;</span><br><span class="line">+---------------+-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+---------------+-------+</span><br><span class="line">| binlog_format | ROW   |</span><br><span class="line">+---------------+-------+</span><br><span class="line">1 row in set (0.06 sec)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="二进制文件的构成"><a href="#二进制文件的构成" class="headerlink" title="二进制文件的构成"></a>二进制文件的构成</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">有两类文件</span><br><span class="line">1.日志文件，mysql|mariadb-bin.文件名后缀，二进制格式，如：mariabd-bin.00001</span><br><span class="line">2.索引文件：mysql|mariadb-bin.index，文本格式</span><br></pre></td></tr></table></figure>

<p>二进制日志相关的服务器变量：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">sql_log_bin&#x3D;ON|OFF #是否记录二进制文件，默认on，支持动态修改，系统变量，不是服务器参数</span><br><span class="line"></span><br><span class="line">log_bin&#x3D;&#x2F;path&#x2F;bin_log_file #指定文件位置，默认为OFF</span><br><span class="line">将需要存储二进制日志的目录加上权限：chown -R mysql:mysql &#x2F;data</span><br><span class="line"></span><br><span class="line">binlog_format&#x3D;statement|row|mixed #二进制日志记录的格式，默认为</span><br><span class="line">statement</span><br><span class="line"></span><br><span class="line">max_binlog_size&#x3D;1073741824 #单个二进制文件的最大体积，到达最大值会自动滚动，默认为1G。但是文件达到上限时的文件大小未必为指定的精确值</span><br><span class="line"></span><br><span class="line">binlog_cache_size&#x3D;4M #此变量确定在每次事务中保存二进制日志更改记录的缓存的大小</span><br><span class="line"></span><br><span class="line">max_binlog_cache_size&#x3D;512M #限制用于缓存多事务查询的字节的大小</span><br><span class="line"></span><br><span class="line">sync_binlog&#x3D;1|0 #设定是否启动二进制日志即时同步磁盘功能，默认为0，由操作系统负责同步日志到磁盘</span><br><span class="line"></span><br><span class="line">expire_logs_days&#x3D;N #二进制日志可以自动删除的天数，默认为0，即不自动删除</span><br></pre></td></tr></table></figure>

<h5 id="二进制日志相关的配置"><a href="#二进制日志相关的配置" class="headerlink" title="二进制日志相关的配置"></a>二进制日志相关的配置</h5><p>查看数据库自行管理使用中的二进制日志文件列表和大小</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show binary logs;</span><br></pre></td></tr></table></figure>

<p>查看使用中的二进制日志文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show master status</span><br></pre></td></tr></table></figure>

<p>查看二进制文件中的指定内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show binlog events [in &#39;log_name&#39;] [from pos][limit [offset,] row_count]</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show binlog events in &#39;bin.xxxxx&#39; from number1 limit xxx,xxx</span><br></pre></td></tr></table></figure>

<p>生成新的二进制文件的方式：</p>
<p>1.重启数据库服务</p>
<p>2.单个文件达到最大值，max_binlog_size</p>
<p>3.flush logs;</p>
<h5 id="myslqbinlog"><a href="#myslqbinlog" class="headerlink" title="myslqbinlog"></a>myslqbinlog</h5><p>mysqlbinlog:二进制日志的客户端命令工具，支持离线查看二进制日志</p>
<p>命令格式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysqlbinlog [options] logfile...</span><br><span class="line">	--start-position&#x3D; #开始位置</span><br><span class="line">	--stop-position&#x3D;</span><br><span class="line">	--start-datatime&#x3D; #开始时间，时间格式是：YYYY-MM-DD hh:mm:ss</span><br><span class="line">	--stop-datetime&#x3D;</span><br><span class="line">	--base64-output[&#x3D;name]</span><br><span class="line">	-v -vvv</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 mysql]#mysqlbinlog --start-position&#x3D;678 --stop-position&#x3D;752 binlog.000001 -v</span><br></pre></td></tr></table></figure>

<p>二进制日志事件的格式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># at 328</span><br><span class="line">#151105 16:31:30 server id 1 end_log_pos 431 query thread_id&#x3D;1</span><br><span class="line">exec_time&#x3D;0 error_code&#x3D;0</span><br><span class="line">use &#96;mydb&#96;&#x2F;*!*&#x2F;;</span><br><span class="line">set timestamp&#x3D;1446712300&#x2F;*!*&#x2F;;</span><br><span class="line">create table tb1 (id int,name char(30))</span><br><span class="line">&#x2F;*!*&#x2F;;</span><br><span class="line">事件发生的日期和时间：151105 16:31:30</span><br><span class="line">事件发生的服务器标识：server id 1</span><br><span class="line">事件的结束位置：end_log_pos 431</span><br><span class="line">事件的类型：query</span><br><span class="line">事件发生时所在服务器执行此时间的线程的ID：thread_id&#x3D;1</span><br><span class="line">语句的时间戳与将其写入二进制文件中的时间差：exec_time&#x3D;0</span><br><span class="line">错误代码：error_code&#x3D;0</span><br><span class="line">事件内容：</span><br><span class="line">use &#96;mydb&#96;&#x2F;*!*&#x2F;;</span><br><span class="line">set timestamp&#x3D;1446712300&#x2F;*!*&#x2F;;</span><br><span class="line">create table tb1 (id int,name char(30))</span><br><span class="line">&#x2F;*!*&#x2F;;</span><br></pre></td></tr></table></figure>

<p>清除指定二进制日志：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PURGE &#123;BINARY|MASTER&#125; LOGS &#123;TO &#39;log_name&#39; |BEFROE datetime_expr&#125;</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PURGE BINARY LOGS TO &#39;bin.xxxx&#39;;</span><br><span class="line">PURGE BINARY LOGS BEFROE &#39;2018-01-01&#39;</span><br></pre></td></tr></table></figure>

<p>删除所有二进制日志，index文件重新计数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RESET MASTER [TO NUMBER]；#删除所有二进制日志文件，并重新生成日志文件，文件名从&#39;NUMBER&#39;开始计数，默认从1开始，一般是master主机第一次启动时执行</span><br></pre></td></tr></table></figure>

<p>切换日志文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FULSH LOGS;</span><br></pre></td></tr></table></figure>






<h2 id="MySQL备份和恢复"><a href="#MySQL备份和恢复" class="headerlink" title="MySQL备份和恢复"></a>MySQL备份和恢复</h2><h3 id="备份恢复概述"><a href="#备份恢复概述" class="headerlink" title="备份恢复概述"></a>备份恢复概述</h3><p>1.为什么要备份：</p>
<p>​    灾难恢复；硬件故障；软件故障；自然灾害；黑客攻击；误操作；</p>
<p>2.备份的类型：</p>
<ul>
<li>完全备份，部分备份<ul>
<li>完全备份：整个数据库全部数据</li>
<li>部分备份：只备份数据，是一个子集</li>
</ul>
</li>
<li>完全备份、增量备份、差异备份<ul>
<li>增量备份：在完全备份以及之前的增量备份的基础上，只备份变化的数据，备份较快，恢复复杂，也就是下一次增量备份是建立在之前备份的基础上的，增量备份文件个数会越来越多，他的备份参照物是第一次完全备份文件以及之后每次的增量备份文件</li>
<li>差异备份：在完全备份的基础上，只备份与完全备份时不相同的数据。备份较慢，恢复简单。他的参照物就是第一次的完全备份，之后每次的差异备份都会把当今的数据和完全备份的数据进行对比，然后把有差异的部分备份下来。他的备份文件就是两部分，一部分是完全备份，一部分是差异备份，但是时间长了，差异备份文件就会变大，备份起来也更慢</li>
</ul>
</li>
</ul>
<p><img src="C:\Users\a\AppData\Roaming\Typora\typora-user-images\image-20200928095706768.png" alt="增量备份"></p>
<p>​                                    图1.增量备份</p>
<p><img src="C:\Users\a\AppData\Roaming\Typora\typora-user-images\image-20200928095754867.png" alt="差异备份"></p>
<p>​                                    图2.差异备份</p>
<ul>
<li><p>冷备份、温备份、热备份</p>
<ul>
<li>冷备份：读、写操作均不可进行，数据库停止服务</li>
<li>温备份：读操作可执行，但写操作不可执行</li>
<li>热备份：读、写操作均可执行</li>
</ul>
<p>注：MyISAM支持冷备份和温备份，不支持热备份；InnoDB三种备份都支持</p>
</li>
<li><p>物理备份和逻辑备份</p>
<ul>
<li>物理备份：直接复制数据文件进行备份，与存储引擎有关，占用较多的空间，速度快</li>
<li>逻辑备份：从数据库中“导出”数据另存而进行的备份，与存储引擎无关，占用空间少，速度慢，可能丢失精度</li>
</ul>
</li>
</ul>
<p>3.备份什么</p>
<ul>
<li><p>数据</p>
</li>
<li><p>二进制日志、InnoDB事务日志</p>
</li>
<li><p>用户账户，权限设置，程序代码（存储过程、函数、触发器、事件调度器）</p>
</li>
<li><p>服务器的配置文件</p>
</li>
<li><p>表、视图、触发器存放在对应数据库的文件夹下</p>
<p>函数、存储过程存放在mysql.proc表中</p>
<p>事件存放在mysql.event表中</p>
</li>
</ul>
<p>物理备份：</p>
<ul>
<li>/data/mysql/* 所有数据文件</li>
<li>/etc/my.cnf 服务配置文件</li>
<li>/data/logbin/* 二进制日志</li>
</ul>
<p>逻辑备份：</p>
<ul>
<li>mysql库（这里也包括了函数、存储过程、事件）</li>
<li>用户数据库</li>
</ul>
<p>4.备份注意要点</p>
<ul>
<li>能容忍最多丢失多少数据</li>
<li>备份产生的负载</li>
<li>备份过程的时长</li>
<li>温备份的持续锁多久</li>
<li>恢复数据需要在多长时间内完成</li>
<li>需要备份和恢复哪些数据</li>
</ul>
<p>5.还原要点</p>
<ul>
<li><strong>做还原测试，用于测试备份的可用性</strong></li>
<li><strong>还原演练，写成规范的技术文档</strong></li>
</ul>
<p>6.备份工具</p>
<ul>
<li>cp,tar等复制归档工具；物理备份工具，适用于所有存储引擎；只支持冷备；完全和部分备份</li>
<li>LVM的快照：先加读锁，做快照后解锁，几乎热备；借助文件系统工具进行备份</li>
<li>mysqldump：逻辑备份工具，适用于所有存储引擎，支持完全备份和部分备份；对InnoDB存储引擎支持热备，结合binlog的增量备份；对MyISAM存储引擎进行温备份；</li>
<li>xtrabackup：由Percona提供的支持对InnoDB做热备（物理备份）的工具，支持完全备份、增量备份</li>
<li>MariaDB Backup：从MariaDB10.1.26开始集成</li>
<li>mysqlbackup：热备份</li>
<li>mysqlhotcopy：Perl语言实现，几乎冷备份，仅适用于MyISAM存储引擎，使用LOCK TABLES、FLUSH TABLES和cp或scp来快速备份数据库</li>
</ul>
<h3 id="mysqldump备份工具"><a href="#mysqldump备份工具" class="headerlink" title="mysqldump备份工具"></a>mysqldump备份工具</h3><p>避免DDL语句的出现</p>
<h4 id="mysqldump-说明"><a href="#mysqldump-说明" class="headerlink" title="mysqldump 说明"></a>mysqldump 说明</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysqldump database [table]  #支持指定数据库和数据表的备份，但是数据库本身的定义没有备份，不推荐使用</span><br><span class="line">OR</span><br><span class="line">mysqldump [options] -B database1 [db2,db3...]  #支持指定数据库备份，包含数据库本身定义也会备份，推荐使用</span><br><span class="line">OR</span><br><span class="line">mysqldump [options] -A [options]   #备份所有数据库，包含数据库本身定义也会备份，注意information_schema和performance_schema表不会备份，这两个是内存中使用的表</span><br></pre></td></tr></table></figure>

<p>参数说明：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">-A,--all-databases #备份所有数据库，包含数据库定义语句；不备份Information_schema和performance_schema表</span><br><span class="line">-B --database db_name  #指定备份的数据库，包括数据库定义语句</span><br><span class="line">-E --events  #备份相关的所有event scheduler</span><br><span class="line">-R --routines  #备份所有函数和存储过程</span><br><span class="line">--triggers  #备份所有触发器，默认启用</span><br><span class="line">--default-character-set&#x3D;  #指定默认字符集</span><br><span class="line">--master-data[&#x3D;N]  #这个选项必须开启二进制日志使用</span><br><span class="line">#选项是1或者2；默认是1；</span><br><span class="line">#这个选项本身的意思是在生成的备份文件中（*.sql）添加一句 CHANGE MASTER TO 语句，1是不注释这句话，适合用于主从复制，2是注释这句话，适合单机使用</span><br><span class="line">#CHANGE MASTER TO 指明了备份完的数据库后面的内容从哪里继续了，给人一个明确的文件和文件位置</span><br><span class="line">#这个选项会默认打开-x或者--lock-all-tables功能，也就是锁全表功能，除非打开了--single-transaction选项</span><br><span class="line">-F --flush-logs  #锁表完成后刷新日志，从新的日志文件开始，配合-A或-B的话会导致多次刷新日志，可以配合--single-transaction，--master-data，这样就只刷新一次</span><br><span class="line">--compact   #去掉注释的内容，适合调试时使用，节约一些空间，生产中不用</span><br><span class="line">-d --no-data  #只备份数据结构，不备份数据，即备份create xxxx</span><br><span class="line">-t --no-create-info  #只备份数据，不备份结构，即没有create xxx</span><br><span class="line">-n --no-create-db  #不备份create database，可以被-A和-B覆盖</span><br><span class="line">--flush-privileges  #刷新权限，备份mysql库时要使用</span><br><span class="line">-f --force #忽略SQL错误，继续执行</span><br><span class="line">--hex-blob  #使用十六进制符号转储二进制列，当包含BINARY,VARBINARY,BLOB,BIT的数据类型的列时使用</span><br><span class="line">-q --quick  #不缓存查询，直接输出，加快备份速度</span><br><span class="line"></span><br><span class="line">与MyISAM存储引擎有关的备份选项：</span><br><span class="line">MyISAM不支持事务，只能支持温备，不支持热备，所以备份前要锁定要备份的数据库，而后启动备份操作</span><br><span class="line">-x --lock-all-tables  #加全局读锁，锁定所有库的所有表</span><br><span class="line">-l --lock-tables  #对于需要备份的每个数据库，在启动备份之前分别锁定其所有表</span><br><span class="line"></span><br><span class="line">与InnoDB存储引擎有关的备份选项：</span><br><span class="line">InnoDB存储引擎支持事务，可以利用事务的相应的隔离级别，实现热备，也可以实现温备，但不建议使用</span><br><span class="line">--single-transaction</span><br><span class="line">此选项在备份前开启一个事务，start transaction。</span><br><span class="line">注意，事务的基础是MVCC，多版本并发控制。MVCC是由存储引擎支持的（只有InnoDB支持）。</span><br><span class="line">MVCC可以管理DML语句，但是DDL语句就无能为力了，因此在开启一个事务时其他人不要使用DDL语句（CREATE,ALTER,DROP,TRUNCATE,RENAME）。</span><br></pre></td></tr></table></figure>



<p>InnoDB备份建议命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -uroot -p -A -F -E -R --single-transaction --master-data&#x3D;1 --flush-privileges --default-character-set&#x3D;utf8mb4 --hex-blob | gzip &gt; &#x2F;backup&#x2F;full.sql.gz</span><br></pre></td></tr></table></figure>



<p>MyISAM备份建议命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -uroot -p -A -E -R -F -x --master-date&#x3D;1 --flush-privileges --default-character-set&#x3D;utf8mb4 --hex-blob | gzip &gt; &#x2F;backup&#x2F;full.sql.gz</span><br></pre></td></tr></table></figure>



<h4 id="mysql分库备份实战"><a href="#mysql分库备份实战" class="headerlink" title="mysql分库备份实战"></a>mysql分库备份实战</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -B database  | gzip &gt; backup.sql.gz</span><br></pre></td></tr></table></figure>

<p>范例：分库备份</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">for db in &#96;mysql -uroot -pcentos -e &#39;show databases&#39; | grep -vE &quot;Database|information_schema|performance_schema&quot;&#96;;do mysqldump -uroot -pcentos -B $db | gzip &gt; &#x2F;backup&#x2F;$db-&#96;date +%F-%H-%M-%S&#96;.sql.gz;done;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -pcentos -e &#39;show databases&#39; | grep -Ev &quot;Database|information_schema|performance_schema&quot;|while read db;do mysqldump -uroot -pcentos -B $db | gzip &gt; &#x2F;backup&#x2F;$db-&#96;date +%F_%H-%M-%S&#96;.sql.gz;done</span><br></pre></td></tr></table></figure>



<h4 id="mysqldump-备份还原实战案例"><a href="#mysqldump-备份还原实战案例" class="headerlink" title="mysqldump 备份还原实战案例"></a>mysqldump 备份还原实战案例</h4><p>如何开启二进制日志；二进制日志的结构，是不是可以直接阅读的；是不是可以直接修改二进制日志文件中的drop,delete等行就可以把数据恢复回来了；数据备份了如何还原；</p>
<p>没有二进制文件也可以备份，把想要备份的数据库备份了就行</p>
<p>数据库的恢复：在mysql命令行中 source /backup/xxx.sql  直接进行恢复</p>
<p>分数据库进行备份</p>
<p>下面的操作是把需要备份的数据库名字找到，找到后使用 mysqldump -B 进行备份</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]#mysql -uroot -p -e &#39;show databases&#39;|grep -Ev &#39;^(Database|information_schema|performance_schema)$&#39;|while read db;do echo &quot;备份$db&quot;;done</span><br><span class="line">Enter password: </span><br><span class="line">备份hellodb</span><br><span class="line">备份mysql</span><br></pre></td></tr></table></figure>

<p>全部备份，实现增量备份</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">备份文件放在&#x2F;backup下</span><br><span class="line">日志文件放在&#x2F;data&#x2F;mysql&#x2F;mylogbin-xxxx </span><br></pre></td></tr></table></figure>

<p>1.全部备份，依靠二进制文件，生成一个.sql文件</p>
<p>2.对数据库进行操作，增加删除数据，修改数据表等操作</p>
<p>3.发现删错数据了，想要还原</p>
<p>4.还原需要依靠一直开着的二进制日志才能完成，要不然只能回复到备份状态，中间所有操作都会丢失。开启二进制日志的话，不管中间做了什么，都能保留下来，只把删除语句删除了就行</p>
<p>5.去完全备份文件中找到备份结束的标志：CHANGE MASTER TO ，并查看它把下一步日志指向了哪个二进制日志文件，位置是哪里</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-- CHANGE MASTER TO MASTER_LOG_FILE&#x3D;&#39;mylogbin.000002&#39;, MASTER_LOG_POS&#x3D;383;</span><br></pre></td></tr></table></figure>

<p>6.找到这个二进制日志文件，找到这个位置，用mysqlbinlog</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">myslqbinlog &#x2F;data&#x2F;mysql&#x2F;mylogbin.000002 --start-position&#x3D;383</span><br></pre></td></tr></table></figure>

<p>7.把从这个位置之后的内容重定向到一个新文件inc.sql中，这代表了从完全备份后的增量日志文件，通过这个文件可以把增量的数据都找到</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysqlbinlog &#x2F;data&#x2F;mysql&#x2F;mylogbin.000002 --start-position&#x3D;383</span><br><span class="line"> &gt; &#x2F;backup&#x2F;inc.sql</span><br></pre></td></tr></table></figure>

<p>8.因为是错误删除数据了，所以去这个增量文件中找到删除命令 ‘DROP TABLE’,然后把这行删除就行了，这样再把这个文件还原了就能获得没有被删除的数据了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i.bak &#39;&#x2F;^DROP TABLE&#x2F;d&#39; inc.sql</span><br></pre></td></tr></table></figure>

<p>9.停止访问数据库，在mysql客户端命令行中关闭二进制日志，准备还原 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set sql_log_bin&#x3D;0</span><br></pre></td></tr></table></figure>

<p>10.还原，先还原完全备份，然后再还原增量文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">source &#x2F;backup&#x2F;full_backup.sql</span><br><span class="line">source &#x2F;backup&#x2F;inc.sql</span><br></pre></td></tr></table></figure>

<p>11.查看数据库，发现数据都回来了</p>
<h3 id="xtrabackup备份工具"><a href="#xtrabackup备份工具" class="headerlink" title="xtrabackup备份工具"></a>xtrabackup备份工具</h3><h4 id="xtrabackup工具介绍"><a href="#xtrabackup工具介绍" class="headerlink" title="xtrabackup工具介绍"></a>xtrabackup工具介绍</h4><p>官方文档：<a target="_blank" rel="noopener" href="https://www.percona.com/doc/percona-xtrabackup/LATEST/index.html">https://www.percona.com/doc/percona-xtrabackup/LATEST/index.html</a></p>
<p>自MariaDB10.2.7（含）以上版本，不再支持使用Percona XtraBackup工具在线物理热备份。使用mariabackup</p>
<h4 id="xtrabackup安装"><a href="#xtrabackup安装" class="headerlink" title="xtrabackup安装"></a>xtrabackup安装</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install xtrabackup</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">perl-Digest-MD5</span><br></pre></td></tr></table></figure>

<h4 id="xtrabackup用法"><a href="#xtrabackup用法" class="headerlink" title="xtrabackup用法"></a>xtrabackup用法</h4><p>xtrabackup使用分三步：</p>
<p>1.备份</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]#xtrabackup --user&#x3D;root --password&#x3D;&#39;centos&#39; -S &#x2F;tmp&#x2F;mysql.sock --backup --target-dir&#x3D;&#x2F;backup&#x2F;</span><br></pre></td></tr></table></figure>

<p>2.预准备</p>
<p>这一步是为了让二进制日志文件和数据库中的数据保持一致性。</p>
<p>因为在对数据库进行操作时，会先把操作写入日志，然后经过提交事务后才会对数据库进行操作。所以要把日志中还没提交的事务回滚，把已经提交的事务同步给数据库。这样就能让日志和数据库保持一致性</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 data]#xtrabackup --prepare --target-dir&#x3D;&#x2F;backup&#x2F;</span><br></pre></td></tr></table></figure>



<p>3.还原</p>
<p>这一步中有要求：</p>
<ul>
<li>数据库服务要停了</li>
<li>存放数据文件的文件夹必须为空</li>
</ul>
<p>然后执行还原命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 data]#xtrabackup --copy-back --target-dir&#x3D;&#x2F;backup&#x2F;</span><br></pre></td></tr></table></figure>

<p>最后把数据文件的所有者和所有组修改成mysql</p>
<h4 id="利用xtrabackup实现完全备份及还原"><a href="#利用xtrabackup实现完全备份及还原" class="headerlink" title="利用xtrabackup实现完全备份及还原"></a>利用xtrabackup实现完全备份及还原</h4><h4 id="利用xtrabackup实现完全，增量备份及还原"><a href="#利用xtrabackup实现完全，增量备份及还原" class="headerlink" title="利用xtrabackup实现完全，增量备份及还原"></a>利用xtrabackup实现完全，增量备份及还原</h4><p>增量备份</p>
<p>1.完全备份</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xtrabackup --user&#x3D;root --password&#x3D;&#39;centos&#39; -S &#x2F;tmp&#x2F;mysql.sock --backup --target-dir&#x3D;&#x2F;backup&#x2F;bak</span><br></pre></td></tr></table></figure>

<p>2.修改数据，实现增量数据</p>
<p>3.增量备份一次</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xtrabackup --user&#x3D;root --password&#x3D;centos -S &#x2F;tmp&#x2F;mysql.sock --backup --target-dir&#x3D;&#x2F;backup&#x2F;inc --incremental-basedir&#x3D;&#x2F;backup&#x2F;bak&#x2F;</span><br></pre></td></tr></table></figure>

<p>4.再次修改数据，实现增量数据</p>
<p>5.增量备份一次</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xtrabackup --user&#x3D;root --password&#x3D;centos -S &#x2F;tmp&#x2F;mysql.sock --backup --target-dir&#x3D;&#x2F;backup&#x2F;inc2 --incremental-basedir&#x3D;&#x2F;backup&#x2F;inc&#x2F;</span><br></pre></td></tr></table></figure>

<p>6.出现错误想要还原数据</p>
<p>7.相比完全备份的还原，增量备份的还原在prepare阶段需要进行一次完全备份准备以及多次增量备份准备（增量备份了几次就还原几次）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xtrabackup --prepare --apply-log-only --target-dir&#x3D;&#x2F;backup&#x2F;bak&#x2F;</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xtrabackup --prepare --apply-log-only --target-dir&#x3D;&#x2F;backup&#x2F;bak&#x2F; --incremental-dir&#x3D;&#x2F;backup&#x2F;inc&#x2F;</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xtrabackup --prepare  --target-dir&#x3D;&#x2F;backup&#x2F;bak&#x2F; --incremental-dir&#x3D;&#x2F;backup&#x2F;inc2&#x2F;</span><br></pre></td></tr></table></figure>

<p>8.还原过程与完全备份一样，需要停止服务，清空数据文件的存放目录，以及最后把所有者和所有组改成mysql</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">service mysqld stop</span><br><span class="line">rm -rf &#x2F;data&#x2F;mysql&#x2F;*</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xtrabackup --copy-back --target-dir&#x3D;&#x2F;backup&#x2F;bak&#x2F;</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chown -R mysql.mysql &#x2F;data&#x2F;mysql&#x2F;</span><br></pre></td></tr></table></figure>



<h4 id="xtrabackup单表导出和导入"><a href="#xtrabackup单表导出和导入" class="headerlink" title="xtrabackup单表导出和导入"></a>xtrabackup单表导出和导入</h4><p>单表导出</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xtrabackup --user&#x3D;root --password&#x3D;centos --backup --target-dir&#x3D;&#x2F;backup&#x2F; --tables&#x3D;&#39;^hellodb[.]students&#39; -S &#x2F;tmp&#x2F;mysql.sock</span><br></pre></td></tr></table></figure>



<h2 id="MySQL集群Cluster"><a href="#MySQL集群Cluster" class="headerlink" title="MySQL集群Cluster"></a>MySQL集群Cluster</h2><h3 id="MySQL主从复制"><a href="#MySQL主从复制" class="headerlink" title="MySQL主从复制"></a>MySQL主从复制</h3><h4 id="1-主从复制架构和原理"><a href="#1-主从复制架构和原理" class="headerlink" title="1.主从复制架构和原理"></a>1.主从复制架构和原理</h4><p>1.1 服务性能扩展方式</p>
<ul>
<li>Scale Up，向上扩展，垂直扩展</li>
<li>Scale Out，向外扩展，横向扩展</li>
</ul>
<p>1.2 MySQL的扩展</p>
<ul>
<li>读写分离</li>
<li>复制：每个节点都有相同的数据集，向外扩展，基于二进制日志的单向复制</li>
</ul>
<p>1.3 复制的功用</p>
<ul>
<li>实现数据分布</li>
<li>实现负载可以均衡地读</li>
<li>实现备份</li>
<li>实现高可用和故障切换</li>
<li>MySQL升级测试</li>
</ul>
<p>1.4 复制的架构</p>
<p>一主一从的复制架构</p>
<p><img src="C:\Users\a\AppData\Roaming\Typora\typora-user-images\image-20200929165555349.png" alt="image-20200929165555349"></p>
<p>一主多从的复制架构</p>
<p><img src="C:\Users\a\AppData\Roaming\Typora\typora-user-images\image-20200929165621541.png" alt="image-20200929165621541"></p>
<p>1.5 主从复制的原理</p>
<p><img src="C:\Users\a\AppData\Roaming\Typora\typora-user-images\image-20200929171429834.png" alt="image-20200929171429834"></p>
<p>主从复制相关线程：</p>
<p>主节点：</p>
<ul>
<li>dump Thread：为每个Slave的 I/O Thread启动一个dump线程，用于向其发送binary log events</li>
</ul>
<p>从节点：</p>
<ul>
<li>I/O Thread：向Master请求二进制日志事件，并保存于中继日志(RELAY LOG)中</li>
<li>SQL Thread：从中继日志中读取日志事件，在本地完成重放</li>
</ul>
<p>根复制相关的文件：</p>
<ul>
<li>master.info：用于保存slave连接至master时的相关信息，例如账号、密码、服务器地址等</li>
<li>relay-log.info：保存在当前slave节点上已经复制的当前二进制日志和本地relay log日志的对应关系</li>
<li>mariadb-relay-bin.00000#：中继日志，保存从主节点复制过来的二进制日志，本质就是二进制日志</li>
</ul>
<p>1.6 主从复制特点</p>
<ul>
<li>异步复制</li>
<li>主从数据不一致比较常见</li>
</ul>
<p>1.7 各种复制架构</p>
<ul>
<li>一主一从</li>
<li>一主多从</li>
<li>从服务器可以再有从服务器</li>
<li>主主</li>
<li>一从多主：适用于多个不同数据库</li>
<li>环状复制</li>
</ul>
<p><img src="C:\Users\a\AppData\Roaming\Typora\typora-user-images\image-20200929173016961.png" alt="image-20200929173016961"></p>
<p>复制时需要考虑二进制日志事件的记录格式</p>
<ul>
<li>STATEMENT（5.0之前）</li>
<li>ROW（目前推荐）</li>
<li>MIXED</li>
</ul>
<h4 id="2-实现主从复制配置"><a href="#2-实现主从复制配置" class="headerlink" title="2.实现主从复制配置"></a>2.实现主从复制配置</h4><p>配置分为主节点的配置和从节点的配置</p>
<p><strong>主节点配置：</strong></p>
<p>（1）启用二进制日志</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">log_bin </span><br><span class="line">#或者指定log_bin&#x3D;&#x2F;backup&#x2F;logbin，这样指定路径的方式一定要给备份路径更改用户组和用户为mysql，否则会导致服务无法启动</span><br></pre></td></tr></table></figure>

<p>（2）为当前节点设置一个全局唯一的ID号</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">server-id &#x3D; NUMBER </span><br><span class="line">log-basename &#x3D; master #可选性，设置二进制日志名称，确保不依赖于主机名</span><br></pre></td></tr></table></figure>

<p>说明：server-id的取值范围</p>
<p>1 to 4294967295 (2^32) （mariadb 10.2.2 以上版本）默认值为1</p>
<p>0 to 4294967295 (2^32) （mariadb 10.2.1 以下版本）默认值为0</p>
<p>（3）创建有复制权限的用户账号</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CREATE USER &#39;repluser&#39;@&#39;10.0.0.%&#39; identified by &#39;centos&#39;;</span><br><span class="line"></span><br><span class="line">GRANT REPLICATION SLAVE ON *.* TO &#39;repluser&#39;@&#39;10.0.0.%&#39;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>（4）查看从二进制日志的文件和位置开始进行复制</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SHOW MASTER status;</span><br><span class="line"> binlog.000016 |      725 </span><br></pre></td></tr></table></figure>

<p><strong>从节点配置</strong></p>
<p>（1）启动中继日志</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">server-id &#x3D; NUMBER #为当前节点设置一个全局唯一的ID号</span><br><span class="line">log-bin</span><br><span class="line">read_only &#x3D; ON   #设置数据库只读，针对supper user无效，注意这个意思是从服务器的超级用户是可以更改数据的！！！</span><br><span class="line">relay_log &#x3D; relay-log  #relay log的文件路径，默认值hostname-relay-bin</span><br><span class="line">relay_log_index &#x3D; relay-log.index #默认值hostname-relay-bin.index</span><br></pre></td></tr></table></figure>

<p>（2）登录本机的数据库，并启动复制线程</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1.登录本机的数据库</span><br><span class="line">2.开始设置：</span><br><span class="line">CHANGE MASTER TO MASTER_HOST&#x3D;&#39;192.168.8.8&#39;,</span><br><span class="line">MASTER_USER&#x3D;&#39;repluser&#39;,</span><br><span class="line">MASTER_PASSWORD&#x3D;&#39;centos&#39;,</span><br><span class="line">MASTER_PORT&#x3D;3306,</span><br><span class="line">MASTER_LOG_FILE&#x3D;&#39;mariadb-bin.000002&#39;,</span><br><span class="line">MASTER_LOG_POS&#x3D;545;</span><br><span class="line"></span><br><span class="line">START SLAVE;  #启动复制线程</span><br><span class="line">SHOW SLAVE STATUS;</span><br><span class="line"></span><br><span class="line">change master to  是个命令</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>如果主节点是新建的库，那么就按照这个步骤执行；如果主节点已经运行了，新增从节点，那么就需要做这几件事：</p>
<p>1.给主节点全部备份</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -uroot -pcentos -A -E -R -F --single-transaction --master-data&#x3D;1 --flush-privileges --hex-blob --default-character-set&#x3D;utf8mb4 | gzip &gt; &#x2F;backup&#x2F;test1&#x2F;full.sql.gz </span><br></pre></td></tr></table></figure>

<p>2.查看主节点当前的二进制日志和日志中的位置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">show master status</span><br><span class="line">binlog.xxxx   727</span><br></pre></td></tr></table></figure>

<p>3.从节点导入全部备份，并且设置开始复制的主节点二进制日志和日志中的位置，这样设置的意思就是，之前的内容我从节点都有了，之后的内容就从你现在的位置开始复制</p>
<h4 id="3-主从复制相关设置"><a href="#3-主从复制相关设置" class="headerlink" title="3.主从复制相关设置"></a>3.主从复制相关设置</h4><p>1.解决复制冲突</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">--sql_skip_errors,sql_slave_skip_counter</span><br><span class="line">可以在从服务器忽略几个主服务器的复制事件，或跳过事件的ID</span><br><span class="line">通过 SHOW SLAVE STATUS; 可以看到错误码，然后两种方法跳过：</span><br><span class="line">第一种：</span><br><span class="line">stop slave; #关闭slave线程</span><br><span class="line">set global sql_slave_skip_counter &#x3D; 1;</span><br><span class="line">start slave; #开启slave线程</span><br><span class="line">第二种：</span><br><span class="line">systemctl stop mysqld</span><br><span class="line">vim &#x2F;etc&#x2F;my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">slave_skip_errors&#x3D;ERROR_CODE | ALL  #这里填写错误码</span><br><span class="line">systemctl start mysqld</span><br></pre></td></tr></table></figure>

<p>2.保证主从复制的事务安全</p>
<p>在master节点启用参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sync_binlog&#x3D;1;#每次写后都把二进制日志同步到磁盘，性能差</span><br><span class="line">#Innodb存储引擎的设置</span><br><span class="line">innodb_flush_log_at_trx_commit&#x3D;1 #每次事务提交立即同步日志写磁盘</span><br><span class="line">innodb_support_xa&#x3D;on  #分布式mariadb10.3.0废除</span><br><span class="line">sync_master_info&#x3D;NUMBER #number次事件后，master.info同步到磁盘</span><br></pre></td></tr></table></figure>

<p>在slave节点启用服务器选项：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">skip-slave-start&#x3D;ON</span><br></pre></td></tr></table></figure>

<p>在slave节点启用参数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sync_relay_log&#x3D;NUMBER #number次后同步relay_log到磁盘</span><br><span class="line">sync_relay_log_info&#x3D;NUMBER #number次事务后同步relay-log.info到磁盘</span><br></pre></td></tr></table></figure>

<p>范例：当一个主服务器宕机，临时提升一个从服务器成为新的主服务器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">步骤：</span><br><span class="line">1.查看哪个从节点的数据是最新的，让它成为新的主服务器</span><br><span class="line">cat &#x2F;var&#x2F;lib&#x2F;mysql&#x2F;relay-log.info或者在数据库中执行show slave status\G 查看POS值</span><br><span class="line">2.新的主服务器修改配置文件，关闭read-only配置，清除旧主服务器的复制信息</span><br><span class="line">stop slave;</span><br><span class="line">reset slave all;</span><br><span class="line">flush privileges;#这个命令不输入，会导致其他从服务器无法连接到新主服务器</span><br><span class="line">3.在新主服务器上全量备份</span><br><span class="line">4.分析旧的主服务器的二进制日志，把没有同步给新主服务器的内容导出来，还原到新主服务器，尽可能恢复数据</span><br><span class="line">5.其他所有从服务器重新还原数据库，指向新的主服务器</span><br></pre></td></tr></table></figure>

<h4 id="4-实现级联复制"><a href="#4-实现级联复制" class="headerlink" title="4.实现级联复制"></a>4.实现级联复制</h4><p>三台服务器：</p>
<p>master</p>
<p>级联</p>
<p>slave</p>
<p>就是级联服务器上配置了一项，然后最下级服务器的主服务器指向级联服务器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">log_slave_updates   #这个选项开启后级联服务器也可以修改二进制日志</span><br></pre></td></tr></table></figure>

<p>slave服务器的主服务器指向了级联服务器</p>
<h4 id="5-主主复制"><a href="#5-主主复制" class="headerlink" title="5.主主复制"></a>5.主主复制</h4><p>两个节点都可以更新数据，并且互为主从，容易差生数据不一致的问题，要慎用</p>
<p>可以通过这个设置避免出现插入同样的数据；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">auto_increment_offset&#x3D;1  #这个是起始的数字</span><br><span class="line">auto_increment_increment&#x3D;2 #这个是增长量</span><br><span class="line">#两台服务器配置不同的起始数字，相同的增长量，这样可以变成奇偶，不冲突</span><br></pre></td></tr></table></figure>



<h4 id="6-半同步复制"><a href="#6-半同步复制" class="headerlink" title="6.半同步复制"></a>6.半同步复制</h4><p>官方文档：<a target="_blank" rel="noopener" href="https://mariadb.com/kb/en/semisynchronous-replication/#enabling-semisynchronous-replication">https://mariadb.com/kb/en/semisynchronous-replication/#enabling-semisynchronous-replication</a></p>
<p>默认情况下，MySQL的复制功能是异步的，异步复制可以提供最好的性能，主库把binary log发送给从库即结束，并不验证从库是否接收完毕。这意味着当主服务器或从服务器端发生故障时，有可能从服务器没有接收到主服务器发送过来的binlog日志，这就会导致主服务和从服务器数据不一致。</p>
<p>半同步会有确认的过程，这个是通过一个插件实现的  Plugin: rpl_semi_sync_master</p>
<p>半同步复制的意思是，一主多从的情况下，当主服务器的数据发生变化后，主服务要先把数据同步给至少一台从服务器（只要有一台从服务器返回给主服务器同步成功的信号）或者同步时间超过预设的等待时间后，然后才会返回客户端，表示数据修改成功。</p>
<p>这个插件有两个部分，master和slave，通过INSTALL SONAME的方式安装以及在配置文件中写上插件选项及名称</p>
<p>mariadb10.3.3之前版本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">1.安装插件</span><br><span class="line">#通过命令行安装插件</span><br><span class="line">#主服务配置</span><br><span class="line">INSTALL SONAME &#39;semisync_master&#39;;</span><br><span class="line"></span><br><span class="line">#从服务器配置</span><br><span class="line">INSTALL SONAME &#39;semisync_slave&#39;</span><br><span class="line"></span><br><span class="line">#服务器配置添加插件</span><br><span class="line">#主服务器配置</span><br><span class="line">[mariadb]</span><br><span class="line">...</span><br><span class="line">plugin_load_add &#x3D; semisync_master</span><br><span class="line"></span><br><span class="line">#从服务器配置</span><br><span class="line">[mariadb]</span><br><span class="line">...</span><br><span class="line">plugin_load_add &#x3D; semisync_slave</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2.开启变量</span><br><span class="line">rpl_semi_sync_master_enabled&#x3D;1</span><br><span class="line">rpl_semi_sync_master_timeout&#x3D;3000 #超时时间，这个3秒</span><br></pre></td></tr></table></figure>

<p>但是在mariadb 10.3.3开始这个插件就内置在数据库了，不需要去安装插件</p>
<p>在主从服务器上都打开这个选项</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#这两个都是既是服务器选项又是全局变量</span><br><span class="line">#主服务配置</span><br><span class="line">rpl_semi_sync_mastere_enabled &#x3D; ON</span><br><span class="line">rpl_semi_sync_master_timeout&#x3D;3000 #最大等待时间，这个代表3s</span><br><span class="line">#从服务器配置</span><br><span class="line">rpl_semi_sync_slave_enabled &#x3D; ON</span><br></pre></td></tr></table></figure>

<p>mysql 5.6,5.7,8.0开启半同步复制的方法：SONAME就是 .so文件的名称</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">服务器选项：</span><br><span class="line">plugin-load-add&#x3D;semisync_master.so</span><br><span class="line">rpl_semi_sync_master_enabled&#x3D;on</span><br><span class="line">rpl_semi_sync_master_timeout&#x3D;3000;</span><br><span class="line"></span><br><span class="line">1.安装插件</span><br><span class="line">#安装主服务器的插件</span><br><span class="line">INSTALL PLUGIN rpl_semi_snyc_master SONAME &#39;semisync_master.so&#39;</span><br><span class="line">#安装从服务器的插件</span><br><span class="line">INSTALL PLUGIN rpl_semi_snyc_slave SONAME &#39;semisync_slave.so&#39;</span><br><span class="line">2.开启半同步变量</span><br><span class="line">#主服务器配置</span><br><span class="line">SET GLOBAL rpl_semi_sync_master_enabled&#x3D;1;</span><br><span class="line">SET GLOBAL rpl_semi_sync_master_timeout&#x3D;N;#这里的单位是毫秒，如果要设置成3秒，就写3000</span><br><span class="line">#从服务器配置</span><br><span class="line">SET GLOBAL rpl_semi_sync_slave_enabled&#x3D;1;</span><br><span class="line"></span><br><span class="line">#或者通过服务器配置，这几个变量都是服务器选项</span><br></pre></td></tr></table></figure>



<h4 id="7-复制过滤器"><a href="#7-复制过滤器" class="headerlink" title="7.复制过滤器"></a>7.复制过滤器</h4><p>让从节点仅复制指定的数据库，或指定数据库的指定表</p>
<p>复制过滤器的两种实现方式：类似黑名单，一个是二进制日志黑名单，一个是中继日志黑名单</p>
<p>（1）服务器选项：主服务仅向二进制日志中记录与特定数据库相关的事件</p>
<p>也有优点：仅需要在主服务器上配置一次，从服务器都会生效；</p>
<p>缺点：主服务器仅把白名单中的数据库备份到二进制日志，其他数据库不记录，会造成数据风险；</p>
<p>不建议使用</p>
<p>（2）从服务器SQL_THREAD在读取relay log中的事件时，仅读取与特定数据库（表）相关的事件并应用于本地</p>
<p>会造成网络和磁盘I/O浪费</p>
<p>选项中配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">replication_do_db&#x3D;db1</span><br><span class="line">replication_do_db&#x3D;db2</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>命令行中设置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">replication_do_db&#x3D;&quot;db1,db2,db3&quot;</span><br></pre></td></tr></table></figure>



<h4 id="8-复制主从加密"><a href="#8-复制主从加密" class="headerlink" title="8.复制主从加密"></a>8.复制主从加密</h4><p>因为mysql的主从复制默认是不加密的，通信中的数据都是明文，很危险</p>
<p>通过SSL/TLS加密 transport layer security protocol，ssl是不安全的了，只是大家都这么叫这个协议，所以还留着他的名字</p>
<p>官方文档：<a target="_blank" rel="noopener" href="https://mariadb.com/kb/en/library/replication-with-secure-connections/">https://mariadb.com/kb/en/library/replication-with-secure-connections/</a></p>
<p>需要CA Certificate Authority x509 非对称密钥对 openssl</p>
<p>需要开启ssl，需要生成一个必须经过ssl认证的账户</p>
<p>1.生成CA</p>
<p>2.生成私钥</p>
<p>3.生成证书</p>
<p>4.一共需要：CA证书、私钥、主服务器私钥、证书、从服务器私钥、证书六样东西</p>
<p>5.具体步骤不写了。</p>
<h4 id="9-GTID"><a href="#9-GTID" class="headerlink" title="9.GTID"></a>9.GTID</h4><p>Global Transaction Identity 全局事务标识符</p>
<p>mysql5.6之后支持，GTID不像传统的复制方式（异步复制、半同步复制）需要找到binlog文件名和position，它只需要知道master的IP、端口、账户、密码即可。开启GTID后，执行</p>
<p>change master to master_auto_position=1即可，它会自动寻找到相应的位置开始同步</p>
<p>配置：</p>
<p>主服务器配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">gtid_mode&#x3D;on</span><br><span class="line">enforce_gtid_consistency&#x3D;on</span><br></pre></td></tr></table></figure>

<p>从服务器配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">gtid_mode&#x3D;on</span><br><span class="line">enforce_gtid_consistency&#x3D;on</span><br><span class="line"></span><br><span class="line">;</span><br><span class="line"></span><br><span class="line">重启mysql服务后在命令输入：</span><br><span class="line">mysql&gt; change master to master_host&#x3D;&#39;10.0.0.7&#39;,</span><br><span class="line">    -&gt; master_user&#x3D;&#39;repluser&#39;,</span><br><span class="line">    -&gt; master_password&#x3D;&#39;centos&#39;,</span><br><span class="line">    -&gt; master_port&#x3D;3306,</span><br><span class="line">    -&gt; master_auto_position&#x3D;1;</span><br></pre></td></tr></table></figure>



<h4 id="10-复制的监控和维护"><a href="#10-复制的监控和维护" class="headerlink" title="10.复制的监控和维护"></a>10.复制的监控和维护</h4><p>1.清理日志</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PURGE &#123;BINARY|MASTER&#125; LOGS &#123; TO &#39;log_name&#39; | before datetime_expr&#125;</span><br><span class="line"></span><br><span class="line">RESET  SLAVE ALL;</span><br><span class="line"></span><br><span class="line">RESET MASTER TO N;#mysql不支持</span><br></pre></td></tr></table></figure>

<p>2.状态监控</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SHOW MASTER STATUS;</span><br><span class="line">SHOW MASTER LOGS;</span><br><span class="line"></span><br><span class="line">SHOW SLAVE STATUS;</span><br><span class="line">SHOW PROCESSLIST;</span><br><span class="line"></span><br><span class="line">SHOW BINLOG EVENTS;</span><br></pre></td></tr></table></figure>

<p>3.判断从服务器是否落后于主服务器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SHOW SLAVE STATUS;</span><br><span class="line">然后查看这个字段</span><br><span class="line">Seconds_Behind_Master;0 #0就是不落后，非0就是落后</span><br></pre></td></tr></table></figure>



<h4 id="11-复制的问题和解决方案"><a href="#11-复制的问题和解决方案" class="headerlink" title="11.复制的问题和解决方案"></a>11.复制的问题和解决方案</h4><p>1.造成不一致的原因：</p>
<ul>
<li>主数据库binlog格式为Statement，同步到从库后可能造成主从不一致</li>
<li>主数据库更改前执行set sql_log_bin=0，会使主库不记录binlog，从库也无法变更这部分数据</li>
<li>从节点未设置只读，误操作写入数据</li>
<li>主库或从库以外宕机，可能会造成binlog或者relaylog文件出现损坏，导致主从不一致</li>
<li>主从实例版本不一致，特别是高版本是主，低版本是从，主数据库上面支持的功能，从数据库上面可能不支持该功能</li>
<li>mysql自身bug导致</li>
</ul>
<p>2.不一致的修复方法</p>
<ul>
<li>手动重建</li>
<li>使用perconna-toolkit工具辅助</li>
</ul>
<p>3.如何避免不一致</p>
<ul>
<li>主库binlog采用ROW模式  binlog_format=row</li>
<li>主从实例数据库版本保持一致</li>
<li>主库做好账号权限把控，不可以执行  set sql_log_bin=0</li>
<li>从库开启只读，不允许人为写入</li>
<li>定期进行一致性检验</li>
</ul>
<h3 id="MySQL中间件代理服务器"><a href="#MySQL中间件代理服务器" class="headerlink" title="MySQL中间件代理服务器"></a>MySQL中间件代理服务器</h3><h4 id="1-关系型数据库和非关系型数据库-NO-SQL-数据库"><a href="#1-关系型数据库和非关系型数据库-NO-SQL-数据库" class="headerlink" title="1.关系型数据库和非关系型数据库(NO SQL)数据库"></a>1.关系型数据库和非关系型数据库(NO SQL)数据库</h4><h4 id="2-数据切分"><a href="#2-数据切分" class="headerlink" title="2.数据切分"></a>2.数据切分</h4><ul>
<li>垂直切分：把不同的数据表分离开，这些表在业务中应当不使用join</li>
<li>水平切分：按照行进行切分，比如前1000行放入一个服务器，后1000行放入另一个服务器，以此降低单个服务器的负载</li>
</ul>
<p>需要使用分片管理服务器，也就是中间件。</p>
<h4 id="3-MySQL中间件各种应用"><a href="#3-MySQL中间件各种应用" class="headerlink" title="3.MySQL中间件各种应用"></a>3.MySQL中间件各种应用</h4><p>常用的两个中间件</p>
<ul>
<li>Mycat：国人二次开发，国内使用较多</li>
<li>proxySQL：外国软件</li>
</ul>
<h4 id="4-Mycat"><a href="#4-Mycat" class="headerlink" title="4.Mycat"></a>4.Mycat</h4><h5 id="Mycat的工作原理："><a href="#Mycat的工作原理：" class="headerlink" title="Mycat的工作原理："></a>Mycat的工作原理：</h5><p>​    搞清楚Mycat和mysql的区别。我们把上层看作是对下层的抽象，例如操作系统是对各类计算机硬件的抽象。那么我们什么时候需要抽象？假如只有一种硬件的时候，我们需要开发一个操作系统吗？再比如一个项目只需要一个人完成的时候需要leader吗？但是当一个项目十几个人的时候，就应该有一个管理者，发挥沟通协调作用，而这个管理者就是我们用户对于这个项目组所有人的抽象。</p>
<p>同样的，当我们的应用只需要一台数据库服务器的时候我们不需要中间件Mycat，而如果你需要分库甚至分表，应用要面对很多个数据库时，就需要对数据库进行一个抽象，来管理这些数据库，而最上面的应用只需要面对一个数据库的抽象或者说数据库中间件就好了，这就是Mycat的核心作用。</p>
<p>所以可以这样理解：数据库是对底层存储数据文件的抽象，而Mycat是对数据库的抽象。</p>
<h5 id="实验：通过Mycat中间件和mysql-5-7-30版本数据库实现读写分离"><a href="#实验：通过Mycat中间件和mysql-5-7-30版本数据库实现读写分离" class="headerlink" title="实验：通过Mycat中间件和mysql 5.7.30版本数据库实现读写分离"></a>实验：通过Mycat中间件和mysql 5.7.30版本数据库实现读写分离</h5><p>一共三台主机，一台mycat管理机，一台主服务器，一台从服务器，主从复制是用GTID实现的</p>
<p>1.在Mycat管理机上安装Java环境，记得要把内存调整大一些，比如2GB</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install java -y</span><br><span class="line">java -version</span><br><span class="line">1.8</span><br></pre></td></tr></table></figure>

<p>2.安装Mycat，去官网下载，版本我下的是1.6.7.5</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;usr&#x2F;local&#x2F;src&#x2F;</span><br><span class="line">wget http:&#x2F;&#x2F;dl.mycat.org.cn&#x2F;1.6.7.5&#x2F;2020-4-10&#x2F;Mycat-server-1.6.7.5-release-20200410174409-linux.tar.gz</span><br><span class="line">mkdir &#x2F;app</span><br><span class="line">tar xvf Mycat-server-1.6.7.5-release-20200410174409-linux.tar.gz -C &#x2F;app</span><br><span class="line">cd &#x2F;app&#x2F;mycat</span><br><span class="line">[root@localhost mycat]$ls</span><br><span class="line">bin  catlet  conf  lib  logs  version.txt</span><br><span class="line">➜  mycat vim &#x2F;etc&#x2F;profile.d&#x2F;mycat.sh</span><br><span class="line">PATH&#x3D;&#x2F;app&#x2F;mycat&#x2F;bin&#x2F;:$PATH</span><br><span class="line">➜  mycat source &#x2F;etc&#x2F;profile.d&#x2F;mycat.sh </span><br></pre></td></tr></table></figure>

<p>3.配置两台服务器作为主从复制机器，并且开启通用日志，通用日志是一会为了检测读写分离</p>
<p>这里的配置很简单，主、从服务器都开启gtid和二进制日志</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">log_bin</span><br><span class="line">10 gtid_mode&#x3D;on</span><br><span class="line">11 enforce_gtid_consistency&#x3D;on</span><br><span class="line"></span><br><span class="line">开启通用日志在命令行用变量开启：</span><br><span class="line">set global general_log&#x3D;on;</span><br><span class="line">show variables like &#39;%general_log%&#39;;</span><br></pre></td></tr></table></figure>

<p>几个重要的配置文件</p>
<ul>
<li>server.xml：Mycat软件本身的相关配置</li>
<li>schema.xml：配置物理数据库，包括读写分离、高可用等</li>
<li>rule.xml：分库分表规则</li>
</ul>
<p>4.配置server.xml文件，之后在安装了Mycat的服务器上就可以使用这个账号密码登录了，登录方式是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -pcentos -h 127.0.0.1 -P 8066</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">106     &lt;user name&#x3D;&quot;root&quot; defaultAccount&#x3D;&quot;true&quot;&gt;                                            </span><br><span class="line">107         &lt;property name&#x3D;&quot;password&quot;&gt;centos&lt;&#x2F;property&gt;#这里是登录mycat的密码，可以修改</span><br><span class="line">108         &lt;property name&#x3D;&quot;schemas&quot;&gt;t1,t2,t3&lt;&#x2F;property&gt;#这里是允许用户使用的数据库，名称和数量都是自己设置的，注意这里的数据库名称需要跟schema.xml中的数据库名称对应上</span><br><span class="line">109         &lt;property name&#x3D;&quot;defaultSchema&quot;&gt;t1&lt;&#x2F;property&gt;#默认数据库名</span><br><span class="line"></span><br><span class="line">123     &lt;user name&#x3D;&quot;user&quot;&gt;</span><br><span class="line">124         &lt;property name&#x3D;&quot;password&quot;&gt;user&lt;&#x2F;property&gt;</span><br><span class="line">125         &lt;property name&#x3D;&quot;schemas&quot;&gt;t1&lt;&#x2F;property&gt;#这里也要改</span><br><span class="line">126         &lt;property name&#x3D;&quot;readOnly&quot;&gt;true&lt;&#x2F;property&gt;</span><br><span class="line">127         &lt;property name&#x3D;&quot;defaultSchema&quot;&gt;t1&lt;&#x2F;property&gt;#这里也要改</span><br><span class="line">128     &lt;&#x2F;user&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>5.配置schema.xml文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">  1 &lt;!DOCTYPE mycat:schema SYSTEM &quot;schema.dtd&quot;&gt;                                      </span><br><span class="line">  2 &lt;mycat:schema xmlns:mycat&#x3D;&quot;http:&#x2F;&#x2F;io.mycat&#x2F;&quot;&gt;</span><br><span class="line">  3 &lt;schema name&#x3D;&quot;t1&quot; checkSQLschema&#x3D;&quot;false&quot; sqlMaxLimit&#x3D;&quot;100&quot; dataNode&#x3D;&quot;dn1&quot;&gt;&lt;&#x2F;schema&gt; </span><br><span class="line">  4 &lt;schema name&#x3D;&quot;t2&quot; checkSQLschema&#x3D;&quot;false&quot; sqlMaxLimit&#x3D;&quot;100&quot; dataNode&#x3D;&quot;dn2&quot;&gt;&lt;&#x2F;schema&gt;</span><br><span class="line">  5 &lt;schema name&#x3D;&quot;t3&quot; checkSQLschema&#x3D;&quot;false&quot; sqlMaxLimit&#x3D;&quot;100&quot; dataNode&#x3D;&quot;dn3&quot;&gt;&lt;&#x2F;schema&gt;</span><br><span class="line">  ##schema的名称这里是什么，server.xml中也得写成什么，这个代表逻辑数据库，提供给用户使用，逻辑数据库会跟实际数据库中的数据库对应，通过dataNode标签，建立关系。</span><br><span class="line">  6 &lt;dataNode name&#x3D;&quot;dn1&quot; dataHost&#x3D;&quot;localhost1&quot; database&#x3D;&quot;hellodb&quot; &#x2F;&gt;</span><br><span class="line">  7 &lt;dataNode name&#x3D;&quot;dn2&quot; dataHost&#x3D;&quot;localhost1&quot; database&#x3D;&quot;mysql&quot; &#x2F;&gt;</span><br><span class="line">  8 &lt;dataNode name&#x3D;&quot;dn3&quot; dataHost&#x3D;&quot;localhost1&quot; database&#x3D;&quot;db1&quot; &#x2F;&gt;</span><br><span class="line">  ##datahost标签中，定义了具体的数据库实例、读写分离配置和心跳语句。</span><br><span class="line">  #dbDriver分两个：native和jdbc</span><br><span class="line">  9 &lt;dataHost name&#x3D;&quot;localhost1&quot; maxCon&#x3D;&quot;1000&quot; minCon&#x3D;&quot;10&quot; balance&#x3D;&quot;1&quot; writeType&#x3D;&quot;0&quot; dbType&#x3D;&quot;    mysql&quot; dbDriver&#x3D;&quot;jdbc&quot; switchType&#x3D;&quot;1&quot;  slaveThreshold&#x3D;&quot;100&quot;&gt;</span><br><span class="line"> 10 &lt;heartbeat&gt;select user()&lt;&#x2F;heartbeat&gt;</span><br><span class="line"> 11 &lt;writeHost host&#x3D;&quot;hostM1&quot; url&#x3D;&quot;jdbc:mysql:&#x2F;&#x2F;10.0.0.101:3306&quot; user&#x3D;&quot;mycat&quot; password&#x3D;&quot;12345    6&quot;&gt;</span><br><span class="line"> 12 &lt;readHost host&#x3D;&quot;hostS2&quot; url&#x3D;&quot;jdbc:mysql:&#x2F;&#x2F;10.0.0.110:3306&quot; user&#x3D;&quot;mycat&quot; password&#x3D;&quot;123456    &quot;&#x2F;&gt;</span><br><span class="line"> 13 &lt;&#x2F;writeHost&gt;</span><br><span class="line"> 14 &lt;&#x2F;dataHost&gt;</span><br><span class="line"> 15 &lt;&#x2F;mycat:schema&gt;</span><br><span class="line"></span><br><span class="line">注意：</span><br><span class="line">&lt;dataHost&gt;这里有一个 dbDriver  字段，我这里默认是jdbc，所以下面的IP地址都要写成：</span><br><span class="line">jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;</span><br><span class="line">注意：</span><br><span class="line">&lt;schema name&#x3D;&quot;TESTDB&quot; checkSQLschema&#x3D;&quot;false&quot; sqlMaxLimit&#x3D;&quot;100&quot; dataNode&#x3D;&quot;dn1&quot;&gt;&lt;&#x2F;schema&gt;</span><br><span class="line">这里有个dataNode字段，我这里默认是RandomDataNode，需要改成dataNode</span><br></pre></td></tr></table></figure>

<p>6.开启mycat</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mycat start</span><br><span class="line">#启动日志是这个：&#x2F;app&#x2F;mycat&#x2F;logs&#x2F;wrapper.log</span><br><span class="line">#运行日志是：&#x2F;app&#x2F;mycat&#x2F;logs&#x2F;mycat.log</span><br></pre></td></tr></table></figure>

<p>7.测试读写分离：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">持续监测主和从服务器的通用日志</span><br><span class="line">tail -f &#x2F;data&#x2F;mysql&#x2F;localhost.log #这个是通用日志</span><br><span class="line">连接到在mycat服务器上操作：</span><br><span class="line">mysql -uroot -pcentos -h127.0.0.1 -P 8066   #这里的用户名和密码都是在server.xml中设置的，必须指定 -h，因为mycat本身不带有sockt文件，-P 是指定连接端口，mycat模拟的数据库端口是8066</span><br><span class="line"></span><br><span class="line">查询数据库，发现mycat会把查询请求发送到从服务器；</span><br><span class="line">写入数据，发现mycat会把写入请求发送到主服务器；</span><br><span class="line">关闭从服务器，发现mycat读和写都会请求到主服务器，再次开启从服务器，发现读请求立刻发送到了从服务器；</span><br><span class="line">有30秒左右的等待时间</span><br><span class="line">关闭主服务器，发现mycat读可以发送到从服务器，但是写操作被拒绝</span><br><span class="line">MySQL [t1]&gt; insert into teachers values (7,&#39;mengzi&#39;,77,&#39;M&#39;);</span><br><span class="line">ERROR: No operations allowed after connection closed.</span><br><span class="line">再次开启主服务，等待30秒左右，写操作执行成功。</span><br></pre></td></tr></table></figure>



<p>操作步骤：</p>
<p>1.创建MySQL主从数据库</p>
<p>2.在MySQL代理服务器上安装mycat并启动</p>
<p>3.在mycat服务器上修改server.xml文件配置Mycat的连接信息</p>
<p>4.修改schema.xml实现读写分离</p>
<p>5.在Master数据库上创建用户并对mycat授权</p>
<p>6.在mycat上连接并测试</p>
<p>7.通过通用日志确认实现读写分离</p>
<p>8.停止从节点，mycat自动调度请求到主节点</p>
<h4 id="5-ProxySQL"><a href="#5-ProxySQL" class="headerlink" title="5.ProxySQL"></a>5.ProxySQL</h4><h3 id="MySQL高可用"><a href="#MySQL高可用" class="headerlink" title="MySQL高可用"></a>MySQL高可用</h3><h4 id="1-常用的MySQL高可用解决方案"><a href="#1-常用的MySQL高可用解决方案" class="headerlink" title="1.常用的MySQL高可用解决方案"></a>1.常用的MySQL高可用解决方案</h4><ul>
<li>MMM</li>
<li>MHA</li>
<li>Glara Cluster</li>
</ul>
<h4 id="2-MHA-Master-High-Availability"><a href="#2-MHA-Master-High-Availability" class="headerlink" title="2.MHA Master High Availability"></a>2.MHA Master High Availability</h4><h5 id="MHA的工作原理："><a href="#MHA的工作原理：" class="headerlink" title="MHA的工作原理："></a>MHA的工作原理：</h5><p>1.从宕机崩溃的master主机保存二进制日志事件（binlog events）</p>
<p>2.识别含有最新更新的slave</p>
<p>3.应用差异的中继日志（relay log）到其他的slave</p>
<p>4.应用从master保存的二进制日志事件</p>
<p>5.提升一个slave为新的master</p>
<p>6.使其他的slave连接新的master进行复制</p>
<p>7.注意，为了尽量减少主库宕机造成的数据丢失，因此在配置MHA的同时建议配置成MySQL的半同步复制</p>
<h5 id="MHA软件"><a href="#MHA软件" class="headerlink" title="MHA软件"></a>MHA软件</h5><p>MHA软件由两部分组成，Manager工具包和Node工具包</p>
<h5 id="实验：使用MHA实现高可用"><a href="#实验：使用MHA实现高可用" class="headerlink" title="实验：使用MHA实现高可用"></a>实验：使用MHA实现高可用</h5><p>一共四台机器，一台是MHA的管理机，一台主服务器，两台从服务器</p>
<p>操作系统都是centos7，数据库使用mysql 5.7.30</p>
<p>MHA使用mha4mysql-manager-0.58-0.el7.centos.noarch.rpm和mha4mysql-node-0.58-0.el7.centos.noarch.rpm</p>
<p>1.在管理节点安装manager包和node包</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yum -y install mha4mysql-node-0.58-0.el7.centos.noarch.rpm </span><br><span class="line">yum -y install mha4mysql-manager-0.58-0.el7.centos.noarch.rpm</span><br><span class="line">注意先装node包，manager包依赖node包</span><br><span class="line">rpm -ql mha4mysql-node-0.58-0.el7.centos.noarch </span><br><span class="line">rpm -ql mha4mysql-manager-0.58-0.el7.centos.noarch</span><br></pre></td></tr></table></figure>

<p>2.在其他三台数据库服务器上安装node包</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install mha4mysql-node-0.58-0.el7.centos.noarch.rpm </span><br></pre></td></tr></table></figure>

<p>3.安装必要的工具，rsync,mailx</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum -y install rsync</span><br><span class="line">yum -y install mailx</span><br></pre></td></tr></table></figure>

<p>4.各个节点之间实现ssh key验证功能</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen</span><br><span class="line">ssh-copy-id 10.0.0.112#MHA管理节点自己的IP</span><br><span class="line">rsync -a &#x2F;root&#x2F;.ssh 10.0.0.101:&#x2F;root&#x2F;</span><br><span class="line">rsync -a &#x2F;root&#x2F;.ssh 10.0.0.7:&#x2F;root&#x2F;</span><br><span class="line">rsync -a &#x2F;root&#x2F;.ssh 10.0.0.110:&#x2F;root&#x2F;</span><br><span class="line">#这个操作的目的就是生成私钥，然后利用ssh-copy-id 把公钥也生成并拷贝给自己，同时，这样也生成了认证文件。这样的话，把这个生成好的.ssh文件夹拷贝给其他主机，那么所有有.ssh这个文件夹的主机之间就都可以实现ssh密钥认证了。</span><br></pre></td></tr></table></figure>

<p>5.实现master主机，基于GTID实现</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">gtid_mode&#x3D;on</span><br><span class="line">enforce_gtid_consistency&#x3D;on</span><br><span class="line">log_bin</span><br><span class="line">server-id&#x3D;xxx</span><br><span class="line">开启半同步复制</span><br><span class="line">plugin-load-add&#x3D;semisync_master.so</span><br><span class="line">rpl_semi_sync_master_enabled&#x3D;on</span><br><span class="line">rpl_semi_sync_master_timeout&#x3D;3000</span><br><span class="line"></span><br><span class="line">新建复制账号和MHA管理账号</span><br><span class="line">CREATE USER &#39;repluser&#39;@&#39;10.0.0.%&#39; identified by &#39;centos&#39;;</span><br><span class="line">CREATE USER &#39;mhauser&#39;@&#39;10.0.0.%&#39; identified by &#39;centos&#39;;</span><br><span class="line"></span><br><span class="line">GRANT replication slave on *.* to &#39;repluser&#39;@&#39;10.0.0.%&#39;</span><br><span class="line">GRANT all on *.* to &#39;mhauser&#39;@&#39;10.0.0.%&#39;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>6.实现slave主机</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">gtid_mode&#x3D;on</span><br><span class="line">enforce_gtid_consistency&#x3D;on</span><br><span class="line">plugin-load-add&#x3D;semisync_slave.so</span><br><span class="line">rpl_semi_sync_slave_enabled&#x3D;on</span><br><span class="line"></span><br><span class="line">change master to master_host&#x3D;&#39;10.0.0.112&#39;,</span><br><span class="line"> master_user&#x3D;&#39;repluser&#39;,</span><br><span class="line"> master_password&#x3D;&#39;centos&#39;,</span><br><span class="line"> master_auto_position;</span><br></pre></td></tr></table></figure>

<p>7.在管理节点建立配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">vim &#x2F;etc&#x2F;mastermha&#x2F;app1.cnf</span><br><span class="line">  1 [server default]</span><br><span class="line">  2 user&#x3D;mhauser</span><br><span class="line">  3 password&#x3D;centos</span><br><span class="line">  4 manager_workdir&#x3D;&#x2F;data&#x2F;mastermha&#x2F;app1&#x2F;</span><br><span class="line">  5 manager_log&#x3D;&#x2F;data&#x2F;mastermha&#x2F;app1&#x2F;manager.log</span><br><span class="line">  6 remote_workdir&#x3D;&#x2F;data&#x2F;mastermha&#x2F;app1&#x2F;</span><br><span class="line">  7 ssh_user&#x3D;root</span><br><span class="line">  8 repl_user&#x3D;repluser</span><br><span class="line">  9 repl_password&#x3D;centos</span><br><span class="line"> 10 ping_interval&#x3D;1</span><br><span class="line"> 11 master_ip_failover_script&#x3D;&#x2F;usr&#x2F;local&#x2F;bin&#x2F;master_ip_failover</span><br><span class="line"> 12 report_script&#x3D;&#x2F;usr&#x2F;local&#x2F;bin&#x2F;sendmail.sh</span><br><span class="line"> 13 check_repl_delay&#x3D;0</span><br><span class="line"> 14 master_binlog_dir&#x3D;&#x2F;data&#x2F;mysql&#x2F;</span><br><span class="line"> 15 </span><br><span class="line"> 16 [server1]</span><br><span class="line"> 17 hostname&#x3D;10.0.0.101</span><br><span class="line"> 18 candidate_master&#x3D;1</span><br><span class="line"> 19 </span><br><span class="line"> 20 [server2]</span><br><span class="line"> 21 hostname&#x3D;10.0.0.7                                                              </span><br><span class="line"> 22 candidate_master&#x3D;1</span><br><span class="line"> 23 </span><br><span class="line"> 24 [server3]</span><br><span class="line"> 25 hostname&#x3D;10.0.0.110</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Perl脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">这个脚本要放到&#x2F;usr&#x2F;local&#x2F;bin&#x2F;</span><br><span class="line">➜  bin cat master_ip_failover </span><br><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env perl</span><br><span class="line">use strict;</span><br><span class="line">use warnings FATAL &#x3D;&gt; &#39;all&#39;;</span><br><span class="line">use Getopt::Long;</span><br><span class="line">my (</span><br><span class="line">$command, $ssh_user, $orig_master_host, $orig_master_ip,</span><br><span class="line">$orig_master_port, $new_master_host, $new_master_ip, $new_master_port</span><br><span class="line">);</span><br><span class="line">my $vip &#x3D; &#39;10.0.0.100&#39;;#设置Virtual IP</span><br><span class="line">my $gateway &#x3D; &#39;10.0.0.254&#39;;#网关Gateway IP</span><br><span class="line">my $interface &#x3D; &#39;eth0&#39;;</span><br><span class="line">my $key &#x3D; &quot;1&quot;;</span><br><span class="line">my $ssh_start_vip &#x3D; &quot;&#x2F;sbin&#x2F;ifconfig $interface:$key $vip;&#x2F;sbin&#x2F;arping -I $interface -c 3 -s $vip $gateway &gt;&#x2F;dev&#x2F;null 2&gt;&amp;1&quot;;</span><br><span class="line">my $ssh_stop_vip &#x3D; &quot;&#x2F;sbin&#x2F;ifconfig $interface:$key down&quot;;</span><br><span class="line">GetOptions(</span><br><span class="line">&#39;command&#x3D;s&#39; &#x3D;&gt; \$command,</span><br><span class="line">&#39;ssh_user&#x3D;s&#39; &#x3D;&gt; \$ssh_user,</span><br><span class="line">&#39;orig_master_host&#x3D;s&#39; &#x3D;&gt; \$orig_master_host,</span><br><span class="line">&#39;orig_master_ip&#x3D;s&#39; &#x3D;&gt; \$orig_master_ip,</span><br><span class="line">&#39;orig_master_port&#x3D;i&#39; &#x3D;&gt; \$orig_master_port,</span><br><span class="line">&#39;new_master_host&#x3D;s&#39; &#x3D;&gt; \$new_master_host,</span><br><span class="line">&#39;new_master_ip&#x3D;s&#39; &#x3D;&gt; \$new_master_ip,</span><br><span class="line">&#39;new_master_port&#x3D;i&#39; &#x3D;&gt; \$new_master_port,</span><br><span class="line">);</span><br><span class="line">exit &amp;main();</span><br><span class="line">sub main &#123;</span><br><span class="line">print &quot;\n\nIN SCRIPT TEST&#x3D;&#x3D;&#x3D;&#x3D;$ssh_stop_vip&#x3D;&#x3D;$ssh_start_vip&#x3D;&#x3D;&#x3D;\n\n&quot;;</span><br><span class="line">if ( $command eq &quot;stop&quot; || $command eq &quot;stopssh&quot; ) &#123;</span><br><span class="line"># $orig_master_host, $orig_master_ip, $orig_master_port are passed.</span><br><span class="line"># If you manage master ip address at global catalog database,</span><br><span class="line"># invalidate orig_master_ip here.</span><br><span class="line">my $exit_code &#x3D; 1;</span><br><span class="line">eval &#123;</span><br><span class="line">print &quot;Disabling the VIP on old master: $orig_master_host \n&quot;;</span><br><span class="line">&amp;stop_vip();</span><br><span class="line">$exit_code &#x3D; 0;</span><br><span class="line">&#125;;</span><br><span class="line">if ($@) &#123;</span><br><span class="line">warn &quot;Got Error: $@\n&quot;;</span><br><span class="line">exit $exit_code;</span><br><span class="line">&#125;</span><br><span class="line">exit $exit_code;</span><br><span class="line">&#125;</span><br><span class="line">elsif ( $command eq &quot;start&quot; ) &#123;</span><br><span class="line"># all arguments are passed.</span><br><span class="line"># If you manage master ip address at global catalog database,</span><br><span class="line"># activate new_master_ip here.</span><br><span class="line"># You can also grant write access (create user, set read_only&#x3D;0, etc) here.</span><br><span class="line">my $exit_code &#x3D; 10;</span><br><span class="line">eval &#123;</span><br><span class="line">print &quot;Enabling the VIP - $vip on the new master - $new_master_host \n&quot;;</span><br><span class="line">&amp;start_vip();</span><br><span class="line">$exit_code &#x3D; 0;</span><br><span class="line">&#125;;</span><br><span class="line">if ($@) &#123;</span><br><span class="line">warn $@;</span><br><span class="line">exit $exit_code;</span><br><span class="line">&#125;</span><br><span class="line">exit $exit_code;</span><br><span class="line">&#125;</span><br><span class="line">elsif ( $command eq &quot;status&quot; ) &#123;</span><br><span class="line">print &quot;Checking the Status of the script.. OK \n&quot;;</span><br><span class="line">&#96;ssh $ssh_user\@$orig_master_host \&quot; $ssh_start_vip \&quot;&#96;;</span><br><span class="line">exit 0;</span><br><span class="line">&#125;</span><br><span class="line">else &#123;</span><br><span class="line">&amp;usage();</span><br><span class="line">exit 1;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"># A simple system call that enable the VIP on the new master</span><br><span class="line">sub start_vip() &#123;</span><br><span class="line">&#96;ssh $ssh_user\@$new_master_host \&quot; $ssh_start_vip \&quot;&#96;;</span><br><span class="line">&#125;</span><br><span class="line"># A simple system call that disable the VIP on the old_master</span><br><span class="line">sub stop_vip() &#123;</span><br><span class="line">&#96;ssh $ssh_user\@$orig_master_host \&quot; $ssh_stop_vip \&quot;&#96;;</span><br><span class="line">&#125;</span><br><span class="line">sub usage &#123;</span><br><span class="line">print</span><br><span class="line">&quot;Usage: master_ip_failover --command&#x3D;start|stop|stopssh|status --orig_master_host&#x3D;host --orig_master_ip&#x3D;ip --orig_master_port&#x3D;port --new_master_host&#x3D;host --new_master_ip&#x3D;ip --new_master_port&#x3D;port\n&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>发送邮件的脚本：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#这个脚本要放到&#x2F;usr&#x2F;local&#x2F;bin&#x2F;下</span><br><span class="line">echo &quot;MySQL is down&quot; | mail -s &quot;MHA Warning&quot; 734709865@qq.com</span><br></pre></td></tr></table></figure>

<p>8.MHA环境检查</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">➜  src &#x2F;usr&#x2F;bin&#x2F;masterha_check_ssh --conf&#x3D;&#x2F;etc&#x2F;mastermha&#x2F;app1.cnf</span><br><span class="line">➜  src &#x2F;usr&#x2F;bin&#x2F;masterha_check_repl --conf&#x3D;&#x2F;etc&#x2F;mastermha&#x2F;app1.cnf</span><br><span class="line">#根据提示修改不符合要求的设置</span><br><span class="line">➜  src &#x2F;usr&#x2F;bin&#x2F;masterha_check_status --conf&#x3D;&#x2F;etc&#x2F;mastermha&#x2F;app1.cnf</span><br><span class="line">app1 is stopped(2:NOT_RUNNING).</span><br><span class="line">现在还没开MHA，所以这个是正常的</span><br></pre></td></tr></table></figure>

<p>9.启动MHA</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">➜  nohub src &#x2F;usr&#x2F;bin&#x2F;masterha_manager --conf&#x3D;&#x2F;etc&#x2F;mastermha&#x2F;app1.cnf</span><br><span class="line">这个是前台启动的，程序运行时命令行不会变化</span><br><span class="line">另外开一个窗口观察当前MHA状态</span><br><span class="line">➜  ~ &#x2F;usr&#x2F;bin&#x2F;masterha_check_status --conf&#x3D;&#x2F;etc&#x2F;mastermha&#x2F;app1.cnf </span><br><span class="line">app1 (pid:5767) is running(0:PING_OK), master:10.0.0.101</span><br><span class="line">启动成功</span><br></pre></td></tr></table></figure>

<p>10.查看日志</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tail -f &#x2F;data&#x2F;mastermha&#x2F;manager.log</span><br></pre></td></tr></table></figure>

<p>11.模拟故障</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#MHA有个特点，当master主机down后，MHA开始工作，提拔一个从服务器为主服务器，之后MHA服务就停止了</span><br><span class="line">当故障发生后，我测试几乎5秒不到就切换好了新主机，MHA发送了邮件，然后停止了服务</span><br></pre></td></tr></table></figure>

<p>12.如果需要再次运行MHA，需要先删除下面的文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">➜  src ls &#x2F;data&#x2F;mastermha&#x2F;app1&#x2F;app1.failover.complete </span><br><span class="line">&#x2F;data&#x2F;mastermha&#x2F;app1&#x2F;app1.failover.complete</span><br><span class="line">➜  src rm -f &#x2F;data&#x2F;mastermha&#x2F;app1&#x2F;app1.failover.complete </span><br><span class="line">➜  src nohup &#x2F;usr&#x2F;bin&#x2F;masterha_manager --conf&#x3D;&#x2F;etc&#x2F;mastermha&#x2F;app1.cnf</span><br><span class="line">➜  bin tail -f &#x2F;data&#x2F;mastermha&#x2F;app1&#x2F;manager.log </span><br><span class="line"></span><br><span class="line">IN SCRIPT TEST&#x3D;&#x3D;&#x3D;&#x3D;&#x2F;sbin&#x2F;ifconfig eth0:1 down&#x3D;&#x3D;&#x2F;sbin&#x2F;ifconfig eth0:1 10.0.0.100;&#x2F;sbin&#x2F;arping -I eth0 -c 3 -s 10.0.0.100 10.0.0.254 &gt;&#x2F;dev&#x2F;null 2&gt;&amp;1&#x3D;&#x3D;&#x3D;</span><br><span class="line"></span><br><span class="line">Checking the Status of the script.. OK </span><br><span class="line">Thu Oct 15 20:07:02 2020 - [info]  OK.</span><br><span class="line">Thu Oct 15 20:07:02 2020 - [warning] shutdown_script is not defined.</span><br><span class="line">Thu Oct 15 20:07:02 2020 - [info] Set master ping interval 1 seconds.</span><br><span class="line">Thu Oct 15 20:07:02 2020 - [warning] secondary_check_script is not defined. It is highly recommended setting it to check master reachability from two or more routes.</span><br><span class="line">Thu Oct 15 20:07:02 2020 - [info] Starting ping health check on 10.0.0.7(10.0.0.7:3306)..</span><br><span class="line">Thu Oct 15 20:07:02 2020 - [info] Ping(SELECT) succeeded, waiting until MySQL doesn&#39;t respond..</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>1.在管理节点上安装两个包：manager包和node包</p>
<p>2.在所有mysql服务器上安装node包</p>
<p>3.在管理节点和所有从节点之间实现ssh key 验证</p>
<p>4.在管理节点建立配置文件</p>
<p>5.实现Master</p>
<p>6.实现Slave</p>
<p>7.检查MHA的环境</p>
<p>8.启动MHA</p>
<p>9.查看日志</p>
<p>10.故障检测</p>
<h4 id="3-Galera-Cluster"><a href="#3-Galera-Cluster" class="headerlink" title="3.Galera Cluster"></a>3.Galera Cluster</h4><p>多主的集群，通过全局校验的方式保证多个主服务器之间数据不冲突，同时多个主服务器的集群也解决了单个主服务器的单点失败问题。</p>
<p>节点最少3个，最多8个</p>
<p>限制最少节点是为了避免脑裂，最好使用奇数个数的节点。脑裂指的是双方数据不一致，而且双方服务器数量一致，无法判断应该听从谁的。</p>
<ul>
<li>Percona Xtradb Cluster</li>
<li>Mariadb Galera Cluster</li>
</ul>
<p>Galera Cluster好的特点：</p>
<ul>
<li>多主架构：真正的多点读写的集群，在任何时候读写数据，都是最新的</li>
<li>同步复制：集群不同节点之间数据同步，没有延迟，在数据库挂掉之后，数据不会丢失</li>
<li>并发复制：从节点APPLY数据时，支持并行执行，更好的性能</li>
<li>故障切换：在出现数据库故障时，因支持多点写入，切换容易</li>
<li>热拔插：在服务期间，如果数据库挂了，只要监控程序发现的够快，不可服务时间就会非常少。在节点故障期间，节点本身对集群的影响非常小。</li>
<li>自动节点克隆：在新增节点，或者停机维护时，增量数据或者基础数据不需要人工手动备份提供，Galera Cluster会自动拉取在线节点数据，最终集群会变成一致</li>
<li>对应用透明：集群的维护，对应用程序是透明的</li>
</ul>
<p>Galera Cluster缺点：</p>
<ul>
<li>由于DDL需要全局验证通过，则集群性能有集群中最差的服务器决定（一般集群节点配置都是一样的）</li>
<li>新节点加入或延后较大的节点重新加入需要全量拷贝数据（SST State Snapshot Transfer），作为doner（贡献者：同步数据时提供数据的服务器）的节点在同步过程中无法提供读写</li>
<li>只支持Innodb存储引擎的表</li>
</ul>
<p>PXC的官方文档：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;www.percona.com&#x2F;doc&#x2F;percona-xtradb-cluster&#x2F;LATEST&#x2F;overview.html</span><br></pre></td></tr></table></figure>

<p>PXC实现步骤：</p>
<p>1.配置PXC的专用yum源</p>
<p>2.在每台节点上都安装PXC</p>
<p>3.在每个节点都修改PXC配置文件 /etc/percona-xtradb-cluster.conf.d/wsrep.conf</p>
<p>​    配置节点IP</p>
<p>​    节点本身的IP</p>
<p>​    集群节点名称</p>
<p>​    认证的账号密码</p>
<p>4.开启PXC，注意第一个节点与其他节点不一样</p>
<p>5.其他节点开启</p>
<h4 id="4-TiDB"><a href="#4-TiDB" class="headerlink" title="4.TiDB"></a>4.TiDB</h4><h2 id="性能优化"><a href="#性能优化" class="headerlink" title="性能优化"></a>性能优化</h2><h3 id="压力测试工具"><a href="#压力测试工具" class="headerlink" title="压力测试工具"></a>压力测试工具</h3><h3 id="生产环境my-cnf配置案例"><a href="#生产环境my-cnf配置案例" class="headerlink" title="生产环境my.cnf配置案例"></a>生产环境my.cnf配置案例</h3><h3 id="MySQL配置最佳实践"><a href="#MySQL配置最佳实践" class="headerlink" title="MySQL配置最佳实践"></a>MySQL配置最佳实践</h3><p>重点：</p>
<p>1.表DML ！！！</p>
<p>2.表DQL 单表和多表 ！！！</p>
<p>3.视图、函数、触发器、存储过程、事件 作为了解</p>
<p>4.用户账号的创建、删除、修改密码  ！</p>
<p>5.用户授权管理  ！</p>
<p>1.存储引擎的区别</p>
<p>2.索引</p>
<p>3.事务</p>
<p>4.备份</p>
<p>5.数据库的主从</p>
<p>1.备份工具的使用：mysqldump,xtrabackup,mariadbbackup</p>
<p>两个问题：</p>
<p>1.如何把多行命令写进去，或者说CHANGE MASTER TO 到底什么要求</p>
<p>2.写进去了为什么还是连接不上级联节点</p>
<p>要做的事情，</p>
<p>重新配置级联节点和从服务器，如果写不进去也先手写进去，先保证写进去了能连接</p>
<p>CHANGE MASTER TO  MASTER_HOST=’source2.example.com’,  MASTER_USER=’replication’,  MASTER_PASSWORD=’<em>password</em>‘,  MASTER_PORT=3306,  MASTER_LOG_FILE=’source2-bin.001’,  MASTER_LOG_POS=4,  MASTER_CONNECT_RETRY=10;</p>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/11/09/hexo%E7%9A%84%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/" rel="prev" title="hexo的环境搭建">
      <i class="fa fa-chevron-left"></i> hexo的环境搭建
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/11/18/NoSQL%E6%95%B0%E6%8D%AE%E5%BA%93Redis/" rel="next" title="Redis">
      Redis <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#MySQL%E6%98%AF%E4%BB%80%E4%B9%88"><span class="nav-number">1.</span> <span class="nav-text">MySQL是什么</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SQL%E8%AF%AD%E8%A8%80"><span class="nav-number">2.</span> <span class="nav-text">SQL语言</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%A8%E6%88%B7%E8%B4%A6%E6%88%B7%E7%AE%A1%E7%90%86"><span class="nav-number">2.1.</span> <span class="nav-text">用户账户管理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%B4%A6%E5%8F%B7%E5%88%9B%E5%BB%BA-CREATE-USER"><span class="nav-number">2.1.1.</span> <span class="nav-text">账号创建 CREATE USER</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%B4%A6%E5%8F%B7%E5%88%A0%E9%99%A4"><span class="nav-number">2.1.2.</span> <span class="nav-text">账号删除</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%B4%A6%E5%8F%B7%E5%AF%86%E7%A0%81%E4%BF%AE%E6%94%B9"><span class="nav-number">2.1.3.</span> <span class="nav-text">账号密码修改</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%B4%A6%E5%8F%B7%E6%8E%88%E6%9D%83"><span class="nav-number">2.1.4.</span> <span class="nav-text">账号授权</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MySQL%E6%9E%B6%E6%9E%84%E5%92%8C%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="nav-number">3.</span> <span class="nav-text">MySQL架构和性能优化</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E"><span class="nav-number">3.1.</span> <span class="nav-text">存储引擎</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MySQL%E4%B8%AD%E7%9A%84%E7%B3%BB%E7%BB%9F%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">3.2.</span> <span class="nav-text">MySQL中的系统数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE%E5%92%8C%E7%8A%B6%E6%80%81"><span class="nav-number">3.3.</span> <span class="nav-text">服务器配置和状态</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%80%89%E9%A1%B9"><span class="nav-number">3.3.1.</span> <span class="nav-text">服务器选项</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%B3%BB%E7%BB%9F%E5%8F%98%E9%87%8F"><span class="nav-number">3.3.2.</span> <span class="nav-text">服务器系统变量</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%8A%B6%E6%80%81%E5%8F%98%E9%87%8F"><span class="nav-number">3.3.3.</span> <span class="nav-text">服务器状态变量</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%8F%98%E9%87%8FSQL-MODE"><span class="nav-number">3.3.4.</span> <span class="nav-text">服务器变量SQL_MODE</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Query-Cache-%E6%9F%A5%E8%AF%A2%E7%BC%93%E5%AD%98"><span class="nav-number">3.4.</span> <span class="nav-text">Query Cache 查询缓存</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B4%A2%E5%BC%95-INDEX"><span class="nav-number">3.5.</span> <span class="nav-text">索引 INDEX</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%B4%A2%E5%BC%95%E4%BB%8B%E7%BB%8D"><span class="nav-number">3.5.1.</span> <span class="nav-text">索引介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%B4%A2%E5%BC%95%E7%BB%93%E6%9E%84"><span class="nav-number">3.5.1.1.</span> <span class="nav-text">索引结构</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%B4%A2%E5%BC%95%E4%BC%98%E5%8C%96"><span class="nav-number">3.5.2.</span> <span class="nav-text">索引优化</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AE%A1%E7%90%86%E7%B4%A2%E5%BC%95"><span class="nav-number">3.5.3.</span> <span class="nav-text">管理索引</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6"><span class="nav-number">3.6.</span> <span class="nav-text">并发控制</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%94%81%E6%9C%BA%E5%88%B6"><span class="nav-number">3.6.1.</span> <span class="nav-text">锁机制</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%98%BE%E5%BC%8F%E4%BD%BF%E7%94%A8%E9%94%81"><span class="nav-number">3.6.2.</span> <span class="nav-text">显式使用锁</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BA%8B%E5%8A%A1"><span class="nav-number">3.6.3.</span> <span class="nav-text">事务</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BA%8B%E5%8A%A1%E7%89%B9%E6%80%A7"><span class="nav-number">3.6.3.1.</span> <span class="nav-text">事务特性</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%AE%A1%E7%90%86%E4%BA%8B%E5%8A%A1"><span class="nav-number">3.6.3.2.</span> <span class="nav-text">管理事务</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB"><span class="nav-number">3.6.3.3.</span> <span class="nav-text">事务隔离级别</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%A5%E5%BF%97%E7%AE%A1%E7%90%86"><span class="nav-number">3.7.</span> <span class="nav-text">日志管理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BA%8B%E5%8A%A1%E6%97%A5%E5%BF%97"><span class="nav-number">3.7.1.</span> <span class="nav-text">事务日志</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%94%99%E8%AF%AF%E6%97%A5%E5%BF%97"><span class="nav-number">3.7.2.</span> <span class="nav-text">错误日志</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%9A%E7%94%A8%E6%97%A5%E5%BF%97"><span class="nav-number">3.7.3.</span> <span class="nav-text">通用日志</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97"><span class="nav-number">3.7.4.</span> <span class="nav-text">慢查询日志</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8profile%E5%B7%A5%E5%85%B7"><span class="nav-number">3.7.5.</span> <span class="nav-text">使用profile工具</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%97%A5%E5%BF%97%EF%BC%88%E5%A4%87%E4%BB%BD%EF%BC%89"><span class="nav-number">3.7.6.</span> <span class="nav-text">二进制日志（备份）</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%97%A5%E5%BF%97%E7%9A%84%E4%BD%9C%E7%94%A8%EF%BC%9A"><span class="nav-number">3.7.6.1.</span> <span class="nav-text">二进制日志的作用：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95%E7%9A%84%E4%B8%89%E7%A7%8D%E6%A8%A1%E5%BC%8F"><span class="nav-number">3.7.6.2.</span> <span class="nav-text">二进制日志记录的三种模式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%A0%BC%E5%BC%8F%E9%85%8D%E7%BD%AE"><span class="nav-number">3.7.6.3.</span> <span class="nav-text">格式配置</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%96%87%E4%BB%B6%E7%9A%84%E6%9E%84%E6%88%90"><span class="nav-number">3.7.6.4.</span> <span class="nav-text">二进制文件的构成</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%97%A5%E5%BF%97%E7%9B%B8%E5%85%B3%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="nav-number">3.7.6.5.</span> <span class="nav-text">二进制日志相关的配置</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#myslqbinlog"><span class="nav-number">3.7.6.6.</span> <span class="nav-text">myslqbinlog</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MySQL%E5%A4%87%E4%BB%BD%E5%92%8C%E6%81%A2%E5%A4%8D"><span class="nav-number">4.</span> <span class="nav-text">MySQL备份和恢复</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E6%A6%82%E8%BF%B0"><span class="nav-number">4.1.</span> <span class="nav-text">备份恢复概述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mysqldump%E5%A4%87%E4%BB%BD%E5%B7%A5%E5%85%B7"><span class="nav-number">4.2.</span> <span class="nav-text">mysqldump备份工具</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#mysqldump-%E8%AF%B4%E6%98%8E"><span class="nav-number">4.2.1.</span> <span class="nav-text">mysqldump 说明</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#mysql%E5%88%86%E5%BA%93%E5%A4%87%E4%BB%BD%E5%AE%9E%E6%88%98"><span class="nav-number">4.2.2.</span> <span class="nav-text">mysql分库备份实战</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#mysqldump-%E5%A4%87%E4%BB%BD%E8%BF%98%E5%8E%9F%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B"><span class="nav-number">4.2.3.</span> <span class="nav-text">mysqldump 备份还原实战案例</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#xtrabackup%E5%A4%87%E4%BB%BD%E5%B7%A5%E5%85%B7"><span class="nav-number">4.3.</span> <span class="nav-text">xtrabackup备份工具</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#xtrabackup%E5%B7%A5%E5%85%B7%E4%BB%8B%E7%BB%8D"><span class="nav-number">4.3.1.</span> <span class="nav-text">xtrabackup工具介绍</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#xtrabackup%E5%AE%89%E8%A3%85"><span class="nav-number">4.3.2.</span> <span class="nav-text">xtrabackup安装</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#xtrabackup%E7%94%A8%E6%B3%95"><span class="nav-number">4.3.3.</span> <span class="nav-text">xtrabackup用法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%A9%E7%94%A8xtrabackup%E5%AE%9E%E7%8E%B0%E5%AE%8C%E5%85%A8%E5%A4%87%E4%BB%BD%E5%8F%8A%E8%BF%98%E5%8E%9F"><span class="nav-number">4.3.4.</span> <span class="nav-text">利用xtrabackup实现完全备份及还原</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%A9%E7%94%A8xtrabackup%E5%AE%9E%E7%8E%B0%E5%AE%8C%E5%85%A8%EF%BC%8C%E5%A2%9E%E9%87%8F%E5%A4%87%E4%BB%BD%E5%8F%8A%E8%BF%98%E5%8E%9F"><span class="nav-number">4.3.5.</span> <span class="nav-text">利用xtrabackup实现完全，增量备份及还原</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#xtrabackup%E5%8D%95%E8%A1%A8%E5%AF%BC%E5%87%BA%E5%92%8C%E5%AF%BC%E5%85%A5"><span class="nav-number">4.3.6.</span> <span class="nav-text">xtrabackup单表导出和导入</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MySQL%E9%9B%86%E7%BE%A4Cluster"><span class="nav-number">5.</span> <span class="nav-text">MySQL集群Cluster</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#MySQL%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6"><span class="nav-number">5.1.</span> <span class="nav-text">MySQL主从复制</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E6%9E%B6%E6%9E%84%E5%92%8C%E5%8E%9F%E7%90%86"><span class="nav-number">5.1.1.</span> <span class="nav-text">1.主从复制架构和原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%AE%9E%E7%8E%B0%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E9%85%8D%E7%BD%AE"><span class="nav-number">5.1.2.</span> <span class="nav-text">2.实现主从复制配置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E7%9B%B8%E5%85%B3%E8%AE%BE%E7%BD%AE"><span class="nav-number">5.1.3.</span> <span class="nav-text">3.主从复制相关设置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-%E5%AE%9E%E7%8E%B0%E7%BA%A7%E8%81%94%E5%A4%8D%E5%88%B6"><span class="nav-number">5.1.4.</span> <span class="nav-text">4.实现级联复制</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-%E4%B8%BB%E4%B8%BB%E5%A4%8D%E5%88%B6"><span class="nav-number">5.1.5.</span> <span class="nav-text">5.主主复制</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-%E5%8D%8A%E5%90%8C%E6%AD%A5%E5%A4%8D%E5%88%B6"><span class="nav-number">5.1.6.</span> <span class="nav-text">6.半同步复制</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-%E5%A4%8D%E5%88%B6%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="nav-number">5.1.7.</span> <span class="nav-text">7.复制过滤器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-%E5%A4%8D%E5%88%B6%E4%B8%BB%E4%BB%8E%E5%8A%A0%E5%AF%86"><span class="nav-number">5.1.8.</span> <span class="nav-text">8.复制主从加密</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9-GTID"><span class="nav-number">5.1.9.</span> <span class="nav-text">9.GTID</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#10-%E5%A4%8D%E5%88%B6%E7%9A%84%E7%9B%91%E6%8E%A7%E5%92%8C%E7%BB%B4%E6%8A%A4"><span class="nav-number">5.1.10.</span> <span class="nav-text">10.复制的监控和维护</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#11-%E5%A4%8D%E5%88%B6%E7%9A%84%E9%97%AE%E9%A2%98%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="nav-number">5.1.11.</span> <span class="nav-text">11.复制的问题和解决方案</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MySQL%E4%B8%AD%E9%97%B4%E4%BB%B6%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-number">5.2.</span> <span class="nav-text">MySQL中间件代理服务器</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E5%92%8C%E9%9D%9E%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93-NO-SQL-%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">5.2.1.</span> <span class="nav-text">1.关系型数据库和非关系型数据库(NO SQL)数据库</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E6%95%B0%E6%8D%AE%E5%88%87%E5%88%86"><span class="nav-number">5.2.2.</span> <span class="nav-text">2.数据切分</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-MySQL%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%90%84%E7%A7%8D%E5%BA%94%E7%94%A8"><span class="nav-number">5.2.3.</span> <span class="nav-text">3.MySQL中间件各种应用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-Mycat"><span class="nav-number">5.2.4.</span> <span class="nav-text">4.Mycat</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Mycat%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%EF%BC%9A"><span class="nav-number">5.2.4.1.</span> <span class="nav-text">Mycat的工作原理：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%9E%E9%AA%8C%EF%BC%9A%E9%80%9A%E8%BF%87Mycat%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%92%8Cmysql-5-7-30%E7%89%88%E6%9C%AC%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E7%8E%B0%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB"><span class="nav-number">5.2.4.2.</span> <span class="nav-text">实验：通过Mycat中间件和mysql 5.7.30版本数据库实现读写分离</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-ProxySQL"><span class="nav-number">5.2.5.</span> <span class="nav-text">5.ProxySQL</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MySQL%E9%AB%98%E5%8F%AF%E7%94%A8"><span class="nav-number">5.3.</span> <span class="nav-text">MySQL高可用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%B8%B8%E7%94%A8%E7%9A%84MySQL%E9%AB%98%E5%8F%AF%E7%94%A8%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="nav-number">5.3.1.</span> <span class="nav-text">1.常用的MySQL高可用解决方案</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-MHA-Master-High-Availability"><span class="nav-number">5.3.2.</span> <span class="nav-text">2.MHA Master High Availability</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#MHA%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%EF%BC%9A"><span class="nav-number">5.3.2.1.</span> <span class="nav-text">MHA的工作原理：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#MHA%E8%BD%AF%E4%BB%B6"><span class="nav-number">5.3.2.2.</span> <span class="nav-text">MHA软件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%9E%E9%AA%8C%EF%BC%9A%E4%BD%BF%E7%94%A8MHA%E5%AE%9E%E7%8E%B0%E9%AB%98%E5%8F%AF%E7%94%A8"><span class="nav-number">5.3.2.3.</span> <span class="nav-text">实验：使用MHA实现高可用</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-Galera-Cluster"><span class="nav-number">5.3.3.</span> <span class="nav-text">3.Galera Cluster</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-TiDB"><span class="nav-number">5.3.4.</span> <span class="nav-text">4.TiDB</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="nav-number">6.</span> <span class="nav-text">性能优化</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7"><span class="nav-number">6.1.</span> <span class="nav-text">压力测试工具</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83my-cnf%E9%85%8D%E7%BD%AE%E6%A1%88%E4%BE%8B"><span class="nav-number">6.2.</span> <span class="nav-text">生产环境my.cnf配置案例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MySQL%E9%85%8D%E7%BD%AE%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="nav-number">6.3.</span> <span class="nav-text">MySQL配置最佳实践</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">huihui</p>
  <div class="site-description" itemprop="description">学习和看笔记</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">12</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">huihui</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  













<script>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : 'forest',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script>


  

  

</body>
</html>
