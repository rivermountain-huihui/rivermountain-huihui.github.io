<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>辉辉的数据库</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="LAMP架构LAMP介绍静态资源和动态资源的区别：在服务器端和客户端看到的是否一样，不在于页面是否能动 例子： 1服务器端看到的页面是一个PHP的时间函数，而客户端看到的就是一个具体的时间  WEB相关语言： ​    客户端技术：html,javascript,css ​    服务器端技术：java,php,javascript(Node.js),jsp,asp,Perl,Ruby LAMP的">
<meta property="og:type" content="article">
<meta property="og:title" content="辉辉的数据库">
<meta property="og:url" content="http://example.com/2020/11/18/LAMP%E6%9E%B6%E6%9E%84/index.html">
<meta property="og:site_name" content="辉辉的数据库">
<meta property="og:description" content="LAMP架构LAMP介绍静态资源和动态资源的区别：在服务器端和客户端看到的是否一样，不在于页面是否能动 例子： 1服务器端看到的页面是一个PHP的时间函数，而客户端看到的就是一个具体的时间  WEB相关语言： ​    客户端技术：html,javascript,css ​    服务器端技术：java,php,javascript(Node.js),jsp,asp,Perl,Ruby LAMP的">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="c:/Users/a/AppData/Roaming/Typora/typora-user-images/image-20201029161829297.png">
<meta property="article:published_time" content="2020-11-18T13:08:14.221Z">
<meta property="article:modified_time" content="2020-11-11T02:49:04.752Z">
<meta property="article:author" content="huihui">
<meta property="article:tag" content="notes">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="c:/Users/a/AppData/Roaming/Typora/typora-user-images/image-20201029161829297.png">
  
    <link rel="alternate" href="/atom.xml" title="辉辉的数据库" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">辉辉的数据库</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">我们要丈量大地！</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-LAMP架构" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/11/18/LAMP%E6%9E%B6%E6%9E%84/" class="article-date">
  <time class="dt-published" datetime="2020-11-18T13:08:14.221Z" itemprop="datePublished">2020-11-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="LAMP架构"><a href="#LAMP架构" class="headerlink" title="LAMP架构"></a>LAMP架构</h1><h2 id="LAMP介绍"><a href="#LAMP介绍" class="headerlink" title="LAMP介绍"></a>LAMP介绍</h2><p>静态资源和动态资源的区别：在服务器端和客户端看到的是否一样，不在于页面是否能动</p>
<p>例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">服务器端看到的页面是一个PHP的时间函数，而客户端看到的就是一个具体的时间</span><br></pre></td></tr></table></figure>

<p><strong>WEB相关语言：</strong></p>
<p>​    客户端技术：html,javascript,css</p>
<p>​    服务器端技术：java,php,javascript(Node.js),jsp,asp,Perl,Ruby</p>
<p>LAMP的工作流程：</p>
<p>主要的流程，动态资源的获取过程：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">客户端浏览器--&gt;http协议--&gt;Apache&#x2F;Nginx--&gt;动态资源--&gt;PHP&#x2F;Perl&#x2F;Python--&gt;需要数据--&gt;mysql--返回的数据--&gt;PHP&#x2F;Perl&#x2F;Python--&gt;静态资源--&gt;Apache&#x2F;Nginx--&gt;http协议--&gt;客户端浏览器</span><br></pre></td></tr></table></figure>

<p>静态资源就简单些：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">客户端浏览器--&gt;http协议--&gt;Apache&#x2F;Nginx--&gt;静态资源--&gt;http协议--&gt;客户端浏览器</span><br></pre></td></tr></table></figure>



<h2 id="CGI和FastCGI"><a href="#CGI和FastCGI" class="headerlink" title="CGI和FastCGI"></a>CGI和FastCGI</h2><h3 id="CGI"><a href="#CGI" class="headerlink" title="CGI"></a>CGI</h3><p>CGI：Common Gateway Interface，公共网关接口</p>
<p>Web服务在碰到一个动态请求时，会fork一个新的PHP或Perl或C程序进程来处理动态请求，进程完成后会把被处理过的数据发送给Web服务，然后Web服务再把数据发送给用户，进程在完成后结束。如果下次还有动态请求，那么Web服务还会fork新的进程去处理。</p>
<p>CGI可以让一个客户端，从网页浏览器上，通过http协议，向Web服务器上的程序传输数据；</p>
<p>CGI描述了客户端和服务器程序之间传输的标准；</p>
<p>工作流程：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Client--&gt;http协议--&gt;Apache&#x2F;Nginx--&gt;CGI协议--&gt;Application program--&gt;mysql</span><br></pre></td></tr></table></figure>

<p>要想使用CGI，需要这几个部分：</p>
<p>1.定义目录权限</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">360 &lt;Directory &quot;&#x2F;apps&#x2F;httpd&#x2F;cgi-bin&quot;&gt;</span><br><span class="line">361     AllowOverride None</span><br><span class="line">362     Options None</span><br><span class="line">363     Require all granted</span><br><span class="line">364 &lt;&#x2F;Directory&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2.定义httpd的执行脚本别名，只要在这个路径下，httpd就会认为是脚本，并且把执行的结果返回给浏览器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;IfModule alias_module&gt;</span><br><span class="line">	ScriptAlias &#x2F;cgi-bin&#x2F; &quot;&#x2F;apps&#x2F;httpd&#x2F;cgi-bin&#x2F;&quot;   </span><br><span class="line">	#ScriptAlias是命令名，是固定的，后面两个都可以改，第一个参数是访问的时候输入什么，第二是你的脚本放在哪个路径了，注意这个路径必须明确定义了可以访问权限，也就是目录权限</span><br><span class="line">&lt;&#x2F;IfModule alias_module&gt;</span><br></pre></td></tr></table></figure>

<p>3.加载了模块</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">147 &lt;IfModule !mpm_prefork_module&gt;</span><br><span class="line">148     #LoadModule cgid_module modules&#x2F;mod_cgid.so</span><br><span class="line">149 &lt;&#x2F;IfModule&gt;</span><br><span class="line">150 &lt;IfModule mpm_prefork_module&gt;</span><br><span class="line">151     LoadModule cgi_module modules&#x2F;mod_cgi.so</span><br><span class="line">152 &lt;&#x2F;IfModule&gt;</span><br><span class="line">#这里注意是两个判断，根据当前MPM来选择，去掉注释就是加载</span><br></pre></td></tr></table></figure>



<h3 id="FastCGI"><a href="#FastCGI" class="headerlink" title="FastCGI"></a><strong>FastCGI</strong></h3><p>fastcgi的方式是，自己就是一个进程，当web服务收到一个动态请求时，不会去fork一个进程，而是直接把内容发送给fastcgi，使用进程之间的通信，但是fastcgi使用了tcp方式，当这个进程处理完数据后 把数据发送给web服务，然后继续等待下一个请求的到来，不退出</p>
<p>工作流程：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Client--&gt;http协议--&gt;Apache&#x2F;Nginx--&gt;fastcgi协议--&gt;fastcgi程序--&gt;mysql</span><br></pre></td></tr></table></figure>

<p>使用fastCGI的方式，如果配合PHP语言，那么使用PHP-FPM程序</p>
<p>我想其他的语言应该也有类似的程序，专门负责处理动态请求</p>
<p><strong>CGI和FASTCGI的区别：</strong></p>
<p>CGI：一次性</p>
<p>FASTCGI：专职，全周期的持续服务</p>
<h2 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h2><p>PHP的解释器是Zend</p>
<p>PHP的Opcode；</p>
<h3 id="PHP的执行过程："><a href="#PHP的执行过程：" class="headerlink" title="PHP的执行过程："></a>PHP的执行过程：</h3><ul>
<li>Scanning 词法分析，将PHP语言转换为语言片段</li>
<li>Parsing 语义分析，将语言片段转换成简单有意义的表达式</li>
<li>Compilation 编译，把表达式解释成Opcode</li>
<li>Execution 执行，按顺序执行Opcode，实现PHP脚本的功能</li>
</ul>
<h3 id="语法："><a href="#语法：" class="headerlink" title="语法："></a>语法：</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">phpinfo()</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="PHP的配置文件：-etc-php-int"><a href="#PHP的配置文件：-etc-php-int" class="headerlink" title="PHP的配置文件：/etc/php.int"></a>PHP的配置文件：<code>/etc/php.int</code></h3><p>让PHP配置文件生效的方式：</p>
<ul>
<li>重启Web服务</li>
<li>重启PHP-FPM</li>
</ul>
<p>配置文件格式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[PHP]</span><br><span class="line">directive &#x3D; value</span><br><span class="line">注释是   ;</span><br></pre></td></tr></table></figure>

<p>官方网站中关于配置选项的页面：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;www.php.net&#x2F;manual&#x2F;zh&#x2F;ini.list.php</span><br><span class="line">https:&#x2F;&#x2F;www.php.net&#x2F;manual&#x2F;zh&#x2F;ini.core.php #这个是核心选项</span><br></pre></td></tr></table></figure>

<p>PHP建议的设置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">expose_php &#x3D; Off #禁止显示PHP版本信息</span><br><span class="line">max_execution #最长执行时间</span><br><span class="line">memory_limit &#x3D; 128M #内存限制使用大小，可以调大</span><br><span class="line">display_errors &#x3D; Off #除了调试，其他时候都应该关闭</span><br><span class="line">display_startup_errors &#x3D; Off #建议关闭</span><br><span class="line">post_max_size &#x3D; 8M #最大上传数据总大小</span><br><span class="line">upload_max_filesize &#x3D; 2M #最大上传文件大小</span><br><span class="line">max_file_uploads &#x3D; 20 #最多上传文件数量</span><br><span class="line">date.timezone &#x3D; Asia&#x2F;Shanghai</span><br><span class="line">short_open_tag &#x3D; On #开启短标签，比如:&lt;?php phpinfo(); ?&gt;</span><br></pre></td></tr></table></figure>

<p>php-fpm</p>
<p>php-mysqlnd</p>
<p>PDO</p>
<p>setfacl</p>
<h2 id="LAMP环境搭建"><a href="#LAMP环境搭建" class="headerlink" title="LAMP环境搭建"></a>LAMP环境搭建</h2><p>两个问题：</p>
<ul>
<li>HTTPD服务和PHP的交互怎么实现？</li>
<li>PHP和MYSQL怎么交互？</li>
</ul>
<h3 id="第一个问题：使用CGI或者FASTCGI"><a href="#第一个问题：使用CGI或者FASTCGI" class="headerlink" title="第一个问题：使用CGI或者FASTCGI"></a>第一个问题：使用CGI或者FASTCGI</h3><p>安装总体上就两种：</p>
<ul>
<li>CGI方式，也就是使用httpd中自带的CGI模块实现动态资源的处理</li>
<li>FASTCGI方式，也就是使用PHP-FPM程序来处理动态资源</li>
</ul>
<p>如果使用CGI，那么就不需要下载PHP-FPM，否则就下载使用</p>
<p>例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dnf -y install httpd php php-fpm mysql-server php-mysqlnd php-json</span><br></pre></td></tr></table></figure>

<h3 id="第二个问题：使用PDO（PHP-Data-Object）扩展连接数据库"><a href="#第二个问题：使用PDO（PHP-Data-Object）扩展连接数据库" class="headerlink" title="第二个问题：使用PDO（PHP Data Object）扩展连接数据库"></a>第二个问题：使用PDO（PHP Data Object）扩展连接数据库</h3><p>使用PDO扩展模块：pdo_mysql.so，这个模块在<code>php-mysqlnd</code>软件中，下载即可</p>
<h2 id="应用程序"><a href="#应用程序" class="headerlink" title="应用程序"></a>应用程序</h2><p>应用程序出现问题，主要看几个日志去查找问题：</p>
<p>HTTPD的错误日志：<code>/var/log/httpd/error_log</code></p>
<p>PHP-FPM的错误日志：<code>/var/log/php-fpm/www-error.log</code></p>
<p>Linux的错误日志：<code>/var/log/message</code></p>
<p>Mysql的错误日志：<code>/var/log/mysql.log</code></p>
<h3 id="PhpMyAdmin"><a href="#PhpMyAdmin" class="headerlink" title="PhpMyAdmin"></a>PhpMyAdmin</h3><p>PHPMyAdmin是个网页管理数据库的工具</p>
<p>需要的环境：LAMP</p>
<p>依赖包：php-json</p>
<p>安装方法：下载PhpMyAdmin软件包，5.X，然后把解压出来的文件整个放到网站目录下，通过网页访问：<code>http://localhost/phpName/</code>，phpName是文件的名称</p>
<h3 id="PowerDNS-PowerAdmin"><a href="#PowerDNS-PowerAdmin" class="headerlink" title="PowerDNS+PowerAdmin"></a>PowerDNS+PowerAdmin</h3><p>PowerDNS是一个跨平台的DNS服务组件，可以提供网页端的DNS服务，端口也是53</p>
<p>PowerAdmin是一个从网页进行PowerDNS管理的PHP软件</p>
<p>测试DNS服务器的解析：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dig 域名 @DNS服务器地址</span><br></pre></td></tr></table></figure>

<p>需要软件：pdns,pdns-backend-mysql,poweradmin</p>
<p>pdns相关软件之间yum安装即可；</p>
<p>poweradmin去github上下载，地址是</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone git:&#x2F;&#x2F;github.com&#x2F;poweradmin&#x2F;poweradmin.git</span><br></pre></td></tr></table></figure>

<p>依赖包：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install httpd php php-devel php-gd php-imap php-ldap php-mysql php-odbc php-pear php-xml php-xmlrpc php-mbstring php-mcrypt php-mhash gettext</span><br><span class="line"></span><br><span class="line">yum -y install php-pear-DB php-pear-MDB2-Driver-mysql</span><br></pre></td></tr></table></figure>

<p>把poweradmin的包之间放到<code>/var/www/html</code>下面</p>
<p>LAMP环境搭好，包括：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CentOS 7</span><br><span class="line">Apache 2.4.46</span><br><span class="line">Mariadb 5.5.65</span><br><span class="line">PHP 5.4.16</span><br></pre></td></tr></table></figure>

<p>需要在数据库中新建一个用户和数据库给PowerDNS，比如pdns</p>
<p>需要在PowerDNS的配置文件<code>/etc/pdns/pdns.conf</code>中修改和添加内容：launch那行是修改，其他行是添加，一个配置文件中只能有一个launch，user,password,dbname就是在数据库中设定的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">250 launch&#x3D;gmysql</span><br><span class="line">251 gmysql-host&#x3D;127.0.0.1</span><br><span class="line">252 gmysql-user&#x3D;pdns</span><br><span class="line">253 gmysql-password&#x3D;centos</span><br><span class="line">254 gmysql-dbname&#x3D;pdns </span><br></pre></td></tr></table></figure>

<p>然后需要新建一些表：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line">use pdns;</span><br><span class="line">CREATE TABLE domains (</span><br><span class="line">  id                    INT AUTO_INCREMENT,</span><br><span class="line">  name                  VARCHAR(255) NOT NULL,</span><br><span class="line">  master                VARCHAR(128) DEFAULT NULL,</span><br><span class="line">  last_check            INT DEFAULT NULL,</span><br><span class="line">  type                  VARCHAR(6) NOT NULL,</span><br><span class="line">  notified_serial       INT UNSIGNED DEFAULT NULL,</span><br><span class="line">  account               VARCHAR(40) CHARACTER SET &#39;utf8&#39; DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (id)</span><br><span class="line">) Engine&#x3D;InnoDB CHARACTER SET &#39;latin1&#39;;</span><br><span class="line"></span><br><span class="line">CREATE UNIQUE INDEX name_index ON domains(name);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">CREATE TABLE records (</span><br><span class="line">  id                    BIGINT AUTO_INCREMENT,</span><br><span class="line">  domain_id             INT DEFAULT NULL,</span><br><span class="line">  name                  VARCHAR(255) DEFAULT NULL,</span><br><span class="line">  type                  VARCHAR(10) DEFAULT NULL,</span><br><span class="line">  content               VARCHAR(64000) DEFAULT NULL,</span><br><span class="line">  ttl                   INT DEFAULT NULL,</span><br><span class="line">  change_date           INT DEFAULT NULL,</span><br><span class="line">  prio                  INT DEFAULT NULL,</span><br><span class="line">  disabled              TINYINT(1) DEFAULT 0,</span><br><span class="line">  ordername             VARCHAR(255) BINARY DEFAULT NULL,</span><br><span class="line">  auth                  TINYINT(1) DEFAULT 1,</span><br><span class="line">  PRIMARY KEY (id)</span><br><span class="line">) Engine&#x3D;InnoDB CHARACTER SET &#39;latin1&#39;;</span><br><span class="line"></span><br><span class="line">CREATE INDEX nametype_index ON records(name,type);</span><br><span class="line">CREATE INDEX domain_id ON records(domain_id);</span><br><span class="line">CREATE INDEX ordername ON records (ordername);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">CREATE TABLE supermasters (</span><br><span class="line">  ip                    VARCHAR(64) NOT NULL,</span><br><span class="line">  nameserver            VARCHAR(255) NOT NULL,</span><br><span class="line">  account               VARCHAR(40) CHARACTER SET &#39;utf8&#39; NOT NULL,</span><br><span class="line">  PRIMARY KEY (ip, nameserver)</span><br><span class="line">) Engine&#x3D;InnoDB CHARACTER SET &#39;latin1&#39;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">CREATE TABLE comments (</span><br><span class="line">  id                    INT AUTO_INCREMENT,</span><br><span class="line">  domain_id             INT NOT NULL,</span><br><span class="line">  name                  VARCHAR(255) NOT NULL,</span><br><span class="line">  type                  VARCHAR(10) NOT NULL,</span><br><span class="line">  modified_at           INT NOT NULL,</span><br><span class="line">  account               VARCHAR(40) CHARACTER SET &#39;utf8&#39; DEFAULT NULL,</span><br><span class="line">  comment               TEXT CHARACTER SET &#39;utf8&#39; NOT NULL,</span><br><span class="line">  PRIMARY KEY (id)</span><br><span class="line">) Engine&#x3D;InnoDB CHARACTER SET &#39;latin1&#39;;</span><br><span class="line"></span><br><span class="line">CREATE INDEX comments_name_type_idx ON comments (name, type);</span><br><span class="line">CREATE INDEX comments_order_idx ON comments (domain_id, modified_at);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">CREATE TABLE domainmetadata (</span><br><span class="line">  id                    INT AUTO_INCREMENT,</span><br><span class="line">  domain_id             INT NOT NULL,</span><br><span class="line">  kind                  VARCHAR(32),</span><br><span class="line">  content               TEXT,</span><br><span class="line">  PRIMARY KEY (id)</span><br><span class="line">) Engine&#x3D;InnoDB CHARACTER SET &#39;latin1&#39;;</span><br><span class="line"></span><br><span class="line">CREATE INDEX domainmetadata_idx ON domainmetadata (domain_id, kind);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">CREATE TABLE cryptokeys (</span><br><span class="line">  id                    INT AUTO_INCREMENT,</span><br><span class="line">  domain_id             INT NOT NULL,</span><br><span class="line">  flags                 INT NOT NULL,</span><br><span class="line">  active                BOOL,</span><br><span class="line">  published             BOOL DEFAULT 1,</span><br><span class="line">  content               TEXT,</span><br><span class="line">  PRIMARY KEY(id)</span><br><span class="line">) Engine&#x3D;InnoDB CHARACTER SET &#39;latin1&#39;;</span><br><span class="line"></span><br><span class="line">CREATE INDEX domainidindex ON cryptokeys(domain_id);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">CREATE TABLE tsigkeys (</span><br><span class="line">  id                    INT AUTO_INCREMENT,</span><br><span class="line">  name                  VARCHAR(255),</span><br><span class="line">  algorithm             VARCHAR(50),</span><br><span class="line">  secret                VARCHAR(255),</span><br><span class="line">  PRIMARY KEY (id)</span><br><span class="line">) Engine&#x3D;InnoDB CHARACTER SET &#39;latin1&#39;;</span><br><span class="line"></span><br><span class="line">CREATE UNIQUE INDEX namealgoindex ON tsigkeys(name, algorithm);</span><br><span class="line"></span><br><span class="line">&#x2F;*</span><br><span class="line">Using this SQL causes Mysql to create foreign keys on your database. This will</span><br><span class="line">make sure that no records, comments or keys exists for domains that you already</span><br><span class="line">removed. This is not enabled by default, because we&#39;re not sure what the</span><br><span class="line">consequences are from a performance point of view. If you do have feedback,</span><br><span class="line">please let us know how this affects your setup.</span><br><span class="line"></span><br><span class="line">Please note that it&#39;s not possible to apply this, before you cleaned up your</span><br><span class="line">database, as the foreign keys do not exist.</span><br><span class="line">*&#x2F;</span><br><span class="line">ALTER TABLE records ADD CONSTRAINT &#96;records_domain_id_ibfk&#96; FOREIGN KEY (&#96;domain_id&#96;) REFERENCES &#96;domains&#96; (&#96;id&#96;) ON DELETE CASCADE ON UPDATE CASCADE;</span><br><span class="line">ALTER TABLE comments ADD CONSTRAINT &#96;comments_domain_id_ibfk&#96; FOREIGN KEY (&#96;domain_id&#96;) REFERENCES &#96;domains&#96; (&#96;id&#96;) ON DELETE CASCADE ON UPDATE CASCADE;</span><br><span class="line">ALTER TABLE domainmetadata ADD CONSTRAINT &#96;domainmetadata_domain_id_ibfk&#96; FOREIGN KEY (&#96;domain_id&#96;) REFERENCES &#96;domains&#96; (&#96;id&#96;) ON DELETE CASCADE ON UPDATE CASCADE;</span><br><span class="line">ALTER TABLE cryptokeys ADD CONSTRAINT &#96;cryptokeys_domain_id_ibfk&#96; FOREIGN KEY (&#96;domain_id&#96;) REFERENCES &#96;domains&#96; (&#96;id&#96;) ON DELETE CASCADE ON UPDATE CASCADE;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后在看看LAMP的几个程序都正常不正常，正常了就都重启一遍，然后从网页访问：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost&#x2F;poweradmin&#x2F;</span><br></pre></td></tr></table></figure>

<p>一路配置就完事了，这里面的DNS的配置知识有些遗忘了，但大概是这样：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">SOA 记录  </span><br><span class="line">NS  记录</span><br><span class="line">A  记录</span><br><span class="line">完事</span><br><span class="line">		</span><br><span class="line">lv.dota		SOA		ns1.lv.dota 2020102904 28800 7200 604800 86400</span><br><span class="line">lv.dota 	NS		10.0.0.11	</span><br><span class="line">www.lv.dota  A		10.0.0.119</span><br><span class="line"></span><br><span class="line">参数说明：</span><br><span class="line">SOA：起始授权机构记录 </span><br><span class="line">ns1.lv.dota 域名服务器</span><br><span class="line">2020102904 编号，这个值很重要，他的改变才真正意味着DNS进行了改变</span><br><span class="line">28800 刷新间隔</span><br><span class="line">7200 重新尝试时间</span><br><span class="line">604800 过期时间</span><br><span class="line">86400 negative TTL</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\a\AppData\Roaming\Typora\typora-user-images\image-20201029161829297.png" alt="image-20201029161829297"></p>
<h3 id="Discuz"><a href="#Discuz" class="headerlink" title="Discuz!"></a>Discuz!</h3><h3 id=""><a href="#" class="headerlink" title=""></a></h3><h2 id="PHP加速器"><a href="#PHP加速器" class="headerlink" title="PHP加速器"></a>PHP加速器</h2><p>不是每次进行完整的解释过程，而是保存Opcode，这样能快点</p>
<p>Opcache通过将PHP脚本中预编译的字节码存储到共享内存中来提升PHP的性能，存储预编译字节码的好处就是省去了每次加载和解析PHP脚本的开销，PHP5.5之后默认绑定Opcache扩展。</p>
<p>安装方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dnf -y install php-opcache</span><br><span class="line">然后重启一下php-fpm就行了，因为它下载下来的包里面有一个php的子配置文件</span><br><span class="line">&#x2F;etc&#x2F;php.d&#x2F;10-opcache.ini</span><br><span class="line">里面默认启用了opcache</span><br><span class="line">opcache.enable&#x3D;1</span><br></pre></td></tr></table></figure>



<h2 id="处理动态资源的独立软件：PHP-FPM"><a href="#处理动态资源的独立软件：PHP-FPM" class="headerlink" title="处理动态资源的独立软件：PHP-FPM"></a>处理动态资源的独立软件：PHP-FPM</h2><p>协议：fastcgi</p>
<p>在Centos8上，直接安装php就行，跟安装php-fpm是一样的 </p>
<p>php-fpm的套接字方式，对httpd服务的版本有要求，要2.4.7以上才行！</p>
<p>配置文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;etc&#x2F;php-fpm.conf</span><br><span class="line">&#x2F;etc&#x2F;php-fpm.d&#x2F;www.conf</span><br></pre></td></tr></table></figure>



<p>sock文件的权限问题</p>
<p>写出一个脚本，LAMP加一个WordPress</p>
<p>编译安装PHP，APACHE</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/11/18/LAMP%E6%9E%B6%E6%9E%84/" data-id="ckhnf9he9000040uth2dmenoi" data-title="" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2020/11/18/Linux%E9%98%B2%E7%81%AB%E5%A2%99/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          (no title)
        
      </div>
    </a>
  
  
    <a href="/2020/11/18/Docker/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title"></div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/" rel="tag">hexo</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/hexo/" style="font-size: 10px;">hexo</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/11/18/%E8%BF%90%E7%BB%B4%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2/">(no title)</a>
          </li>
        
          <li>
            <a href="/2020/11/18/%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91MYSQL8.0/">(no title)</a>
          </li>
        
          <li>
            <a href="/2020/11/18/%E6%97%A5%E5%BF%97%E7%AE%A1%E7%90%86-rsyslog/">(no title)</a>
          </li>
        
          <li>
            <a href="/2020/11/18/%E5%8A%A0%E5%AF%86%E5%92%8C%E5%AE%89%E5%85%A8/">(no title)</a>
          </li>
        
          <li>
            <a href="/2020/11/18/%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85MySQL%E8%84%9A%E6%9C%AC/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2020 huihui<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>