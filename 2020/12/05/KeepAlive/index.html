<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#0078E7"><meta name="author" content="huihui"><meta name="copyright" content="huihui"><meta name="generator" content="Hexo 5.2.0"><meta name="theme" content="hexo-theme-yun"><title>KeepAlive | 辉辉的数据库</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/star-markdown-css@0.1.22/dist/yun/yun-markdown.min.css"><script src="//at.alicdn.com/t/font_1140697_ed8vp4atwoj.js" async></script><script src="https://cdn.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>document.addEventListener("DOMContentLoaded", () => {
  [".post-card",".post-content img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
});
</script><link rel="shortcut icon" type="image/svg+xml" href="/yun.svg"><link rel="mask-icon" href="/yun.svg" color="#0078E7"><link rel="alternate icon" href="/yun.ico"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="preload" href="/js/utils.js" as="script"><link rel="preload" href="/js/hexo-theme-yun.js" as="script"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><link rel="stylesheet" href="/css/hexo-theme-yun.css"><script id="yun-config">
    const Yun = window.Yun || {};
    window.CONFIG = {"hostname":"example.com","root":"/","title":"这一幕是我了","version":"1.3.0","mode":"auto","copycode":true,"anonymous_image":"https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/avatar/none.jpg","say":{"api":"https://v1.hitokoto.cn","hitokoto":true},"fireworks":{"colors":["102, 167, 221","62, 131, 225","33, 78, 194"]}};
  </script><meta name="description" content="KeepAlive KeepAlived是什么？  KeepAlived是VRRP协议的软件实现，官方站点是：Keepalived for Linux KeepAlived是用C语言编写的，它的目的是为Linux系统和基于Linux系统的软件提供一种简单强壮的高可用服务">
<meta property="og:type" content="article">
<meta property="og:title" content="KeepAlive">
<meta property="og:url" content="http://example.com/2020/12/05/KeepAlive/index.html">
<meta property="og:site_name" content="辉辉的数据库">
<meta property="og:description" content="KeepAlive KeepAlived是什么？  KeepAlived是VRRP协议的软件实现，官方站点是：Keepalived for Linux KeepAlived是用C语言编写的，它的目的是为Linux系统和基于Linux系统的软件提供一种简单强壮的高可用服务">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s3.ax1x.com/2020/11/28/DsgkEd.png">
<meta property="og:image" content="https://s3.ax1x.com/2020/11/28/DsgiHH.png">
<meta property="og:image" content="https://s3.ax1x.com/2020/11/28/DsRh4A.png">
<meta property="article:published_time" content="2020-12-05T14:00:32.000Z">
<meta property="article:modified_time" content="2020-12-05T14:01:02.682Z">
<meta property="article:author" content="huihui">
<meta property="article:tag" content="notes">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s3.ax1x.com/2020/11/28/DsgkEd.png"><script src="/js/ui/mode.js"></script></head><body><script defer src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script defer src="/js/ui/fireworks.js"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="文章目录"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-list-ordered"></use></svg></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="站点概览"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-passport-line"></use></svg></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="huihui"><img width="96" loading="lazy" src="/Yun.png" alt="huihui"></a><div class="site-author-name"><a href="/about/">huihui</a></div><a class="site-name" href="/about/site.html">辉辉的数据库</a><sub class="site-subtitle">我们要丈量大地！</sub><div class="site-desciption">笔记</div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="首页"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-home-4-line"></use></svg></span></a><div class="site-state-item"><a href="/archives/" title="归档"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-archive-line"></use></svg></span><span class="site-state-item-count">13</span></a></div><div class="site-state-item"><a href="/categories/" title="分类"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-2-line"></use></svg></span><span class="site-state-item-count">0</span></a></div><div class="site-state-item"><a href="/tags/" title="标签"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="site-state-item-count">1</span></a></div><a class="site-state-item hty-icon-button" target="_blank" rel="noopener" href="https://yun.yunyoujun.cn" title="文档"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-settings-line"></use></svg></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="/atom.xml" title="RSS" target="_blank" style="color:orange"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-rss-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://qm.qq.com/cgi-bin/qm/qr?k=epvxdq1sknJe9JMj6J1LsBw4a6cI_2ln&amp;jump_from=webapi" title="QQ 群 389401003" target="_blank" style="color:#12B7F5"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-qq-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/YunYouJun" title="GitHub" target="_blank" style="color:#6e5494"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-github-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://weibo.com/jizhideyunyoujun" title="微博" target="_blank" style="color:#E6162D"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-weibo-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://www.douban.com/people/yunyoujun/" title="豆瓣" target="_blank" style="color:#007722"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-douban-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://music.163.com/#/user/home?id=247102977" title="网易云音乐" target="_blank" style="color:#C20C0C"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-netease-cloud-music-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://www.zhihu.com/people/yunyoujun/" title="知乎" target="_blank" style="color:#0084FF"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-zhihu-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://space.bilibili.com/1579790" title="哔哩哔哩" target="_blank" style="color:#FF8EB3"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-bilibili-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://twitter.com/YunYouJun" title="Twitter" target="_blank" style="color:#1da1f2"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-twitter-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://t.me/elpsycn" title="Telegram Channel" target="_blank" style="color:#0088CC"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-telegram-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="mailto:me@yunyoujun.cn" title="E-Mail" target="_blank" style="color:#8E71C1"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-mail-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://travellings.now.sh/" title="Travelling" target="_blank" style="color:var(--hty-text-color)"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-send-plane-2-line"></use></svg></a></div><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/links/" title="我的小伙伴们" style="color:dodgerblue"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-genderless-line"></use></svg></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-contrast-2-line"></use></svg></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#KeepAlive"><span class="toc-number">1.</span> <span class="toc-text">KeepAlive</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4"><span class="toc-number">2.</span> <span class="toc-text">1 高可用集群</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#VRRP-%E8%99%9A%E6%8B%9F%E8%B7%AF%E7%94%B1%E5%99%A8%E5%86%97%E4%BD%99%E5%8D%8F%E8%AE%AE"><span class="toc-number">2.0.1.</span> <span class="toc-text">VRRP 虚拟路由器冗余协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AB%98%E5%8F%AF%E7%94%A8%E7%9A%84%E6%96%B9%E6%A1%88"><span class="toc-number">2.0.2.</span> <span class="toc-text">高可用的方案</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AB%98%E5%8F%AF%E7%94%A8%E7%9A%84%E7%9B%B8%E5%85%B3%E6%8A%80%E6%9C%AF"><span class="toc-number">2.0.3.</span> <span class="toc-text">高可用的相关技术</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#HA-service"><span class="toc-number">2.0.3.1.</span> <span class="toc-text">HA service</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Shared-Storage"><span class="toc-number">2.0.3.2.</span> <span class="toc-text">Shared Storage</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Network-Partition-%E7%BD%91%E7%BB%9C%E5%88%86%E5%8C%BA"><span class="toc-number">2.0.3.3.</span> <span class="toc-text">Network Partition 网络分区</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%8C%E8%8A%82%E7%82%B9%E9%9B%86%E7%BE%A4-Two-Nodes-Cluster"><span class="toc-number">2.0.3.4.</span> <span class="toc-text">双节点集群 Two Nodes Cluster</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-KeepAlived-%E4%BA%86%E8%A7%A3"><span class="toc-number">3.</span> <span class="toc-text">2 KeepAlived 了解</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#KeepAlived%E7%9A%84%E8%BF%9B%E7%A8%8B"><span class="toc-number">3.1.</span> <span class="toc-text">KeepAlived的进程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#KeepAlived%E7%9A%84%E5%AE%89%E8%A3%85"><span class="toc-number">3.2.</span> <span class="toc-text">KeepAlived的安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#KeepAlived-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">3.3.</span> <span class="toc-text">KeepAlived 配置文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#keepalived%E7%9A%84%E6%97%A5%E5%BF%97%E5%90%AF%E7%94%A8"><span class="toc-number">3.4.</span> <span class="toc-text">keepalived的日志启用</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-KeepAlived%E7%9A%84%E5%BA%94%E7%94%A8"><span class="toc-number">4.</span> <span class="toc-text">3 KeepAlived的应用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-%E6%A1%88%E4%BE%8B%E4%B8%80%EF%BC%9A%E5%AE%9E%E7%8E%B0%E4%B8%A4%E4%B8%AAKA%E7%9A%84%E4%B8%BB-%E5%A4%87%E9%85%8D%E7%BD%AE"><span class="toc-number">4.1.</span> <span class="toc-text">3.1 案例一：实现两个KA的主&#x2F;备配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-%E6%A1%88%E4%BE%8B%E4%BA%8C%EF%BC%9A%E6%8A%A2%E5%8D%A0%E6%A8%A1%E5%BC%8F%E5%92%8C%E9%9D%9E%E6%8A%A2%E5%8D%A0%E6%A8%A1%E5%BC%8F"><span class="toc-number">4.2.</span> <span class="toc-text">3.2 案例二：抢占模式和非抢占模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-%E6%A1%88%E4%BE%8B%E4%B8%89%EF%BC%9AVIP%E5%8D%95%E6%92%AD%E6%A8%A1%E5%BC%8F"><span class="toc-number">4.3.</span> <span class="toc-text">3.3 案例三：VIP单播模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4-%E9%80%9A%E7%9F%A5%E8%84%9A%E6%9C%AC%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="toc-number">4.4.</span> <span class="toc-text">3.4 通知脚本的配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-5-%E5%AE%9E%E7%8E%B0master-slave%E7%9A%84%E5%8F%8C%E4%B8%BB%E6%9E%B6%E6%9E%84"><span class="toc-number">4.5.</span> <span class="toc-text">3.5 实现master&#x2F;slave的双主架构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-6-%E5%AE%9E%E7%8E%B0IPVS%E7%9A%84%E9%AB%98%E5%8F%AF%E7%94%A8%E6%80%A7"><span class="toc-number">4.6.</span> <span class="toc-text">3.6 实现IPVS的高可用性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-7-%E5%AE%9E%E7%8E%B0%E5%85%B6%E4%BB%96%E7%9A%84%E5%BA%94%E7%94%A8%E7%9A%84%E9%AB%98%E5%8F%AF%E7%94%A8%E6%80%A7%E7%9A%84VRRP%E8%84%9A%E6%9C%AC"><span class="toc-number">4.7.</span> <span class="toc-text">3.7 实现其他的应用的高可用性的VRRP脚本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-8-%E5%90%8C%E6%AD%A5%E7%BB%84"><span class="toc-number">4.8.</span> <span class="toc-text">3.8 同步组</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B"><span class="toc-number">5.</span> <span class="toc-text">4 综合案例</span></a></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="post-block" itemscope itemtype="https://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://example.com/2020/12/05/KeepAlive/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="huihui"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="辉辉的数据库"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">KeepAlive</h1><div class="post-meta"><div class="post-time" style="display:inline-block"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-line"></use></svg></span> <time title="创建时间：2020-12-05 22:00:32" itemprop="dateCreated datePublished" datetime="2020-12-05T22:00:32+08:00">2020-12-05</time></div><div class="post-classify"></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body" style="--smc-primary:#0078E7;"><h1 id="KeepAlive"><a href="#KeepAlive" class="headerlink" title="KeepAlive"></a>KeepAlive</h1><p><a target="_blank" rel="noopener" href="https://imgchr.com/i/DsgkEd"><img src="https://s3.ax1x.com/2020/11/28/DsgkEd.png" alt="DsgkEd.png" loading="lazy"></a></p>
<p>KeepAlived是什么？</p>
<blockquote>
<p>KeepAlived是VRRP协议的软件实现，官方站点是：<a target="_blank" rel="noopener" href="https://keepalived.org/">Keepalived for Linux</a></p>
<p>KeepAlived是用C语言编写的，它的目的是为Linux系统和基于Linux系统的软件提供一种简单强壮的高可用服务</p>
</blockquote>
<a id="more"></a>

<p>为什么要使用KeepAlived？</p>
<blockquote>
<p>解决单点失败问题，实现高可用功能</p>
<p>KeepAlived有一定的垄断地位，目前在高可用方面首选KeepAlived</p>
</blockquote>
<p>KeepAlived的工作原理？</p>
<blockquote>
<p>？</p>
<p>基于VRRP协议完成地址流动，即VIP</p>
<p>为VIP地址所在的节点生成ipvs规则</p>
<p>为ipvs集群的各RS做健康性检查</p>
<p>基于脚本调用接口，完成脚本中定义的功能，进而影响集群事务</p>
</blockquote>
<p>KeepAlived的大体工作流程？</p>
<blockquote>
<p>下载并安装软件keepalived</p>
<p>按照需求添加和修改配置文件，默认路径是/etc/keepalived/keepalived.conf</p>
<p>搭建奇数个KeepAlived服务器，这是为了解决它自己的单点问题</p>
<p>开启服务</p>
</blockquote>
<p>KeepAlived的使用场景？</p>
<blockquote>
<p>KA配合LVS</p>
<p>KA配合HAproxy</p>
</blockquote>
<p>KeepAlived的组件</p>
<blockquote>
<p>VRRP Stack        VRRP栈，用于实现VIP，即VIP消息通告功能</p>
<p>System Call        系统调用</p>
<p>Checkers        健康性检查</p>
<p>IPVS wrapper        调用内核功能，生成IPVS规则</p>
<p>Netlink Reflect    调用内核功能，实现网络接口</p>
<p>WatchDog        看门狗</p>
<p>Control Plane Configuration file parser    配置文件分析器</p>
<p>Scheduler I/O Multiplexer    多路I/O调度器，I/O复用器</p>
<p>Memory Mngt        内存管理组件 ？</p>
<p>SMTP        简单邮件传输协议模块</p>
</blockquote>
<p>KeepAlived软件的组成部分</p>
<blockquote>
<p>/etc/keepalived/keepalived.conf</p>
<p>/usr/sbin/keepalived</p>
<p>/lib/systemd/system/keepalived.service</p>
</blockquote>
<p>使用KeepAlived的环境要求</p>
<blockquote>
<p>各个节点需要时间同步</p>
<p>关闭防火墙和SELINUX</p>
</blockquote>
<h1 id="1-高可用集群"><a href="#1-高可用集群" class="headerlink" title="1 高可用集群"></a>1 高可用集群</h1><p>负载均衡集群</p>
<p>高可用集群</p>
<p>高性能集群</p>
<hr>
<h3 id="VRRP-虚拟路由器冗余协议"><a href="#VRRP-虚拟路由器冗余协议" class="headerlink" title="VRRP 虚拟路由器冗余协议"></a>VRRP 虚拟路由器冗余协议</h3><p>​    因为KeepAlived就是VRRP协议的网络实现，因此KeepAlived中全面使用了VRRP的技术点，学习VRRP协议的技术点就是了解KeepAlived的技术</p>
<p>一个大概的图片</p>
<p><a target="_blank" rel="noopener" href="https://imgchr.com/i/DsgiHH"><img src="https://s3.ax1x.com/2020/11/28/DsgiHH.png" alt="DsgiHH.png" loading="lazy"></a></p>
<p>VRRP的主从切换：</p>
<p><a target="_blank" rel="noopener" href="https://imgchr.com/i/DsRh4A"><img src="https://s3.ax1x.com/2020/11/28/DsRh4A.png" alt="DsRh4A.png" loading="lazy"></a></p>
<p>技术出现的原因：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">网络传输很重要--&gt;一个网关有单点问题--&gt;多个网关--&gt;多个网关之间的路由选择--&gt;把多个网关在逻辑上合并成一个--&gt;VRRP</span><br></pre></td></tr></table></figure>

<p>技术的意义是：</p>
<blockquote>
<p>​    通过一个可以变的VRRP路由器代替真实的路由器提供给其他主机</p>
</blockquote>
<p>好处是：</p>
<blockquote>
<p>​    VRRP路由器是虚拟的，它只是一个漂浮的标志，他的下面才是真实的路由器们，它漂浮在哪个路由器上，哪个路由器就是当前的主路由器，为其他主机提供服务。这样哪怕有路由器故障宕机了，VRRP机制可以选举新的网关设备为其他设备提供服务，不会对主机产生什么影响</p>
</blockquote>
<p>VRRP的基本概念：</p>
<table>
<thead>
<tr>
<th align="center">概念</th>
<th align="left">解释</th>
</tr>
</thead>
<tbody><tr>
<td align="center">VRRP路由器</td>
<td align="left">运行VRRP协议的路由器，它可能属于多个虚拟路由器，有一个priority的参数，范围是0~255，0就退出虚拟路由器组，255优先级最高</td>
</tr>
<tr>
<td align="center">虚拟路由器</td>
<td align="left">又称为VRRP备份组，由一个Master设备和多个Backup设备组成，被当成一个局域网的缺省网关</td>
</tr>
<tr>
<td align="center">Master路由器</td>
<td align="left">承担转发报文任务的VRRP设备</td>
</tr>
<tr>
<td align="center">Backup路由器</td>
<td align="left">一组没有承担转发任务的VRRP设备，当Master设备出现故障的时候，他们通过竞选成为新的Master设备</td>
</tr>
<tr>
<td align="center">VRID</td>
<td align="left">虚拟路由器的标识，一组一个，范围是0~255</td>
</tr>
<tr>
<td align="center">虚拟IP地址</td>
<td align="left">虚拟路由器的IP地址，即VIP，可以是一个或多个</td>
</tr>
<tr>
<td align="center">IP地址拥有者</td>
<td align="left">VIP位于哪个设备上，哪个设备就是IP地址拥有者，即拥有了VIP作为自己的IP地址</td>
</tr>
<tr>
<td align="center">虚拟MAC地址</td>
<td align="left">根据VRID生成的MAC地址。当虚拟路由器回复ARP请求时，使用虚拟MAC地址，而不是真实的路由器的网卡地址（很明显，发生ARP请求是使用路由器的真实MAC地址的），有自己的固定格式：00-00-5e-00-01-VRID</td>
</tr>
<tr>
<td align="center">心跳线</td>
<td align="left">用于测试对方状态而设置的测试方法</td>
</tr>
</tbody></table>
<p>资料来源：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;support.huawei.com&#x2F;enterprise&#x2F;zh&#x2F;doc&#x2F;EDOC1000141382&#x2F;19258d72&#x2F;basic-concepts-of-vrrp</span><br></pre></td></tr></table></figure>



<hr>
<h3 id="高可用的方案"><a href="#高可用的方案" class="headerlink" title="高可用的方案"></a>高可用的方案</h3><p>主/备</p>
<p>主/主</p>
<p>心跳</p>
<h3 id="高可用的相关技术"><a href="#高可用的相关技术" class="headerlink" title="高可用的相关技术"></a>高可用的相关技术</h3><h4 id="HA-service"><a href="#HA-service" class="headerlink" title="HA service"></a>HA service</h4><p>技术点：</p>
<ul>
<li>把一些其他服务依赖的信息，比如说IP地址、进程变成一个可以变动的资源，比如说VIP和IP</li>
<li>利用可变资源，实现在不同的设备之间切换</li>
</ul>
<h4 id="Shared-Storage"><a href="#Shared-Storage" class="headerlink" title="Shared Storage"></a>Shared Storage</h4><p>技术点：</p>
<ul>
<li>把文件存放在文件服务器上，减小因单台主机宕机而导致文件无法访问的问题</li>
</ul>
<p>NAS：Network Attached Storage</p>
<p>SAN：Storage Area Network</p>
<h4 id="Network-Partition-网络分区"><a href="#Network-Partition-网络分区" class="headerlink" title="Network Partition 网络分区"></a>Network Partition 网络分区</h4><p>技术点：</p>
<ul>
<li>法定仲裁人，quorum，拥有选举的权利</li>
<li>第三方陪审团，拥有投票的权利</li>
<li>隔离设备 fence，可以给硬件设备强制断电的控制器</li>
</ul>
<h4 id="双节点集群-Two-Nodes-Cluster"><a href="#双节点集群-Two-Nodes-Cluster" class="headerlink" title="双节点集群 Two Nodes Cluster"></a>双节点集群 Two Nodes Cluster</h4><p>Failover：故障切换</p>
<p>Failback：故障切换后的主从切换</p>
<h1 id="2-KeepAlived-了解"><a href="#2-KeepAlived-了解" class="headerlink" title="2 KeepAlived 了解"></a>2 KeepAlived 了解</h1><p>官方网站</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;keepalived.org&#x2F;</span><br></pre></td></tr></table></figure>

<h2 id="KeepAlived的进程"><a href="#KeepAlived的进程" class="headerlink" title="KeepAlived的进程"></a>KeepAlived的进程</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">|-keepalived(2114)-+-keepalived(2115)</span><br><span class="line">|                  &#96;-keepalived(2116)</span><br><span class="line">两个子进程，一个是健康性检查的，一个是VRRP进程</span><br></pre></td></tr></table></figure>

<h2 id="KeepAlived的安装"><a href="#KeepAlived的安装" class="headerlink" title="KeepAlived的安装"></a>KeepAlived的安装</h2><p>yum安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum -y install keepalived</span><br><span class="line"># centos8 默认的KeepAlived版本是2.0.10</span><br><span class="line"># centos7 默认的KeepAlived版本是1.3.5</span><br></pre></td></tr></table></figure>

<p>编译安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">最新的版本是2.1.5</span><br></pre></td></tr></table></figure>



<h2 id="KeepAlived-配置文件"><a href="#KeepAlived-配置文件" class="headerlink" title="KeepAlived 配置文件"></a>KeepAlived 配置文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"># 全局设置，定义route_id，vrrp配置，多播地址</span><br><span class="line">global_defs &#123;</span><br><span class="line">	notifiaction_email_from 123@qq.com	# 发邮件的邮箱</span><br><span class="line">	notification_email &#123;</span><br><span class="line">		111@qq.com		# 收邮件的邮箱</span><br><span class="line">	&#125;</span><br><span class="line">	vrrp_strict		# 这一项应该删除，或者添加上vrrp_iptables</span><br><span class="line">	vrrp_mcast_group4 224.0.0.18	# 默认的多播地址</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 虚拟路由器设置，主备的设置，优先级的设置</span><br><span class="line">vrrp_instance &#123;</span><br><span class="line">	state MASTER | BACKUP	# 主和备的设置</span><br><span class="line">	interface ifname	# 虚拟IP绑定的网卡，比如eth0,eth1</span><br><span class="line">	virtual_route_id VRID	# 每一组虚拟主机的ID，同一组必须一样，不同组应该不一样</span><br><span class="line">	priority N	# 优先级</span><br><span class="line">	virtual_ipaddress &#123;</span><br><span class="line">		IP&#x2F;PREFIX dev ifname label label_name	# prefix不写，默认是&#x2F;32，建议不要和绑定VIP的网卡一												样</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># LVS的配置</span><br><span class="line">virtual server &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 可以设置子配置文件，用于存放不同的集群</span><br><span class="line">include &#x2F;etc&#x2F;keepalived&#x2F;conf.d&#x2F;*.conf</span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong></p>
<blockquote>
<p>不同的KeepAlived组，他们的虚拟路由器唯一标识应该不一样；</p>
<p>相同KeepAlived组，他们的虚拟路由器唯一标识应该一样；</p>
</blockquote>
<h2 id="keepalived的日志启用"><a href="#keepalived的日志启用" class="headerlink" title="keepalived的日志启用"></a>keepalived的日志启用</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 需要修改&#x2F;etc&#x2F;rsyslog.conf文件和&#x2F;etc&#x2F;sysconfig&#x2F;keepalived文件，把KeepAlived的日志记录到一个单独的文件中</span><br><span class="line"># vim &#x2F;etc&#x2F;sysconfig&#x2F;keepalived</span><br><span class="line"># 其实是给keepalived启动文件添加了启动选项，把日志添加上去</span><br><span class="line"> # --log-detail         -D    Detailed log messages.</span><br><span class="line"> # --log-facility       -S    0-7 Set local syslog facility (default&#x3D;LOG_DAEMON)</span><br><span class="line"> KEEPALIVED_OPTIONS&#x3D;&quot;-D -S 6&quot;</span><br><span class="line"></span><br><span class="line"># vim &#x2F;etc&#x2F;rsyslog.conf</span><br><span class="line">local6.*     &#x2F;var&#x2F;log&#x2F;keepalived.log	# 把日志文件保存在这里</span><br><span class="line">*.info;mail.none;authpriv.none;cron.none;keepalived.none     &#x2F;var&#x2F;log&#x2F;messages </span><br><span class="line"># 把keepalived日志取消输出到messages</span><br></pre></td></tr></table></figure>

<h1 id="3-KeepAlived的应用"><a href="#3-KeepAlived的应用" class="headerlink" title="3 KeepAlived的应用"></a>3 KeepAlived的应用</h1><h2 id="3-1-案例一：实现两个KA的主-备配置"><a href="#3-1-案例一：实现两个KA的主-备配置" class="headerlink" title="3.1 案例一：实现两个KA的主/备配置"></a>3.1 案例一：实现两个KA的主/备配置</h2><p>主：10.0.0.8</p>
<p>备：10.0.0.18</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"># 配置主</span><br><span class="line">! Configuration File for keepalived</span><br><span class="line"></span><br><span class="line">global_defs &#123;</span><br><span class="line">   notification_email &#123;</span><br><span class="line">       734709865@qq.com</span><br><span class="line">   &#125;</span><br><span class="line">   notification_email_from 734709865@qq.com</span><br><span class="line">   smtp_server 127.0.0.1</span><br><span class="line">   smtp_connect_timeout 30</span><br><span class="line">   router_id ka1</span><br><span class="line">   vrrp_skip_check_adv_addr</span><br><span class="line">   vrrp_garp_interval 0</span><br><span class="line">   vrrp_gna_interval 0</span><br><span class="line">   vrrp_mcast_group4 224.0.0.18</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    state MASTER</span><br><span class="line">    interface eth0</span><br><span class="line">    virtual_router_id 66</span><br><span class="line">    priority 100</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass centos</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        10.0.0.100 dev eth0 label eth0:v1</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 配置从，与上面不同的地方很少</span><br><span class="line">global_defs &#123;</span><br><span class="line">   notification_email &#123;</span><br><span class="line">        734709865@qq.com</span><br><span class="line">   &#125;</span><br><span class="line">   notification_email_from 734709865@qq.com</span><br><span class="line">   smtp_server 127.0.0.1</span><br><span class="line">   smtp_connect_timeout 30</span><br><span class="line">   router_id ka2							# 名字不一样</span><br><span class="line">   vrrp_skip_check_adv_addr</span><br><span class="line">   vrrp_garp_interval 0</span><br><span class="line">   vrrp_gna_interval 0</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    state BACKUP							# 状态不一样</span><br><span class="line">    interface eth0</span><br><span class="line">    virtual_router_id 66</span><br><span class="line">    priority 50								# 优先级不一样</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass centos</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        10.0.0.100 dev eth0 label eth0:v1</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-2-案例二：抢占模式和非抢占模式"><a href="#3-2-案例二：抢占模式和非抢占模式" class="headerlink" title="3.2 案例二：抢占模式和非抢占模式"></a>3.2 案例二：抢占模式和非抢占模式</h2><p><strong>注意：设置为非抢占模式，需要把status都设置为backup</strong></p>
<p>抢占式，preempt</p>
<p>非抢占式，nopreempt</p>
<p>延迟抢占模式，preempt_delay，默认单位是秒，默认300s，需要关闭严格模式</p>
<p>默认是抢占模式，即当一个高优先级主机出现后，不管当前的主机是否正常，都会把VIP抢到高优先级主机身上</p>
<p>因为抢占模式会导致一定的网络抖动（高的抢夺低的，哪怕低的是正常的），因此建议设置为非抢占式</p>
<p>配置：主和从都要配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vrrp_instance VI_1  &#123;</span><br><span class="line">	state BACKUP</span><br><span class="line">	nopreempt</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>延迟抢占模式的配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">	state BACKUP</span><br><span class="line">	preempt_delay 60	# 单位是秒</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="3-3-案例三：VIP单播模式"><a href="#3-3-案例三：VIP单播模式" class="headerlink" title="3.3 案例三：VIP单播模式"></a>3.3 案例三：VIP单播模式</h2><p>为了减少交换机中多播的资源带宽消耗，可以设置为单播</p>
<p>必须取消在全局配置中的vrrp_strict</p>
<p>配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">	unicast_src_ip 10.0.0.8		# 这是本机的IP</span><br><span class="line">	unicast_peer &#123;	# 这里填写要目的IP地址，可以是多个</span><br><span class="line">		10.0.0.X1</span><br><span class="line">		10.0.0.X2</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过tcpdump测试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -i eth0 -n -vv vrrp and not host 10.0.0.2 # 取消的这个地址是Windows主机</span><br></pre></td></tr></table></figure>



<h2 id="3-4-通知脚本的配置"><a href="#3-4-通知脚本的配置" class="headerlink" title="3.4 通知脚本的配置"></a>3.4 通知脚本的配置</h2><h2 id="3-5-实现master-slave的双主架构"><a href="#3-5-实现master-slave的双主架构" class="headerlink" title="3.5 实现master/slave的双主架构"></a>3.5 实现master/slave的双主架构</h2><h2 id="3-6-实现IPVS的高可用性"><a href="#3-6-实现IPVS的高可用性" class="headerlink" title="3.6 实现IPVS的高可用性"></a>3.6 实现IPVS的高可用性</h2><h2 id="3-7-实现其他的应用的高可用性的VRRP脚本"><a href="#3-7-实现其他的应用的高可用性的VRRP脚本" class="headerlink" title="3.7 实现其他的应用的高可用性的VRRP脚本"></a>3.7 实现其他的应用的高可用性的VRRP脚本</h2><h2 id="3-8-同步组"><a href="#3-8-同步组" class="headerlink" title="3.8 同步组"></a>3.8 同步组</h2><h1 id="4-综合案例"><a href="#4-综合案例" class="headerlink" title="4 综合案例"></a>4 综合案例</h1></div><div id="reward-container"><span class="hty-icon-button button-glow" id="reward-button" title="打赏" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === &quot;none&quot;) ? &quot;block&quot; : &quot;none&quot;;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-hand-coin-line"></use></svg></span><div id="reward-comment">I'm so cute. Please give me money.</div><div id="qr" style="display:none;"><div style="display:inline-block"><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/donate/alipay-qrcode.jpg"><img loading="lazy" src="https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/donate/alipay-qrcode.jpg" alt="支付宝" title="支付宝"></a><div><span style="color:#00A3EE"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-alipay-line"></use></svg></span></div></div><div style="display:inline-block"><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/donate/qqpay-qrcode.png"><img loading="lazy" src="https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/donate/qqpay-qrcode.png" alt="QQ 支付" title="QQ 支付"></a><div><span style="color:#12B7F5"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-qq-line"></use></svg></span></div></div><div style="display:inline-block"><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/donate/wechatpay-qrcode.jpg"><img loading="lazy" src="https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/donate/wechatpay-qrcode.jpg" alt="微信支付" title="微信支付"></a><div><span style="color:#2DC100"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-wechat-pay-line"></use></svg></span></div></div></div></div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>huihui</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="http://example.com/2020/12/05/KeepAlive/" title="KeepAlive">http://example.com/2020/12/05/KeepAlive/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>本博客所有文章除特别声明外，均默认采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><svg class="icon"><use xlink:href="#icon-creative-commons-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-by-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-nc-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-sa-line"></use></svg></a> 许可协议。</li></ul></section></article><div class="post-nav"><div class="post-nav-item"></div><div class="post-nav-item"><a class="post-nav-next" href="/2020/11/21/IP%E5%9C%B0%E5%9D%80%E5%88%92%E5%88%86/" rel="next" title="IP地址划分"><span class="post-nav-text">IP地址划分</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-right-s-line"></use></svg></a></div></div></div><div id="comment"><div class="comment-tooltip text-center"><span>点击按钮跳转 GitHub Issues 评论。</span><br><span>若没有本文 Issue，您可以使用 Comment 模版新建。</span><br><a class="hty-button hty-button--raised" id="github-issues" target="_blank" rel="noopener" href="https://github.com/YunYouJun/yunyoujun.github.io/issues?q=is:issue+KeepAlive">GitHub Issues</a></div></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; 2019 – 2020 </span><span class="with-love" id="animate"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-cloud-line"></use></svg></span><span class="author"> huihui</span></div><div class="powered"><span>由 <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> 驱动 v5.2.0</span><span class="footer-separator">|</span><span>主题 - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v1.3.0</span></div></footer><a class="hty-icon-button" id="goUp" aria-label="back-to-top" href="#"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-up-s-line"></use></svg><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a></div><script defer src="/js/utils.js"></script><script defer src="/js/hexo-theme-yun.js"></script></body></html>